<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[lomozm’s Journal]]></title>
  <link href="http://lomozm.github.io/atom.xml" rel="self"/>
  <link href="http://lomozm.github.io/"/>
  <updated>2014-12-29T22:38:51+08:00</updated>
  <id>http://lomozm.github.io/</id>
  <author>
    <name><![CDATA[lomozm]]></name>
    <email><![CDATA[18064095@qq.com]]></email>
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[交货单拣配过帐BAPIs - SD_DELIVERY_UPDATE_PICKING]]></title>
    <link href="http://lomozm.github.io/blog/20141229/jiao-huo-dan-jian-pei-guo-zhang-bapis-sd-delivery-update-picking/"/>
    <updated>2014-12-29T22:19:43+08:00</updated>
    <id>http://lomozm.github.io/blog/20141229/jiao-huo-dan-jian-pei-guo-zhang-bapis-sd-delivery-update-picking</id>
    <content type="html"><![CDATA[<h4 id="section">场景</h4>
<p>与地磅接口时，地磅系统根据所选交货单称重，并以此作为出库数量<br />
其它立库等系统也一样<br /></p>

<h4 id="section-1">重要参数说明</h4>
<p>1、参数vbkok-komue：自动以拣配数量覆盖交货数量（只能改小，不能改大？）
2、参数VBKOK-WABUC：自动过帐货物移动，如果为空，则只是测试运行，为“X”，表示过帐
3、参数LT_VBPOK-LIANP：修改交货数量
<!-- more --></p>

<h4 id="section-2">示例</h4>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
<span class="line-number">24</span>
<span class="line-number">25</span>
<span class="line-number">26</span>
<span class="line-number">27</span>
<span class="line-number">28</span>
<span class="line-number">29</span>
<span class="line-number">30</span>
<span class="line-number">31</span>
<span class="line-number">32</span>
<span class="line-number">33</span>
<span class="line-number">34</span>
<span class="line-number">35</span>
<span class="line-number">36</span>
<span class="line-number">37</span>
<span class="line-number">38</span>
<span class="line-number">39</span>
<span class="line-number">40</span>
<span class="line-number">41</span>
<span class="line-number">42</span>
<span class="line-number">43</span>
<span class="line-number">44</span>
<span class="line-number">45</span>
<span class="line-number">46</span>
<span class="line-number">47</span>
<span class="line-number">48</span>
<span class="line-number">49</span>
<span class="line-number">50</span>
<span class="line-number">51</span>
<span class="line-number">52</span>
<span class="line-number">53</span>
<span class="line-number">54</span>
<span class="line-number">55</span>
<span class="line-number">56</span>
<span class="line-number">57</span>
<span class="line-number">58</span>
<span class="line-number">59</span>
<span class="line-number">60</span>
<span class="line-number">61</span>
<span class="line-number">62</span>
<span class="line-number">63</span>
<span class="line-number">64</span>
<span class="line-number">65</span>
<span class="line-number">66</span>
<span class="line-number">67</span>
<span class="line-number">68</span>
<span class="line-number">69</span>
<span class="line-number">70</span>
<span class="line-number">71</span>
<span class="line-number">72</span>
<span class="line-number">73</span>
<span class="line-number">74</span>
<span class="line-number">75</span>
<span class="line-number">76</span>
<span class="line-number">77</span>
<span class="line-number">78</span>
<span class="line-number">79</span>
<span class="line-number">80</span>
<span class="line-number">81</span>
<span class="line-number">82</span>
<span class="line-number">83</span>
<span class="line-number">84</span>
<span class="line-number">85</span>
<span class="line-number">86</span>
<span class="line-number">87</span>
<span class="line-number">88</span>
<span class="line-number">89</span>
<span class="line-number">90</span>
<span class="line-number">91</span>
<span class="line-number">92</span>
</pre></td><td class="code"><pre><code class=""><span class="line">DATA: HEAD      TYPE          BAPIOBDLVHDRCHG,
</span><span class="line">        HEAD_C    TYPE          BAPIOBDLVHDRCTRLCHG,
</span><span class="line">        TECH_C    TYPE          BAPIDLVCONTROL,
</span><span class="line">        WA_RETURN TYPE          BAPIRET2,
</span><span class="line">        VBKOK     TYPE          VBKOK,
</span><span class="line">        ITEM_CONT TYPE TABLE OF BAPIOBDLVITEMCTRLCHG WITH HEADER LINE,
</span><span class="line">        LT_VBPOK  TYPE TABLE OF VBPOK WITH HEADER LINE,
</span><span class="line">        LT_LIPS   TYPE TABLE OF LIPS WITH HEADER LINE,
</span><span class="line">        LT_PROTT  TYPE TABLE OF PROTT WITH HEADER LINE,
</span><span class="line">        EXTENSION TYPE TABLE OF BAPIEXTC WITH HEADER LINE .
</span><span class="line">
</span><span class="line">  FIELD-SYMBOLS: &lt;F_ITEM&gt; TYPE BAPIOBDLVITEMCHG.
</span><span class="line">
</span><span class="line">  CLEAR VBKOK.
</span><span class="line">
</span><span class="line">  VBKOK-VBELN_VL = I_VBELN.
</span><span class="line">*  vbkok-komue = 'X'.
</span><span class="line">  VBKOK-WABUC = I_WABUC.
</span><span class="line">  VBKOK-WADAT_IST = SY-DATUM.
</span><span class="line">  VBKOK-BLDAT = SY-DATUM.
</span><span class="line">
</span><span class="line">  CLEAR: LT_LIPS,LT_LIPS[].
</span><span class="line">  SELECT * INTO TABLE LT_LIPS
</span><span class="line">    FROM LIPS
</span><span class="line">    WHERE VBELN = I_VBELN.
</span><span class="line">
</span><span class="line">  SORT LT_LIPS BY VBELN POSNR.
</span><span class="line">
</span><span class="line">  CLEAR: LT_VBPOK,LT_VBPOK[].
</span><span class="line">  LOOP AT ITEM_DATA ASSIGNING &lt;F_ITEM&gt;.
</span><span class="line">    CLEAR LT_VBPOK.
</span><span class="line">    LT_VBPOK-VBELN_VL = &lt;F_ITEM&gt;-DELIV_NUMB.
</span><span class="line">    LT_VBPOK-POSNR_VL = &lt;F_ITEM&gt;-DELIV_ITEM.
</span><span class="line">
</span><span class="line">    CLEAR LT_LIPS.
</span><span class="line">    READ TABLE LT_LIPS WITH KEY VBELN = I_VBELN POSNR = &lt;F_ITEM&gt;-HIERARITEM BINARY SEARCH.
</span><span class="line">
</span><span class="line">    LT_VBPOK-VBELN = LT_LIPS-VGBEL.
</span><span class="line">    LT_VBPOK-POSNN = LT_LIPS-VGPOS.
</span><span class="line">
</span><span class="line">    LT_VBPOK-MATNR = &lt;F_ITEM&gt;-MATERIAL.
</span><span class="line">    LT_VBPOK-CHARG = &lt;F_ITEM&gt;-BATCH.
</span><span class="line">    LT_VBPOK-WERKS = LT_LIPS-WERKS.
</span><span class="line">    LT_VBPOK-LIANP = 'X'.
</span><span class="line">    LT_VBPOK-PIKMG = &lt;F_ITEM&gt;-DLV_QTY.
</span><span class="line">    LT_VBPOK-LFIMG = &lt;F_ITEM&gt;-DLV_QTY.
</span><span class="line">    LT_VBPOK-UMVKZ = &lt;F_ITEM&gt;-FACT_UNIT_NOM.
</span><span class="line">    LT_VBPOK-UMVKN = &lt;F_ITEM&gt;-FACT_UNIT_DENOM.
</span><span class="line">    LT_VBPOK-VRKME = &lt;F_ITEM&gt;-SALES_UNIT.
</span><span class="line">    LT_VBPOK-MEINS = &lt;F_ITEM&gt;-BASE_UOM.
</span><span class="line">    LT_VBPOK-LGORT = LT_LIPS-LGORT.
</span><span class="line">
</span><span class="line">    APPEND LT_VBPOK.
</span><span class="line">  ENDLOOP.
</span><span class="line">
</span><span class="line">  CLEAR: LT_PROTT,LT_PROTT[].
</span><span class="line">  CALL FUNCTION 'SD_DELIVERY_UPDATE_PICKING'
</span><span class="line">    EXPORTING
</span><span class="line">      VBKOK_WA  = VBKOK
</span><span class="line">    TABLES
</span><span class="line">      VBPOK_TAB = LT_VBPOK
</span><span class="line">      PROT      = LT_PROTT.
</span><span class="line">*sy-msgty = 'S'.
</span><span class="line">  READ TABLE LT_PROTT TRANSPORTING NO FIELDS WITH KEY MSGTY = 'E'.
</span><span class="line">  IF SY-SUBRC EQ 0.
</span><span class="line">    CALL FUNCTION 'BAPI_TRANSACTION_ROLLBACK'.
</span><span class="line">    LOOP AT LT_PROTT WHERE MSGTY EQ 'E'.
</span><span class="line">      CLEAR WA_RETURN.
</span><span class="line">      WA_RETURN-TYPE = 'E'.
</span><span class="line">      CONCATENATE LT_PROTT-VBELN '/' LT_PROTT-POSNR ':' LT_PROTT-MATNR '/' LT_PROTT-CHARG ';'
</span><span class="line">      LT_PROTT-MSGNO LT_PROTT-MSGID LT_PROTT-MSGV1 LT_PROTT-MSGV2 LT_PROTT-MSGV3
</span><span class="line">      INTO WA_RETURN-MESSAGE.
</span><span class="line">
</span><span class="line">      APPEND WA_RETURN TO RETURN.
</span><span class="line">      CLEAR LT_PROTT.
</span><span class="line">    ENDLOOP.
</span><span class="line">
</span><span class="line">    RETURN.
</span><span class="line">  ENDIF.
</span><span class="line">
</span><span class="line">  CLEAR WA_RETURN.
</span><span class="line">  CALL FUNCTION 'BAPI_TRANSACTION_COMMIT'
</span><span class="line">    EXPORTING
</span><span class="line">      WAIT   = 'X'
</span><span class="line">    IMPORTING
</span><span class="line">      RETURN = WA_RETURN.
</span><span class="line">
</span><span class="line">  IF WA_RETURN-TYPE EQ 'E'.
</span><span class="line">    CALL FUNCTION 'BAPI_TRANSACTION_ROLLBACK'.
</span><span class="line">    APPEND WA_RETURN TO RETURN.
</span><span class="line">    RETURN.
</span><span class="line">  ENDIF.</span></code></pre></td></tr></table></div></figure></notextile></div>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[供应商主数据校验EXITs - SAPMF02K]]></title>
    <link href="http://lomozm.github.io/blog/20141228/gong-ying-shang-zhu-shu-ju-xiao-yan-exits-sapmf02k/"/>
    <updated>2014-12-28T22:32:36+08:00</updated>
    <id>http://lomozm.github.io/blog/20141228/gong-ying-shang-zhu-shu-ju-xiao-yan-exits-sapmf02k</id>
    <content type="html"><![CDATA[<h4 id="section">应用场景</h4>
<p>用户创建供应商主数据时检查，其税号是唯一存在的，不能对应多个供应商的情况，防止后续系统错误；出口函数：EXIT_SAPMF02K_001<br />
<!-- more --></p>

<h4 id="section-1">示例代码</h4>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
<span class="line-number">24</span>
<span class="line-number">25</span>
<span class="line-number">26</span>
<span class="line-number">27</span>
<span class="line-number">28</span>
<span class="line-number">29</span>
<span class="line-number">30</span>
<span class="line-number">31</span>
<span class="line-number">32</span>
<span class="line-number">33</span>
<span class="line-number">34</span>
<span class="line-number">35</span>
<span class="line-number">36</span>
<span class="line-number">37</span>
<span class="line-number">38</span>
<span class="line-number">39</span>
<span class="line-number">40</span>
<span class="line-number">41</span>
<span class="line-number">42</span>
<span class="line-number">43</span>
<span class="line-number">44</span>
<span class="line-number">45</span>
<span class="line-number">46</span>
<span class="line-number">47</span>
<span class="line-number">48</span>
<span class="line-number">49</span>
<span class="line-number">50</span>
<span class="line-number">51</span>
</pre></td><td class="code"><pre><code class=""><span class="line">*&amp;---------------------------------------------------------------------*
</span><span class="line">*&amp;  包括                ZXF05U01
</span><span class="line">*&amp;---------------------------------------------------------------------*
</span><span class="line">
</span><span class="line">DATA:IT_LFA1 LIKE LFA1 OCCURS 0 WITH HEADER LINE,
</span><span class="line">     MSG(999) TYPE C.
</span><span class="line">
</span><span class="line">
</span><span class="line">IF SY-TCODE EQ 'MK01' OR SY-TCODE EQ 'XK01'.
</span><span class="line">
</span><span class="line">  IF I_LFA1-LIFNR IS NOT INITIAL.
</span><span class="line">
</span><span class="line">     SELECT * INTO TABLE IT_LFA1
</span><span class="line">     FROM LFA1
</span><span class="line">     WHERE LFA1~LIFNR &lt;&gt; I_LFA1-LIFNR AND LFA1~STCEG EQ I_LFA1-STCEG.
</span><span class="line">
</span><span class="line">    ELSE.
</span><span class="line">
</span><span class="line">
</span><span class="line">   SELECT * INTO TABLE IT_LFA1
</span><span class="line">     FROM LFA1
</span><span class="line">     WHERE   LFA1~STCEG EQ I_LFA1-STCEG.
</span><span class="line">
</span><span class="line">     ENDIF.
</span><span class="line">
</span><span class="line">     IF IT_LFA1[] IS NOT INITIAL.
</span><span class="line">       READ TABLE IT_LFA1 INDEX 1.
</span><span class="line">       CLEAR MSG.
</span><span class="line">       CONCATENATE '税号：' IT_LFA1-STCEG '已存在，对应供应商编码：' IT_LFA1-LIFNR  '供应商名称： 'IT_LFA1-NAME1 INTO MSG.
</span><span class="line">       MESSAGE MSG TYPE 'E'.
</span><span class="line">       ENDIF.
</span><span class="line">
</span><span class="line">  ENDIF.
</span><span class="line">
</span><span class="line">
</span><span class="line">
</span><span class="line">  IF SY-TCODE  EQ 'MK02' OR SY-TCODE  EQ 'XK02'.
</span><span class="line">
</span><span class="line">    SELECT * INTO TABLE IT_LFA1
</span><span class="line">     FROM LFA1
</span><span class="line">     WHERE LFA1~LIFNR &lt;&gt; I_LFA1-LIFNR AND  LFA1~STCEG EQ I_LFA1-STCEG.
</span><span class="line">
</span><span class="line">     IF IT_LFA1[] IS NOT INITIAL.
</span><span class="line">       READ TABLE IT_LFA1 INDEX 1.
</span><span class="line">       CLEAR MSG.
</span><span class="line">       CONCATENATE '税号：' IT_LFA1-STCEG '已存在，对应供应商编码：' IT_LFA1-LIFNR  '供应商名称： 'IT_LFA1-NAME1 INTO MSG.
</span><span class="line">       MESSAGE MSG TYPE 'E'.
</span><span class="line">       ENDIF.
</span><span class="line">
</span><span class="line">
</span><span class="line">    ENDIF.</span></code></pre></td></tr></table></div></figure></notextile></div>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[货物移动BAPIs - BAPI_GOODSMVT_CREATE的说明]]></title>
    <link href="http://lomozm.github.io/blog/20141228/huo-wu-bapis-bapi-goodsmvt-createde-shuo-ming/"/>
    <updated>2014-12-28T21:57:53+08:00</updated>
    <id>http://lomozm.github.io/blog/20141228/huo-wu-bapis-bapi-goodsmvt-createde-shuo-ming</id>
    <content type="html"><![CDATA[<p>SAP系统里的所有货物移动(好象重复制造的成品入库是用MFBF来做的，针对它的入库有传用的BAPIs，真不确定可以用这个函数来做)，都可以用这个函数来完成，包括：MB1A,MB1B,MB1C,MB31,MIGO等<br /></p>

<h4 id="section">说明</h4>
<p>1、一般情况下，必须指定输入参数：goodsmvt_code，具体内容在表：T158G可以看到<br />
01	-	MB01<br />
02	-	MB31<br />
03	-	MB1A<br />
04	-   MB1B<br />
05	-	MB1C<br />
06	-	MB11<br />
07	-	MB04<br />
2、一般情况下，必须指定行项目参数（移动标识）：MVT_IND，具体内容在DOMAIN：KZBEW的值范围内可以看到<br />
空	-	无参考的货物移动<br /> 
B	-	按采购订单的货物移动<br /> 
F	-	有关生产单的货物移动<br /> 
L	-	有关交货通知的货物移动<br /> 
K	-	看板需求的货物移动（WM－仅限内部）<br /> 
O	-	“提供物料”消耗的后续调整<br /> 
W	-	比例的后续调整/产品单位物料<br /> 
<!-- more --></p>

<h4 id="section-1">示例代码</h4>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
<span class="line-number">24</span>
<span class="line-number">25</span>
<span class="line-number">26</span>
<span class="line-number">27</span>
<span class="line-number">28</span>
<span class="line-number">29</span>
<span class="line-number">30</span>
<span class="line-number">31</span>
<span class="line-number">32</span>
<span class="line-number">33</span>
<span class="line-number">34</span>
<span class="line-number">35</span>
<span class="line-number">36</span>
<span class="line-number">37</span>
<span class="line-number">38</span>
<span class="line-number">39</span>
<span class="line-number">40</span>
<span class="line-number">41</span>
<span class="line-number">42</span>
<span class="line-number">43</span>
<span class="line-number">44</span>
<span class="line-number">45</span>
<span class="line-number">46</span>
<span class="line-number">47</span>
<span class="line-number">48</span>
<span class="line-number">49</span>
<span class="line-number">50</span>
<span class="line-number">51</span>
<span class="line-number">52</span>
<span class="line-number">53</span>
<span class="line-number">54</span>
<span class="line-number">55</span>
<span class="line-number">56</span>
<span class="line-number">57</span>
<span class="line-number">58</span>
<span class="line-number">59</span>
<span class="line-number">60</span>
<span class="line-number">61</span>
<span class="line-number">62</span>
<span class="line-number">63</span>
<span class="line-number">64</span>
<span class="line-number">65</span>
<span class="line-number">66</span>
<span class="line-number">67</span>
<span class="line-number">68</span>
<span class="line-number">69</span>
<span class="line-number">70</span>
<span class="line-number">71</span>
<span class="line-number">72</span>
<span class="line-number">73</span>
<span class="line-number">74</span>
<span class="line-number">75</span>
<span class="line-number">76</span>
<span class="line-number">77</span>
<span class="line-number">78</span>
<span class="line-number">79</span>
<span class="line-number">80</span>
<span class="line-number">81</span>
<span class="line-number">82</span>
<span class="line-number">83</span>
<span class="line-number">84</span>
<span class="line-number">85</span>
<span class="line-number">86</span>
<span class="line-number">87</span>
<span class="line-number">88</span>
<span class="line-number">89</span>
<span class="line-number">90</span>
<span class="line-number">91</span>
<span class="line-number">92</span>
<span class="line-number">93</span>
<span class="line-number">94</span>
<span class="line-number">95</span>
<span class="line-number">96</span>
</pre></td><td class="code"><pre><code class=""><span class="line">DATA: WA_HEAD     TYPE          BAPI2017_GM_HEAD_01 ,                         "表头数据
</span><span class="line">        L_CODE      TYPE          GM_CODE ,                                     "
</span><span class="line">        WA_HEADRET  TYPE          BAPI2017_GM_HEAD_RET ,                        "入库完成后传回的物料凭证编号和物料凭证年度
</span><span class="line">        WA_STATUS   TYPE          BAPIRETURN ,      "反馈至地磅的消息
</span><span class="line">        LT_RETURN   TYPE TABLE OF BAPIRET2,    "反馈消息
</span><span class="line">        WA_RETURN   TYPE          BAPIRET2,
</span><span class="line">        LT_ITEM     TYPE TABLE OF BAPI2017_GM_ITEM_CREATE WITH HEADER LINE,    "表数据，采购订单行项目
</span><span class="line">        G_C(3)      TYPE          C,
</span><span class="line">        L_KZBEW     TYPE          KZBEW,
</span><span class="line">        G_CHARG     TYPE          CHARG_D,
</span><span class="line">        L_MOVE_REAS TYPE          BAPI2017_GM_ITEM_CREATE-MOVE_REAS.
</span><span class="line">
</span><span class="line">  CASE I_TYPE.
</span><span class="line">    WHEN  'A'.    "采购订单入库
</span><span class="line">      L_CODE = '01' .
</span><span class="line">      G_C    = '101' .
</span><span class="line">      L_KZBEW = 'B'.
</span><span class="line">      CLEAR:  L_MOVE_REAS .
</span><span class="line">    WHEN 'B'.    "无采购订单入库
</span><span class="line">      L_CODE = '05'.
</span><span class="line">      G_C = '521'.
</span><span class="line">      CLEAR: L_KZBEW, L_MOVE_REAS .
</span><span class="line">    WHEN  'C'.    "退货采购订单（已开票）
</span><span class="line">      L_CODE = '01' .
</span><span class="line">      G_C    = '161' .
</span><span class="line">      L_KZBEW = 'B'.
</span><span class="line">      CLEAR:  L_MOVE_REAS .
</span><span class="line">    WHEN  'D'.    "采购订单退货（未开票）
</span><span class="line">      L_CODE = '01' .
</span><span class="line">      G_C    = '122' .
</span><span class="line">      L_KZBEW = 'B'.
</span><span class="line">      L_MOVE_REAS = '0001' .  "移动原因"
</span><span class="line">    WHEN 'E'.    "生产订单发料
</span><span class="line">      L_CODE = '03'.
</span><span class="line">      G_C = '261'.
</span><span class="line">      CLEAR: L_KZBEW, L_MOVE_REAS .
</span><span class="line">    WHEN 'F'.    "生产订单入库
</span><span class="line">      L_CODE = '02'.
</span><span class="line">      G_C = '101'.
</span><span class="line">      L_KZBEW  = 'F'.
</span><span class="line">      CLEAR: L_MOVE_REAS .
</span><span class="line">  ENDCASE.
</span><span class="line">
</span><span class="line">  CLEAR: WA_HEAD .
</span><span class="line">  WA_HEAD-PSTNG_DATE = SY-DATUM .
</span><span class="line">  WA_HEAD-DOC_DATE   = SY-DATUM .
</span><span class="line">
</span><span class="line">  LOOP AT I_TABLE INTO WA_TABLE .
</span><span class="line">
</span><span class="line">    CLEAR: LT_ITEM .
</span><span class="line">    LT_ITEM-MATERIAL   = WA_TABLE-MATNR .
</span><span class="line">    LT_ITEM-STGE_LOC   = WA_TABLE-LGORT .
</span><span class="line">    LT_ITEM-ENTRY_QNT  = WA_TABLE-MENGE .
</span><span class="line">    LT_ITEM-ENTRY_UOM  = WA_TABLE-MEINS .
</span><span class="line">    LT_ITEM-PLANT      = WA_TABLE-WERKS .
</span><span class="line">    LT_ITEM-PO_NUMBER  = WA_TABLE-EBELN .
</span><span class="line">    LT_ITEM-PO_ITEM    = WA_TABLE-EBELP .
</span><span class="line">    LT_ITEM-MOVE_TYPE  = G_C .
</span><span class="line">    LT_ITEM-MVT_IND    = L_KZBEW.
</span><span class="line">    LT_ITEM-BATCH      = WA_TABLE-CHARG .
</span><span class="line">    LT_ITEM-MOVE_REAS  = L_MOVE_REAS.
</span><span class="line">	
</span><span class="line">	IF I_TYPE EQ 'E' OR I_TYPE EQ 'F'.
</span><span class="line">      LT_ITEM-ORDERID = WA_TABLE-AUFNR.
</span><span class="line">	ENDIF.
</span><span class="line">
</span><span class="line">    APPEND LT_ITEM .
</span><span class="line">  ENDLOOP .
</span><span class="line">
</span><span class="line">  CALL FUNCTION 'BAPI_GOODSMVT_CREATE'
</span><span class="line">    EXPORTING
</span><span class="line">      goodsmvt_header  = WA_HEAD
</span><span class="line">      goodsmvt_code    = L_CODE
</span><span class="line">    IMPORTING
</span><span class="line">      goodsmvt_headret = WA_HEADRET
</span><span class="line">    TABLES
</span><span class="line">      goodsmvt_item    = LT_ITEM
</span><span class="line">      return           = LT_RETURN.
</span><span class="line">
</span><span class="line">  READ TABLE LT_RETURN TRANSPORTING NO FIELDS WITH KEY type = 'E'.
</span><span class="line">  IF sy-subrc EQ 0.
</span><span class="line">    CALL FUNCTION 'BAPI_TRANSACTION_ROLLBACK'.
</span><span class="line">  ELSE.
</span><span class="line">    CLEAR wa_return.
</span><span class="line">    CALL FUNCTION 'BAPI_TRANSACTION_COMMIT'
</span><span class="line">      EXPORTING
</span><span class="line">        wait   = 'X'
</span><span class="line">      IMPORTING
</span><span class="line">        return = wa_return.
</span><span class="line">
</span><span class="line">    IF wa_return-type EQ 'E'.
</span><span class="line">      CALL FUNCTION 'BAPI_TRANSACTION_ROLLBACK'.
</span><span class="line">      APPEND wa_return TO LT_RETURN.
</span><span class="line">    ENDIF.
</span><span class="line">
</span><span class="line">  ENDIF.</span></code></pre></td></tr></table></div></figure></notextile></div>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[交货处理过程中数据处理BADIs - SMOD_V50B0001]]></title>
    <link href="http://lomozm.github.io/blog/20141227/jiao-huo-chu-li-guo-cheng-zhong-shu-ju-chu-li-badis-smod-v50b0001/"/>
    <updated>2014-12-27T22:48:32+08:00</updated>
    <id>http://lomozm.github.io/blog/20141227/jiao-huo-chu-li-guo-cheng-zhong-shu-ju-chu-li-badis-smod-v50b0001</id>
    <content type="html"><![CDATA[<h4 id="section">场景说明</h4>
<p>1、交货拣配处理<br />
2、系统配置为拣配数量不能大于交货单数量<br />
3、个别物料入库和出库时间相隔很短，建交货单时，系统是没有库存的，出库时，过磅确认交货数量；因此建交货单是交货数量为0，过磅后把交货数量改为过磅拣配数量，自动交货<br />
4、只更改当前行，没有传入的其它行数据不变，把交货单行项目号用extension传到方法中
5、使用方法EXIT_SAPLV50I_010
<!-- more --></p>

<h4 id="section-1">示例</h4>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
</pre></td><td class="code"><pre><code class=""><span class="line">METHOD IF_EX_SMOD_V50B0001~EXIT_SAPLV50I_010.
</span><span class="line">
</span><span class="line">    IF EXTENSION1 IS NOT INITIAL .
</span><span class="line">      DATA: EXTEND LIKE LINE OF EXTENSION1 .
</span><span class="line">      CLEAR: EXTEND .
</span><span class="line">      LOOP AT EXTENSION1 INTO EXTEND WHERE FIELD1 = 'MARK' .
</span><span class="line">        FIELD-SYMBOLS: &lt;CS_VBPOK&gt; LIKE LINE OF CT_VBPOK .
</span><span class="line">
</span><span class="line">        LOOP AT CT_VBPOK ASSIGNING &lt;CS_VBPOK&gt; WHERE VBELN_VL EQ EXTEND-FIELD2 AND POSNR_VL EQ EXTEND-FIELD3 .
</span><span class="line">          &lt;CS_VBPOK&gt;-PIKMG = &lt;CS_VBPOK&gt;-LFIMG .
</span><span class="line">        ENDLOOP.
</span><span class="line">      ENDLOOP.
</span><span class="line">    ENDIF.
</span><span class="line">
</span><span class="line">  ENDMETHOD.</span></code></pre></td></tr></table></div></figure></notextile></div>

<h4 id="section-2">说明</h4>
<p>1、理论上来说，这里可以改变拣配的所有业务
2、以SMOD为开头的BADIs主要用于交货后续处理，包括运输、定价
3、下面是网上搜到关于使用EXIT_SAPLV50I_009去更改inbound数据</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
</pre></td><td class="code"><pre><code class=""><span class="line">How to change storage location in inbound delivery use bapi?
</span><span class="line">
</span><span class="line">The paramater ITEM_DATA for bapi_inb_delivery_change has not a field named lgort.
</span><span class="line">so we use BADI SMOD_V50B0001, in this BADI has a method EXIT_SAPLV50I_009, use to change data in likp and lips.  
</span><span class="line">
</span><span class="line">So if you want to change the lgort or werks in the lips, you need to do below steps: 
</span><span class="line">1/ you need to pass the value by extension1 to the BAPI, and get it in EXIT_SAPLV50I_009, 
</span><span class="line">2/ set the lgort or werks in ct_vbpok accounting to extention1, 
</span><span class="line">3/ set the filed kzlgo and xwmpp with 'X'.</span></code></pre></td></tr></table></div></figure></notextile></div>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[交货单拣配BAPIs - BAPI_OUTB_DELIVERY_CHANGE]]></title>
    <link href="http://lomozm.github.io/blog/20141227/jiao-huo-dan-jian-pei-bapis-bapi-outb-delivery-change/"/>
    <updated>2014-12-27T20:47:05+08:00</updated>
    <id>http://lomozm.github.io/blog/20141227/jiao-huo-dan-jian-pei-bapis-bapi-outb-delivery-change</id>
    <content type="html"><![CDATA[<p>这个函数主要用于<br />
1、修改交货单拣配数量等信息<br />
2、批次拆分<br />
3、不能更改交货数量，如果系统配置拣配数量不能大于交货单数量的话，需要另一个<code>BADIs:SMOD_V50B0001</code>去处理<br />
<!-- more --></p>

<h4 id="section">代码示例</h4>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
<span class="line-number">24</span>
<span class="line-number">25</span>
<span class="line-number">26</span>
<span class="line-number">27</span>
<span class="line-number">28</span>
<span class="line-number">29</span>
<span class="line-number">30</span>
<span class="line-number">31</span>
<span class="line-number">32</span>
<span class="line-number">33</span>
<span class="line-number">34</span>
<span class="line-number">35</span>
<span class="line-number">36</span>
<span class="line-number">37</span>
<span class="line-number">38</span>
<span class="line-number">39</span>
<span class="line-number">40</span>
<span class="line-number">41</span>
<span class="line-number">42</span>
<span class="line-number">43</span>
<span class="line-number">44</span>
<span class="line-number">45</span>
<span class="line-number">46</span>
<span class="line-number">47</span>
<span class="line-number">48</span>
<span class="line-number">49</span>
<span class="line-number">50</span>
<span class="line-number">51</span>
<span class="line-number">52</span>
<span class="line-number">53</span>
<span class="line-number">54</span>
<span class="line-number">55</span>
<span class="line-number">56</span>
<span class="line-number">57</span>
<span class="line-number">58</span>
<span class="line-number">59</span>
<span class="line-number">60</span>
<span class="line-number">61</span>
</pre></td><td class="code"><pre><code class=""><span class="line">*****批次拆分
</span><span class="line">  DATA: HEAD      TYPE          BAPIOBDLVHDRCHG,
</span><span class="line">        HEAD_C    TYPE          BAPIOBDLVHDRCTRLCHG,
</span><span class="line">        TECH_C    TYPE          BAPIDLVCONTROL,
</span><span class="line">        WA_RETURN TYPE          BAPIRET2,
</span><span class="line">        EXTENSION TYPE TABLE OF BAPIEXTC WITH HEADER LINE .
</span><span class="line">		
</span><span class="line">  CLEAR: HEAD,HEAD_C,TECH_C.
</span><span class="line">  HEAD-DELIV_NUMB = I_VBELN.
</span><span class="line">  HEAD_C-DELIV_NUMB = I_VBELN.
</span><span class="line">  TECH_C-UPD_IND = 'U'.
</span><span class="line">
</span><span class="line">  CLEAR: ITEM_CONT,ITEM_CONT[].
</span><span class="line">
</span><span class="line">  CLEAR:EXTENSION,EXTENSION[] .
</span><span class="line">
</span><span class="line">  LOOP AT ITEM_DATA ASSIGNING &lt;F_ITEM&gt;.
</span><span class="line">
</span><span class="line">    CLEAR ITEM_CONT.
</span><span class="line">    ITEM_CONT-DELIV_NUMB = &lt;F_ITEM&gt;-DELIV_NUMB.
</span><span class="line">    ITEM_CONT-DELIV_ITEM = &lt;F_ITEM&gt;-DELIV_ITEM.
</span><span class="line">    ITEM_CONT-CHG_DELQTY = 'X'.
</span><span class="line">    APPEND ITEM_CONT.
</span><span class="line">	
</span><span class="line">    EXTENSION-FIELD1 = 'MARK'.
</span><span class="line">    EXTENSION-FIELD2 = &lt;F_ITEM&gt;-DELIV_NUMB.
</span><span class="line">    EXTENSION-FIELD3 = &lt;F_ITEM&gt;-DELIV_ITEM.
</span><span class="line">    APPEND EXTENSION.
</span><span class="line">  ENDLOOP.
</span><span class="line">
</span><span class="line">  CLEAR: RETURN,RETURN[].
</span><span class="line">  CALL FUNCTION 'BAPI_OUTB_DELIVERY_CHANGE'
</span><span class="line">    EXPORTING
</span><span class="line">      HEADER_DATA    = HEAD
</span><span class="line">      HEADER_CONTROL = HEAD_C
</span><span class="line">      DELIVERY       = I_VBELN
</span><span class="line">      TECHN_CONTROL  = TECH_C
</span><span class="line">    TABLES
</span><span class="line">      ITEM_DATA      = ITEM_DATA
</span><span class="line">      ITEM_CONTROL   = ITEM_CONT
</span><span class="line">      RETURN         = RETURN
</span><span class="line">      EXTENSION1     = EXTENSION.
</span><span class="line">
</span><span class="line">  READ TABLE RETURN TRANSPORTING NO FIELDS WITH KEY TYPE = 'E'.
</span><span class="line">  IF SY-SUBRC EQ 0.
</span><span class="line">    CALL FUNCTION 'BAPI_TRANSACTION_ROLLBACK'.
</span><span class="line">    RETURN.
</span><span class="line">  ENDIF.
</span><span class="line">
</span><span class="line">  CLEAR WA_RETURN.
</span><span class="line">  CALL FUNCTION 'BAPI_TRANSACTION_COMMIT'
</span><span class="line">    EXPORTING
</span><span class="line">      WAIT   = 'X'
</span><span class="line">    IMPORTING
</span><span class="line">      RETURN = WA_RETURN.
</span><span class="line">
</span><span class="line">  IF WA_RETURN-TYPE EQ 'E'.
</span><span class="line">    CALL FUNCTION 'BAPI_TRANSACTION_ROLLBACK'.
</span><span class="line">    APPEND WA_RETURN TO RETURN.
</span><span class="line">    RETURN.
</span><span class="line">  ENDIF.</span></code></pre></td></tr></table></div></figure></notextile></div>

<h4 id="section-1">说明</h4>
<p>加入extension目的是对于接口传过来的交货行项目进行交货数量的更改（初始交货单数量为0），没有传入的行项目数据不做更改</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[基于工艺路线的检验计划导入函数 - CPCC_S_TASK_LIST_MAINTAIN]]></title>
    <link href="http://lomozm.github.io/blog/20141225/ji-yu-gong-yi-lu-xian-de-jian-yan-ji-hua-dao-ru-han-shu-cpcc-s-task-list-maintain/"/>
    <updated>2014-12-25T21:15:37+08:00</updated>
    <id>http://lomozm.github.io/blog/20141225/ji-yu-gong-yi-lu-xian-de-jian-yan-ji-hua-dao-ru-han-shu-cpcc-s-task-list-maintain</id>
    <content type="html"><![CDATA[<p>说明一下，这里主要是针对的时生产过程检验(tcode:QP01)，结果检验和来料检验，这个函数貌似也可以来做这些，所以很强大；同时，这个函数执行完后会锁定该工艺路线，必须程序退出后才释放<br />
除了这个函数外，还有个<code>BAPI:BAPI_INSPECTIONPLAN_CREATE, Function: ROUTING_MAINTAIN</code>也可以做；同时,<code>FUNCTION:QPCP_CHARACTERISTICS_CREATE</code>可以完成对表PLMK单条行数据的更改<br />
之所以没有用BAPI，当时业务顾问直接拿张表过来说，你把这些数据导进去吧，都没说是哪个事务代码，于是就自己折腾。。。<br /><br />
<!-- more -->
先提到几张表——<br />
PLKO: 任务清单 - 表头<br />
PLPO: 任务清单 - 工序/作业<br />
PLMK: 检验计划特性(与工艺路线关联)，存放检验特性数据，数据从表QPMK带过来<br />
QPMK: 检验主特性<br />
QPMT: 主检验特性文本<br /></p>

<h4 id="section">示例：</h4>
<p>数据定义<br /></p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
<span class="line-number">24</span>
<span class="line-number">25</span>
<span class="line-number">26</span>
<span class="line-number">27</span>
<span class="line-number">28</span>
<span class="line-number">29</span>
<span class="line-number">30</span>
<span class="line-number">31</span>
<span class="line-number">32</span>
<span class="line-number">33</span>
<span class="line-number">34</span>
<span class="line-number">35</span>
<span class="line-number">36</span>
<span class="line-number">37</span>
<span class="line-number">38</span>
<span class="line-number">39</span>
<span class="line-number">40</span>
<span class="line-number">41</span>
<span class="line-number">42</span>
<span class="line-number">43</span>
<span class="line-number">44</span>
<span class="line-number">45</span>
<span class="line-number">46</span>
<span class="line-number">47</span>
<span class="line-number">48</span>
<span class="line-number">49</span>
<span class="line-number">50</span>
<span class="line-number">51</span>
<span class="line-number">52</span>
<span class="line-number">53</span>
<span class="line-number">54</span>
<span class="line-number">55</span>
<span class="line-number">56</span>
<span class="line-number">57</span>
<span class="line-number">58</span>
<span class="line-number">59</span>
<span class="line-number">60</span>
<span class="line-number">61</span>
<span class="line-number">62</span>
<span class="line-number">63</span>
<span class="line-number">64</span>
<span class="line-number">65</span>
<span class="line-number">66</span>
<span class="line-number">67</span>
<span class="line-number">68</span>
<span class="line-number">69</span>
<span class="line-number">70</span>
<span class="line-number">71</span>
<span class="line-number">72</span>
<span class="line-number">73</span>
</pre></td><td class="code"><pre><code class=""><span class="line">TYPES: BEGIN OF TY_STAT,
</span><span class="line">         NO       TYPE I,
</span><span class="line">         STATUS   TYPE ICONNAME,
</span><span class="line">         ERR_INFO TYPE CHAR100,
</span><span class="line">         CHECKED  TYPE C,
</span><span class="line">       END OF TY_STAT.
</span><span class="line">
</span><span class="line">TYPES: BEGIN OF TY_XLS,
</span><span class="line">         PLNNR         TYPE PLNNR, "任务清单组码
</span><span class="line">         PMSTR_CHAR    TYPE WERKS_D, "工厂
</span><span class="line">         GROUP_COUNTER TYPE PLNAL, "组计数器
</span><span class="line">         VORNR         TYPE VORNR, "操作/活动编号
</span><span class="line">         VERWMERKM     TYPE QMERKNR,  "检验特性编号
</span><span class="line">         SMPL_UNIT     TYPE QPROBME,  "采样计量单位
</span><span class="line">         SMPL_QUANT    TYPE QPROBEFAK, "采样的采样数量因子（多重采样计量单位）
</span><span class="line">
</span><span class="line">         STICHPRVER    TYPE QSTICHVERF, "检验特性中的采样程序
</span><span class="line">         QPMK_ZAEHL    TYPE QZAEHLER, "主检验特性的工厂
</span><span class="line">         MKVERSION     TYPE QVERSNRMK, "主检验特性的版本号
</span><span class="line">         PMETHODE      TYPE QPMETHODE, "检验方法
</span><span class="line">         PMETHOD       TYPE Q_METH_PLANT, "检验方法的工厂
</span><span class="line">         PMTVERSION    TYPE QVERSNRPM,  "检验方法的版本号
</span><span class="line">
</span><span class="line">         PLNKN         TYPE PLNKN, "任务清单节点数
</span><span class="line">         ZAEHL         TYPE CIM_COUNT, "内部计数器
</span><span class="line">         GUELTIGAB     TYPE DATUV.  "有效起始日期
</span><span class="line">
</span><span class="line">        INCLUDE       TYPE TY_STAT.
</span><span class="line">TYPES: END OF TY_XLS.
</span><span class="line">DATA: GIT_XLS TYPE TABLE OF TY_XLS WITH HEADER LINE,
</span><span class="line">      GWA_XLS TYPE          TY_XLS.
</span><span class="line">
</span><span class="line">TYPES: BEGIN OF TY_DATA,
</span><span class="line">
</span><span class="line">         PLNNR         TYPE PLNNR, "任务清单组码
</span><span class="line">         GROUP_COUNTER TYPE PLNAL, "组计数器
</span><span class="line">         ZAEHL         TYPE CIM_COUNT, "内部计数器
</span><span class="line">         PLNKN         TYPE PLNKN, "任务清单节点数
</span><span class="line">
</span><span class="line">         PMSTR_CHAR    TYPE WERKS_D, "工厂
</span><span class="line">         VORNR         TYPE VORNR, "操作/活动编号
</span><span class="line">         VERWMERKM     TYPE QMERKNR,  "检验特性编号
</span><span class="line">         SMPL_UNIT     TYPE QPROBME,  "采样计量单位
</span><span class="line">         SMPL_QUANT    TYPE QPROBEFAK, "采样的采样数量因子（多重采样计量单位）
</span><span class="line">
</span><span class="line">         STICHPRVER    TYPE QSTICHVERF, "检验特性中的采样程序
</span><span class="line">         QPMK_ZAEHL    TYPE QZAEHLER, "主检验特性的工厂
</span><span class="line">         MKVERSION     TYPE QVERSNRMK, "主检验特性的版本号
</span><span class="line">         PMETHODE      TYPE QPMETHODE, "检验方法
</span><span class="line">         PMETHOD       TYPE Q_METH_PLANT, "检验方法的工厂
</span><span class="line">         PMTVERSION    TYPE QVERSNRPM,  "检验方法的版本号
</span><span class="line">
</span><span class="line">         ARBID         TYPE OBJEKTID,
</span><span class="line">         INDEX         TYPE I,
</span><span class="line">
</span><span class="line">         KURZTEXT      TYPE QKURZTEXT, "短文本
</span><span class="line">         CHARACT_ID1   TYPE QCHARACT_ID1, "质量数据交换的特性描述
</span><span class="line">         STELLEN       TYPE QSTELLEN,   "小数点右边的位数（精确的）
</span><span class="line">         SOLLWERT      TYPE QSOLLWERTE, "一个数量特性的目标值
</span><span class="line">         SOLLWNI       TYPE QNINITIAL,
</span><span class="line">         TOLERANZOB    TYPE QTOLOB,  "规范上限
</span><span class="line">         TOLOBNI       TYPE QNINITIAL,
</span><span class="line">         TOLERANZUN    TYPE QTOLUN,  "容差下限
</span><span class="line">         TOLUNNI       TYPE QNINITIAL,
</span><span class="line">
</span><span class="line">         GUELTIGAB     TYPE DATUV.  "有效起始日期
</span><span class="line">
</span><span class="line">        INCLUDE       TYPE TY_STAT.
</span><span class="line">TYPES: END OF TY_DATA.
</span><span class="line">
</span><span class="line">DATA: GIT_DATA TYPE TABLE OF TY_DATA WITH HEADER LINE,
</span><span class="line">      GWA_DATA TYPE          TY_DATA.
</span><span class="line">FIELD-SYMBOLS: &lt;DATA&gt; TYPE TY_DATA.</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>函数调用<br /></p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
<span class="line-number">24</span>
<span class="line-number">25</span>
<span class="line-number">26</span>
<span class="line-number">27</span>
<span class="line-number">28</span>
<span class="line-number">29</span>
<span class="line-number">30</span>
<span class="line-number">31</span>
<span class="line-number">32</span>
<span class="line-number">33</span>
<span class="line-number">34</span>
<span class="line-number">35</span>
<span class="line-number">36</span>
<span class="line-number">37</span>
<span class="line-number">38</span>
<span class="line-number">39</span>
<span class="line-number">40</span>
<span class="line-number">41</span>
<span class="line-number">42</span>
<span class="line-number">43</span>
<span class="line-number">44</span>
<span class="line-number">45</span>
<span class="line-number">46</span>
<span class="line-number">47</span>
<span class="line-number">48</span>
<span class="line-number">49</span>
<span class="line-number">50</span>
<span class="line-number">51</span>
<span class="line-number">52</span>
<span class="line-number">53</span>
<span class="line-number">54</span>
<span class="line-number">55</span>
<span class="line-number">56</span>
<span class="line-number">57</span>
<span class="line-number">58</span>
<span class="line-number">59</span>
<span class="line-number">60</span>
<span class="line-number">61</span>
<span class="line-number">62</span>
<span class="line-number">63</span>
<span class="line-number">64</span>
<span class="line-number">65</span>
<span class="line-number">66</span>
<span class="line-number">67</span>
<span class="line-number">68</span>
<span class="line-number">69</span>
<span class="line-number">70</span>
<span class="line-number">71</span>
<span class="line-number">72</span>
<span class="line-number">73</span>
<span class="line-number">74</span>
<span class="line-number">75</span>
<span class="line-number">76</span>
<span class="line-number">77</span>
<span class="line-number">78</span>
<span class="line-number">79</span>
<span class="line-number">80</span>
<span class="line-number">81</span>
<span class="line-number">82</span>
<span class="line-number">83</span>
<span class="line-number">84</span>
<span class="line-number">85</span>
<span class="line-number">86</span>
<span class="line-number">87</span>
<span class="line-number">88</span>
<span class="line-number">89</span>
<span class="line-number">90</span>
<span class="line-number">91</span>
<span class="line-number">92</span>
<span class="line-number">93</span>
<span class="line-number">94</span>
<span class="line-number">95</span>
<span class="line-number">96</span>
<span class="line-number">97</span>
<span class="line-number">98</span>
<span class="line-number">99</span>
<span class="line-number">100</span>
<span class="line-number">101</span>
<span class="line-number">102</span>
<span class="line-number">103</span>
<span class="line-number">104</span>
<span class="line-number">105</span>
<span class="line-number">106</span>
<span class="line-number">107</span>
<span class="line-number">108</span>
<span class="line-number">109</span>
<span class="line-number">110</span>
<span class="line-number">111</span>
<span class="line-number">112</span>
<span class="line-number">113</span>
<span class="line-number">114</span>
<span class="line-number">115</span>
<span class="line-number">116</span>
<span class="line-number">117</span>
<span class="line-number">118</span>
<span class="line-number">119</span>
<span class="line-number">120</span>
<span class="line-number">121</span>
<span class="line-number">122</span>
<span class="line-number">123</span>
<span class="line-number">124</span>
<span class="line-number">125</span>
<span class="line-number">126</span>
<span class="line-number">127</span>
<span class="line-number">128</span>
<span class="line-number">129</span>
<span class="line-number">130</span>
<span class="line-number">131</span>
<span class="line-number">132</span>
<span class="line-number">133</span>
<span class="line-number">134</span>
<span class="line-number">135</span>
<span class="line-number">136</span>
<span class="line-number">137</span>
<span class="line-number">138</span>
<span class="line-number">139</span>
<span class="line-number">140</span>
<span class="line-number">141</span>
<span class="line-number">142</span>
<span class="line-number">143</span>
<span class="line-number">144</span>
<span class="line-number">145</span>
<span class="line-number">146</span>
<span class="line-number">147</span>
<span class="line-number">148</span>
<span class="line-number">149</span>
<span class="line-number">150</span>
<span class="line-number">151</span>
<span class="line-number">152</span>
</pre></td><td class="code"><pre><code class=""><span class="line">DATA:
</span><span class="line">    LS_TSK     TYPE                   CPS_TASK_LIST_MAINT_TSK,
</span><span class="line">    LS_TSK_X   TYPE                   CPS_TASK_LIST_MAINT_TSK_X,
</span><span class="line">    LT_CHA     TYPE STANDARD TABLE OF CPS_TASK_LIST_MAINT_CHA,
</span><span class="line">    LS_CHA     TYPE                   CPS_TASK_LIST_MAINT_CHA,
</span><span class="line">    LT_CHA_X   TYPE STANDARD TABLE OF CPS_TASK_LIST_MAINT_CHA_X,
</span><span class="line">    LS_CHA_X   TYPE                   CPS_TASK_LIST_MAINT_CHA_X,
</span><span class="line">    IT_RETURN  TYPE STANDARD TABLE OF BAPIRET2,
</span><span class="line">    LS_RETURN  TYPE                   BAPIRET2,
</span><span class="line">    L_INSPCHAR TYPE                   QMERKNRP.
</span><span class="line">
</span><span class="line">  DATA: LV_LINE_COUNTER TYPE I.
</span><span class="line">
</span><span class="line">  DATA: LT_DATA TYPE TABLE OF TY_DATA WITH HEADER LINE.
</span><span class="line">
</span><span class="line">  CLEAR: LT_DATA[].
</span><span class="line">
</span><span class="line">  LOOP AT LT_ROWS INTO LS_ROWS.
</span><span class="line">    READ TABLE GIT_DATA INDEX LS_ROWS-INDEX.
</span><span class="line">    CHECK SY-SUBRC EQ 0.
</span><span class="line">
</span><span class="line">    GIT_DATA-INDEX =  LS_ROWS-INDEX.
</span><span class="line">
</span><span class="line">    CALL FUNCTION 'CONVERSION_EXIT_ALPHA_INPUT'
</span><span class="line">      EXPORTING
</span><span class="line">        INPUT  = GIT_DATA-MKVERSION
</span><span class="line">      IMPORTING
</span><span class="line">        OUTPUT = GIT_DATA-MKVERSION.
</span><span class="line">
</span><span class="line">    CALL FUNCTION 'CONVERSION_EXIT_ALPHA_INPUT'
</span><span class="line">      EXPORTING
</span><span class="line">        INPUT  = GIT_DATA-PMTVERSION
</span><span class="line">      IMPORTING
</span><span class="line">        OUTPUT = GIT_DATA-PMTVERSION.
</span><span class="line">
</span><span class="line">    SELECT SINGLE CHARACT_ID1 "质量数据交换的特性描述
</span><span class="line">          STELLEN   "小数点右边的位数（精确的）
</span><span class="line">          SOLLWERT "一个数量特性的目标值
</span><span class="line">          SOLLWNI
</span><span class="line">          TOLERANZOB "规范上限
</span><span class="line">          TOLOBNI
</span><span class="line">          TOLERANZUN  "容差下限
</span><span class="line">          TOLUNNI
</span><span class="line">      INTO (GIT_DATA-CHARACT_ID1, "质量数据交换的特性描述
</span><span class="line">          GIT_DATA-STELLEN,   "小数点右边的位数（精确的）
</span><span class="line">          GIT_DATA-SOLLWERT, "一个数量特性的目标值
</span><span class="line">          GIT_DATA-SOLLWNI,
</span><span class="line">          GIT_DATA-TOLERANZOB, "规范上限
</span><span class="line">          GIT_DATA-TOLOBNI,
</span><span class="line">          GIT_DATA-TOLERANZUN,  "容差下限
</span><span class="line">          GIT_DATA-TOLUNNI)
</span><span class="line">      FROM QPMK
</span><span class="line">      WHERE MKMNR EQ GIT_DATA-VERWMERKM
</span><span class="line">           AND VERSION EQ GIT_DATA-MKVERSION
</span><span class="line">           AND WERKS EQ GIT_DATA-PMSTR_CHAR
</span><span class="line">          AND LOEKZ EQ '2'.
</span><span class="line">
</span><span class="line">    SELECT SINGLE KURZTEXT INTO GIT_DATA-KURZTEXT FROM QPMT
</span><span class="line">        WHERE ZAEHLER EQ GIT_DATA-PMSTR_CHAR
</span><span class="line">          AND MKMNR EQ GIT_DATA-VERWMERKM
</span><span class="line">               AND VERSION EQ GIT_DATA-MKVERSION
</span><span class="line">          AND SPRACHE EQ SY-LANGU.
</span><span class="line">		  
</span><span class="line">    APPEND GIT_DATA TO LT_DATA.
</span><span class="line">
</span><span class="line">  ENDLOOP.
</span><span class="line">
</span><span class="line">  SORT LT_DATA BY PLNNR GROUP_COUNTER ZAEHL PLNKN.
</span><span class="line">  LOOP AT LT_DATA.
</span><span class="line">
</span><span class="line">    L_INDEX = LT_DATA-INDEX.
</span><span class="line">
</span><span class="line">    LS_CHA-MAINTAIN_MODE      = 'C'.
</span><span class="line">    LS_CHA-ACTIVITY        = LT_DATA-VORNR.
</span><span class="line">
</span><span class="line">    LS_CHA-SEQUENCE_NO = '000000'.
</span><span class="line">
</span><span class="line">    LS_CHA-QUANTITATIVE_IND = 'X'.
</span><span class="line">    LS_CHA-CHAR_DESCR       = LT_DATA-KURZTEXT.
</span><span class="line">	
</span><span class="line">    LS_CHA-MSTR_CHAR       = LT_DATA-VERWMERKM.
</span><span class="line">    LS_CHA-VMSTR_CHAR = LT_DATA-MKVERSION.
</span><span class="line">    LS_CHA-PMSTR_CHAR      = LT_DATA-PMSTR_CHAR.
</span><span class="line">    LS_CHA-QUANTITATIVE_IND = 'X'.
</span><span class="line">    LS_CHA-MEAS_VALUE_CONFIRM_IND = 'X'.
</span><span class="line">	
</span><span class="line">    LS_CHA-UP_TOL_LMT_IND = LT_DATA-TOLOBNI.
</span><span class="line">    LS_CHA-LW_TOL_LMT_IND = LT_DATA-TOLUNNI.
</span><span class="line">    LS_CHA-TARGET_VAL_CHECK_IND = LT_DATA-SOLLWNI.
</span><span class="line">    LS_CHA-SCOPE_IND = '='.
</span><span class="line">    LS_CHA-CONFIRMATION_CATEGORY = 'X'.
</span><span class="line">    LS_CHA-SAMPLING_PROCEDURE_IND = 'X'.
</span><span class="line">
</span><span class="line">    LS_CHA-TARGET_VAL = LT_DATA-SOLLWERT.
</span><span class="line">    LS_CHA-TARGET_VAL_NI = LT_DATA-SOLLWNI.
</span><span class="line">    LS_CHA-UP_TOL_LMT = LT_DATA-TOLERANZOB.
</span><span class="line">    LS_CHA-UP_TOL_LMT_NI = LT_DATA-TOLOBNI.
</span><span class="line">    LS_CHA-LW_TOL_LMT = LT_DATA-TOLERANZUN.
</span><span class="line">    LS_CHA-LW_TOL_LMT_NI = LT_DATA-TOLUNNI.
</span><span class="line">
</span><span class="line">    LS_CHA-DAT_UP_NEW_LMT = SY-DATUM.
</span><span class="line">    LS_CHA-DAT_LW_NEW_LMT = '99991231'.
</span><span class="line">
</span><span class="line">    LS_CHA-CHARACTERISTIC_NAME = LT_DATA-CHARACT_ID1.
</span><span class="line">	
</span><span class="line">    LS_CHA-SMPL_PROCEDURE      = LT_DATA-STICHPRVER.
</span><span class="line">    LS_CHA-SMPL_UNIT = LT_DATA-SMPL_UNIT.
</span><span class="line">    LS_CHA-SMPL_QUANT = LT_DATA-SMPL_QUANT.
</span><span class="line">	
</span><span class="line">    LS_CHA-DEC_PLACES = LT_DATA-STELLEN.
</span><span class="line">
</span><span class="line">    LS_CHA-METHOD = LT_DATA-PMETHODE.
</span><span class="line">    LS_CHA-PMETHOD = LT_DATA-PMETHOD.
</span><span class="line">    LS_CHA-VMETHOD = LT_DATA-PMTVERSION.
</span><span class="line">    APPEND LS_CHA TO LT_CHA.
</span><span class="line">    CLEAR LS_CHA.
</span><span class="line">
</span><span class="line">    AT END OF PLNKN.
</span><span class="line">
</span><span class="line">      CALL FUNCTION 'CPCC_S_TASK_LIST_MAINTAIN'
</span><span class="line">        EXPORTING
</span><span class="line">          KEY_DATE                   = SY-DATUM
</span><span class="line">          TASK_LIST_TYPE             = 'N'
</span><span class="line">          TASK_LIST_GROUP            = LT_DATA-PLNNR
</span><span class="line">          GROUP_COUNTER              = LT_DATA-GROUP_COUNTER
</span><span class="line">        TABLES
</span><span class="line">          INSPECTION_CHARACTERISTICS = LT_CHA
</span><span class="line">          RETURN                     = IT_RETURN.
</span><span class="line">
</span><span class="line">      READ TABLE IT_RETURN INTO LS_RETURN WITH KEY TYPE = 'E'.
</span><span class="line">      IF SY-SUBRC EQ 0.
</span><span class="line">        READ TABLE GIT_DATA ASSIGNING &lt;DATA&gt; INDEX L_INDEX.
</span><span class="line">        IF SY-SUBRC EQ 0.
</span><span class="line">          CONCATENATE LS_RETURN-MESSAGE LS_RETURN-MESSAGE_V1  LS_RETURN-MESSAGE_V2 LS_RETURN-MESSAGE_V3 LS_RETURN-MESSAGE_V4
</span><span class="line">                        INTO &lt;DATA&gt;-ERR_INFO.
</span><span class="line">          &lt;DATA&gt;-STATUS = ICON_LED_RED.
</span><span class="line">        ENDIF.
</span><span class="line">      ELSE.
</span><span class="line">
</span><span class="line">        COMMIT WORK.
</span><span class="line">
</span><span class="line">        READ TABLE GIT_DATA ASSIGNING &lt;DATA&gt; INDEX L_INDEX.
</span><span class="line">        IF SY-SUBRC EQ 0.
</span><span class="line">          &lt;DATA&gt;-ERR_INFO = '处理成功'.
</span><span class="line">          &lt;DATA&gt;-STATUS = ICON_LED_GREEN.
</span><span class="line">        ENDIF.
</span><span class="line">      ENDIF.
</span><span class="line">
</span><span class="line">      CLEAR: IT_RETURN, LS_RETURN, LT_CHA[], L_INSPCHAR.
</span><span class="line">    ENDAT.
</span><span class="line">
</span><span class="line">  ENDLOOP.</span></code></pre></td></tr></table></div></figure></notextile></div>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[MacOS 10+ Octopress问题解决]]></title>
    <link href="http://lomozm.github.io/blog/20141220/macos-10-plus-octopresswen-ti-jie-jue/"/>
    <updated>2014-12-20T12:51:16+08:00</updated>
    <id>http://lomozm.github.io/blog/20141220/macos-10-plus-octopresswen-ti-jie-jue</id>
    <content type="html"><![CDATA[
<p>说明一下，在这个神奇的国度，上外网或进行外网交互真是个技术话，别人都觉得不会翻墙都不好意思说自己是搞IT的！<br /><br />
最后近一直很忙，几乎都成了31天工作制了，昨天突发奇想更新下自已的blog，问题来了<br />
1、首先不记得rake命命，我的那个神拉，快速翻开第1篇，真慢。算了，用<code>sudo rake preview</code>，再用<code>http://localhost:4000</code>找到，瞬间找到了些感觉，高兴<br />
2、什么，<code>fatal: Authentication failed for https://github.com/....</code>，使用<code>sudo rake deploy</code>认证失败，网速慢，多试了几次，还是一样的，是不是os升级到10.2后一些认证丢了呢，关键我都不记得github的密码了，在github里把密码改了，然后就是把系统存的钥匙串也改了，如下：<br />
<!-- more -->
<img src="http://lomozm.github.io/images/images/QQ20141220-1@2x.png" alt="001" /><br />
<img src="http://lomozm.github.io/images/images/A9A6910E-81F5-43F6-B2ED-98235A7986E3.png" alt="002" /><br />
3、然后就出现了<br />
<code>fatal: unable to access 'https://github.com/lomozm/lomozm.github.com/': Empty reply from server</code>，我的github客户端都能联通的呀，开启baidu搜（自从最近用不了google之后，就只有这东西可用了）<br />
<a href="http://segmentfault.com/q/1010000002169878">升级Yosemite后github for Mac的客户端出错</a>中说用<code>ssh -vT git@github.com</code>查看结果，其中包括：<br /></p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
</pre></td><td class="code"><pre><code class=""><span class="line">debug1: Offering DSA public key: /Users/***/.ssh/id_dsa
</span><span class="line">debug1: Authentications that can continue: publickey
</span><span class="line">debug1: Offering RSA public key: /Users/***/.ssh/github_rsa
</span><span class="line">debug1: Server accepts key: pkalg ssh-rsa blen 279
</span><span class="line">debug1: Authentication succeeded (publickey).
</span><span class="line">Authenticated to github.com ([192.30.252.128]:22).
</span><span class="line">debug1: channel 0: new [client-session]
</span><span class="line">debug1: Entering interactive session.
</span><span class="line">debug1: Sending environment.
</span><span class="line">debug1: Sending env LANG = zh_CN.UTF-8
</span><span class="line">debug1: client_input_channel_req: channel 0 rtype exit-status reply 0
</span><span class="line">Hi lomozm! You've successfully authenticated, but GitHub does not provide shell access.
</span><span class="line">debug1: channel 0: free: client-session, nchannels 1
</span><span class="line">Transferred: sent 3640, received 1992 bytes, in 40.3 seconds
</span><span class="line">Bytes per second: sent 90.3, received 49.4
</span><span class="line">debug1: Exit status 1</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>正常的啊，deploy还是出现不能访问，郁闷！！！网速也很慢，先睡觉，明日再战<br />
今天加班，处理完手里的事情后，看到一篇文章<a href="http://www.cocoachina.com/bbs/read.php?tid=271942">升级10。10yihougithub无法提交代码了</a>,里面说和我情况差不多吧，就是不能访问，4楼的方法出其简单，就是增加DNS：8.8.8.8和搜索域：github.com，要不有截图，我定认为是忽悠，这个DNS太不正常了吧，就这张图：<br />
<img src="http://lomozm.github.io/images/images/21_335670_6d4fee0fb339a56.png" alt="003" /><br />
同时，这个贴子里还提到如何为自已的账号生成ssh key<a href="https://help.github.com/articles/generating-ssh-keys/#step-3-add-your-ssh-key-to-your-account">Generating SSH keys</a><br />
4、做deploy时，不时的还是会出现<br /></p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
</pre></td><td class="code"><pre><code class=""><span class="line">error: RPC failed; result=56, HTTP code = 0
</span><span class="line">fatal: The remote end hung up unexpectedly
</span><span class="line">fatal: The remote end hung up unexpectedly</span></code></pre></td></tr></table></div></figure></notextile></div>

<p><a href="http://segmentfault.com/q/1010000002221288">从 github 执行 git pull 的时候提示 error: RPC failed</a>里面说可能是buffer设得太小，也可能是最近github不稳定造成的，反正我没改啥，再做一次就成功了，仰天长笑！！<br />
顺便记下设置postBuffer的语名<code>git config --global http.postBuffer 524288000</code><br /><br /></p>

<p>最后，当然是deploy successful了，而且，速度挺快<br />
感谢baidu.<br /></p>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[登泰山]]></title>
    <link href="http://lomozm.github.io/blog/20141219/deng-tai-shan/"/>
    <updated>2014-12-19T22:08:08+08:00</updated>
    <id>http://lomozm.github.io/blog/20141219/deng-tai-shan</id>
    <content type="html"><![CDATA[<p>来这个项目之前，就是希望能一睹泰山风采，体验五岳之首的气魄。工作关系，每天都可以在厕所的窗户边正远望之，好象也没有哈特别之处<br /><br />
泰安市以前叫泰山市，估计全市人口也就30来万，整个城市依山而建，居于山的东面，重化工和旅游业是支柱，消费较低，面食为主，偏咸，平均房价3K左右，依山别墅20K+<br /><br />
<!-- more -->
泰山的海拔好象1543米（后面2位不精确，以国家统计局为准），向东是一望无际的平原，西面则是尾山，唯独泰山最大，最宽阔雄伟。也就是说爬上泰山基本上就结束了，上面可玩的很少，除了享受爬山过程也就是看看日出，其它还真想出来啥。差点忘了，伟人们在石壁上的涂鸦，我们现代人称之文化，这个还真不少，什么狂草，正楷，就是没有word里最熟悉的仿宋，实在有点遗憾，本来想我写几个字上去，还是仿宋体，又怕别人说我乱写乱画，人品拉低，哎！谁叫我不是伟人呢，太失败了<br /><br /></p>

<h4 id="section">第1次</h4>
<p>上山完全使用现代交通工具<br />
9：30 先乘出租车到**地方（忘记了）<br />
10：00 再乘大巴车到中天门<br />
10：40 乘索道至南天门<br />
11：00 到达山顶，在山顶晃到<br />
11：40 饿了，买了大饼（15块）和羊牛汤（40块）还有碗面（15块）<br />
12：20 到另个山头，给老婆电话<br />
13：00 乘索道下山，乘车回来<br />
13：40 到山下，很难打到车，走了1个多少时进入市区<br />
15：40 到处住<br /><br /></p>

<h4 id="section-1">第2次</h4>
<p>徒步+拐杖上山，交通工具下山，3人共背红牛6瓶，士力架15个，矿泉水3瓶，手电筒1个，1小瓶二锅头，防身小刀1把，帽子、围巾、手套都不能少的<br />
00：00 起床<br />
00：40 上出租<br />
01：10 到山脚下，小吉取了点钱，买了拐杖（3块1个），简易口罩（1块1个）<br />
01：20 正式开始，还好有天气好，月光很强；手电可以不用，但是有些地方的阶梯还是要注意；走了大概十几分钟，看到前面有人开着手电登山，很快被我们超越<br />
03：10 就这样超过几波人后，我们到了中天门，风很大，还有4、5个在歇脚，补充了些能量，继续前进，歇气太冷了<br />
03：25 到达登泰山的下半场，碰到的人也更多了，能看到了远处有灯光，还以为就是山顶，结果就是个小店；就这样到了传说中的十八盘，并且还糊涂的过了，又看到了灯光，结果还是小店<br />
04：40 最后到南天门才发现上面居然没有灯光，那风真大，直接可以把衣服吹透的那种；我们打算去找在山上住的同事，结果人家要360块每人，然后我们就跟门卫磨，半小时后觉得太无聊了，就去下面租了军大衣10块每件（超推荐），主要是避风加等时间<br />
05：40 左右，外面的人多了起来，原来很多人出来看日出，我们也随大流去了<br />
06：20 到达看日出地方，占了个好位置，坐等之，结果发现我占那位置还不是最好的，又跑着换位置<br />
07：10 总算等到了，很漂亮，至少比在上海好看些<br />
07：20 发现小伙伴们都走丢了，搜寻中两波同事在山顶会师，高兴合影！！！<br /><br /></p>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[洛阳龙门石窟]]></title>
    <link href="http://lomozm.github.io/blog/20140310/luo-yang-long-men-shi-ku/"/>
    <updated>2014-03-10T15:32:18+08:00</updated>
    <id>http://lomozm.github.io/blog/20140310/luo-yang-long-men-shi-ku</id>
    <content type="html"><![CDATA[
<p>在郑州呆了个周末，项目组同事介绍去郑州市里逛，什么王府井、曼哈顿啥的，周五晚上通过google卫星地图发现很多都还在修，再说都是商务楼又不是去采购的话，一个人逛也太没劲了<br /><br />
然后搜了一下有没有啥一日游的，最后确定龙门石窟，原因嘛，谁叫我是个文艺青年呢<br /><br />
后面就是订车票，个人出去又不报销，选最便宜的火车票，快车单程1小时50分钟19.5元，现实中我发现快车晚点现象严重，两趟车都再少晚点20分钟～～<br /><br />
门票120元/人，淘宝网上有110块的价格，不过要3人以上才给送票，要不就得去某某地方取，我的神拉，打车票都不只10块了，果断选择现场买<br /><br />
<!-- more -->
洛阳比郑州要干净些，虽然树叶上也有些沙尘，街道上还有挺干净的<br /><br />
分享一篇游记，<a href="http://www.mafengwo.cn/i/1254213.html">山水之胜——龙门首焉</a>非常不错，图文并茂哦。至对相关知识极度困乏的我，感受就是一个人又没带相机的旅游真他X的无聊，虽然龙门石窟是个出照片的好地方<br /><br />
我最喜欢的两个雕塑<br /></p>

<h4 id="section">武士</h4>
<p><img src="http://lomozm.github.io/images/images/Travel/QQ20140310-3@2x.png" alt="001" /><br /></p>

<h4 id="section-1">菩萨</h4>
<p><img src="http://lomozm.github.io/images/images/Travel/QQ20140310-2@2x.png" alt="002" /><br />
<img src="http://lomozm.github.io/images/images/Travel/QQ20140310-1@2x.png" alt="003" /><br />
<br />
列一下出行的时间表吧<br />
4：50起床<br />
5：03从中方园出发<br />
5：20到达陈寨公交车站<br />
5：32乘上Y806公交车<br />
6：05到达郑州火车站<br />
6：20取票完全（本想改签6：40的车，因之前改签过一次，不能再改签）<br />
6：30进候车室3号<br />
7：25检票进入K329，10号车箱（车的始点站是天津，洛阳是终点站）<br />
7：45从郑州站出发，晚点27分钟（和旁边一哥们聊起，他说这车晚点很正常）<br />
8：47到巩义车站停靠<br />
9：24到达洛阳火车站<br />
9：34乘上K81路公交车去龙门石窟<br />
10：15到达终点站<br />
10：35检票进入景点<br />
12：44西山景点完成<br />
14：00坐上K81返回火车站<br />
14：58到达郑州火车站<br />
15：05改签票到15：50发车K1028<br />
16：10火车从洛阳站出发<br />
18：20到达郑州站<br />
19：05乘上B20公交车<br />
19：38到达丰庆路庙李站<br />
20：02到达住处中方园的205室<br /></p>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[为SAP ABAP编辑环境添加模式(pattern)]]></title>
    <link href="http://lomozm.github.io/blog/20140304/wei-sap-abapbian-ji-huan-jing-tian-jia-mo-shi-pattern/"/>
    <updated>2014-03-04T15:24:26+08:00</updated>
    <id>http://lomozm.github.io/blog/20140304/wei-sap-abapbian-ji-huan-jing-tian-jia-mo-shi-pattern</id>
    <content type="html"><![CDATA[
<h3 id="section">背景</h3>
<p>本文技术来源于<a href="http://scnblogs.techweb.com.cn/tcsapbw/archives/2515.html">edison_tc的&lt;【ABAP】创建ABAP Coding Pattern或Template&gt;</a>，只是再实现一遍，记录下来，以后有机会玩玩<br />
正如文中所说，分三种情况来实现，分别是：<br /></p>

<h4 id="pattern">1. 静态pattern</h4>
<p>直接在pattern中写入需要显示内容，在编辑器中显示的与之一致<br /></p>

<h4 id="pattern-1">2. 动态pattern</h4>
<p>接下来会详细介绍<br /></p>

<h4 id="template">3. template</h4>
<p>编辑器中自定义关键字，写代码时只需要输入关键字，系统自动把定义内容补上<br />
<!-- more --></p>

<h3 id="pattern-2">动态pattern实现</h3>
<p>考虑到每个报表的头部都要这部分，拷来拷去有点烦，就用这个了
1. 进入代码编辑环境，创建pattern<br />
<img src="http://lomozm.github.io/images/images/QQ20140304-1@2x.jpg" alt="01" /><br />
2. 输入交量<code>*$&amp;$EXIT</code>，然后保存<br />
<img src="http://lomozm.github.io/images/images/QQ20140304-2@2x.jpg" alt="02" /><br />
3. 找到出口：SEUED001，实现function：<code>EXIT_SAPLLOCAL_EDT1_001</code><br />
<img src="http://lomozm.github.io/images/images/QQ20140304-5@2x.jpg" alt="03" /><br />
<img src="http://lomozm.github.io/images/images/QQ20140304-6@2x.jpg" alt="04" /><br />
代码实例：<br /></p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
<span class="line-number">24</span>
<span class="line-number">25</span>
<span class="line-number">26</span>
<span class="line-number">27</span>
<span class="line-number">28</span>
<span class="line-number">29</span>
<span class="line-number">30</span>
<span class="line-number">31</span>
<span class="line-number">32</span>
<span class="line-number">33</span>
<span class="line-number">34</span>
<span class="line-number">35</span>
<span class="line-number">36</span>
<span class="line-number">37</span>
<span class="line-number">38</span>
<span class="line-number">39</span>
<span class="line-number">40</span>
<span class="line-number">41</span>
<span class="line-number">42</span>
<span class="line-number">43</span>
<span class="line-number">44</span>
<span class="line-number">45</span>
<span class="line-number">46</span>
<span class="line-number">47</span>
<span class="line-number">48</span>
<span class="line-number">49</span>
<span class="line-number">50</span>
<span class="line-number">51</span>
<span class="line-number">52</span>
</pre></td><td class="code"><pre><code class=""><span class="line">* BREAK lomozm.
</span><span class="line">
</span><span class="line">data: w_buffer type string,
</span><span class="line">l_note_line type string,
</span><span class="line">w_temp type string.
</span><span class="line">case keyword.
</span><span class="line">  when 'ZM01'.
</span><span class="line">    l_note_line = '*&amp;---------------------------------------------------------------------*"'
</span><span class="line">    append l_note_line to buffer.
</span><span class="line">    w_buffer = '*&amp; Responsibility'.
</span><span class="line">    append w_buffer to buffer.
</span><span class="line">	append l_note_line to buffer.
</span><span class="line">    w_buffer = '* Program Name:'.
</span><span class="line">    concatenate w_buffer sy-title into w_buffer separated by space.
</span><span class="line">    append w_buffer to buffer.
</span><span class="line">    w_buffer = '* Date written:'.
</span><span class="line">    concatenate w_buffer sy-datum into w_buffer separated by space.
</span><span class="line">    append w_buffer to buffer.
</span><span class="line">    w_buffer = '* Author''s name:'
</span><span class="line">    concatenate w_buffer sy-uname into w_buffer separated by space.
</span><span class="line">    append w_buffer to buffer.
</span><span class="line">    w_buffer = '* Last update:'.
</span><span class="line">    concatenate w_buffer sy-datum into w_buffer separated by space.
</span><span class="line">    append w_buffer to buffer.
</span><span class="line">    w_buffer = '* Project Name:'.
</span><span class="line">    append w_buffer to buffer.
</span><span class="line">    w_buffer = '* Version:1.0'.
</span><span class="line">    append w_buffer to buffer.
</span><span class="line">	
</span><span class="line">	append l_note_line to buffer.
</span><span class="line">    w_buffer = '* Description: (Incl. Related Function Area and System)'.
</span><span class="line">    append w_buffer to buffer.
</span><span class="line">	append l_note_line to buffer.
</span><span class="line">    w_buffer = '*'.
</span><span class="line">    append w_buffer to buffer.
</span><span class="line">	
</span><span class="line">	append l_note_line to buffer.
</span><span class="line">	w_buffer = '* Change History'.
</span><span class="line">    append w_buffer to buffer.
</span><span class="line">	append l_note_line to buffer.
</span><span class="line">	w_buffer = '*     Date   |   Programmer   |   Corr. #   |   Description'.
</span><span class="line">    append w_buffer to buffer.
</span><span class="line">	concatenate '*  ' sy-datum '  |    ' sy-uname(12) '|    @@@@@    |   create' 
</span><span class="line">		into w_buffer  RESPECTING BLANKS.
</span><span class="line">    append w_buffer to buffer.
</span><span class="line">	w_buffer = '*            |                |             |'.
</span><span class="line">    append w_buffer to buffer.
</span><span class="line">	append l_note_line to buffer.
</span><span class="line">	
</span><span class="line">  when others.
</span><span class="line">* Do nothing
</span><span class="line">endcase.</span></code></pre></td></tr></table></div></figure></notextile></div>

<ol>
  <li>在编辑环境选择自建的pattern<br />
<img src="http://lomozm.github.io/images/images/QQ20140304-3@2x.jpg" alt="05" /><br /></li>
  <li>效果<br />
<img src="http://lomozm.github.io/images/images/QQ20140304-4@2x.jpg" alt="06" /><br /></li>
</ol>

<h3 id="section-1">后记</h3>
<p>个人觉得template还是很有用的，主要是每次改程序的时候都要用begin/end之类的，自己建一个template是个不错的选择<br /></p>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[为Report选择屏幕添加事件按钮]]></title>
    <link href="http://lomozm.github.io/blog/20140227/wei-reportxuan-ze-ping-mu-tian-jia-gong-neng-an-niu/"/>
    <updated>2014-02-27T16:28:30+08:00</updated>
    <id>http://lomozm.github.io/blog/20140227/wei-reportxuan-ze-ping-mu-tian-jia-gong-neng-an-niu</id>
    <content type="html"><![CDATA[
<p>以前也有用户要这个需求，就是运行程序的第一个屏幕添加其它的事件按钮，以实现对当前程序进行预操作，或者是功能补充。我用set PF-STATUS进行测试，发现程序进入选择屏幕后，不能捕捉到新增加的事件，也就作罢（说不能实现）；最近空闲一下，发现sap在选择屏幕可以加入function key功能可以实现<br />
<!-- more -->
<br />
先看效果:<br />
<img src="http://lomozm.github.io/images/images/QQ20140227-1@2x.jpg" alt="i001" /><br />
<br />
单击Create1或Create2时分别弹出:<br />
<img src="http://lomozm.github.io/images/images/QQ20140227-2@2x.jpg" alt="i002" /><br />
<img src="http://lomozm.github.io/images/images/QQ20140227-3@2x.jpg" alt="i003" /><br />
这样就可以在程序中分别实现不同功能<br />
<br />
源程序:<br /></p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
<span class="line-number">24</span>
<span class="line-number">25</span>
<span class="line-number">26</span>
<span class="line-number">27</span>
<span class="line-number">28</span>
<span class="line-number">29</span>
<span class="line-number">30</span>
<span class="line-number">31</span>
<span class="line-number">32</span>
<span class="line-number">33</span>
<span class="line-number">34</span>
<span class="line-number">35</span>
<span class="line-number">36</span>
<span class="line-number">37</span>
<span class="line-number">38</span>
<span class="line-number">39</span>
<span class="line-number">40</span>
<span class="line-number">41</span>
<span class="line-number">42</span>
<span class="line-number">43</span>
<span class="line-number">44</span>
<span class="line-number">45</span>
<span class="line-number">46</span>
<span class="line-number">47</span>
<span class="line-number">48</span>
<span class="line-number">49</span>
<span class="line-number">50</span>
<span class="line-number">51</span>
<span class="line-number">52</span>
<span class="line-number">53</span>
<span class="line-number">54</span>
<span class="line-number">55</span>
<span class="line-number">56</span>
<span class="line-number">57</span>
<span class="line-number">58</span>
<span class="line-number">59</span>
<span class="line-number">60</span>
<span class="line-number">61</span>
<span class="line-number">62</span>
<span class="line-number">63</span>
<span class="line-number">64</span>
<span class="line-number">65</span>
<span class="line-number">66</span>
<span class="line-number">67</span>
<span class="line-number">68</span>
<span class="line-number">69</span>
<span class="line-number">70</span>
<span class="line-number">71</span>
<span class="line-number">72</span>
<span class="line-number">73</span>
<span class="line-number">74</span>
</pre></td><td class="code"><pre><code class=""><span class="line">report  ztest12 no standard page heading
</span><span class="line">                               line-size 132
</span><span class="line">                               line-count 65
</span><span class="line">                               message-id z001.
</span><span class="line">
</span><span class="line">*&amp;---------------------------------------------------------------------*
</span><span class="line">*&amp; Report  ZTEST1
</span><span class="line">*&amp;
</span><span class="line">*&amp;---------------------------------------------------------------------*
</span><span class="line">*&amp;
</span><span class="line">*&amp;å
</span><span class="line">*&amp;---------------------------------------------------------------------*
</span><span class="line">tables: sscrfields.
</span><span class="line">type-pools: icon,vrm.
</span><span class="line">data functxt type smp_dyntxt.
</span><span class="line">
</span><span class="line">selection-screen: function key 1,
</span><span class="line">                  function key 2. "此为两个触点定义
</span><span class="line">
</span><span class="line">selection-screen: begin of block 1 with frame.
</span><span class="line">
</span><span class="line">parameters: p_list type c as listbox visible length 10.
</span><span class="line">
</span><span class="line">selection-screen: end of block 1.
</span><span class="line">
</span><span class="line">initialization.
</span><span class="line">
</span><span class="line">  functxt-icon_id = icon_create.
</span><span class="line">  functxt-icon_text = 'Create1'.
</span><span class="line">  sscrfields-functxt_01 = functxt.
</span><span class="line">
</span><span class="line">  functxt-icon_id = '@0V@'.
</span><span class="line">  functxt-icon_text = 'Create2'.
</span><span class="line">  functxt-quickinfo = 'Create new'.
</span><span class="line">  sscrfields-functxt_02 = functxt.
</span><span class="line">
</span><span class="line">  clear: p_list.
</span><span class="line">  perform selectlist changing p_list.
</span><span class="line">
</span><span class="line">
</span><span class="line">at selection-screen.
</span><span class="line">  case sscrfields-ucomm.
</span><span class="line">    when 'FC01'.
</span><span class="line">      clear p_list.
</span><span class="line">      message 'Create1' type 'I'.
</span><span class="line">    when 'FC02'.
</span><span class="line">      message 'Create2' type 'I'.
</span><span class="line">  endcase.
</span><span class="line">
</span><span class="line">end-of-selection.
</span><span class="line">
</span><span class="line">*&amp;---------------------------------------------------------------------*
</span><span class="line">*&amp;      Form  selectlist
</span><span class="line">*&amp;---------------------------------------------------------------------*
</span><span class="line">*       text
</span><span class="line">*----------------------------------------------------------------------*
</span><span class="line">*      --&gt;P_LIST     text
</span><span class="line">*----------------------------------------------------------------------*
</span><span class="line">form selectlist changing p_list.
</span><span class="line">  data: it_list type vrm_values,
</span><span class="line">  wa_list like line of it_list.
</span><span class="line">  wa_list-key = '01'.
</span><span class="line">  wa_list-text = '普通领料'.
</span><span class="line">  append wa_list to it_list.
</span><span class="line">  wa_list-key = '02'.
</span><span class="line">  wa_list-text = '批次领料'.
</span><span class="line">  append wa_list to it_list.
</span><span class="line">
</span><span class="line">  call function 'VRM_SET_VALUES'
</span><span class="line">    exporting
</span><span class="line">      id     = 'P_LIST'
</span><span class="line">      values = it_list.
</span><span class="line">  refresh it_list.
</span><span class="line">endform.                    "selectlist</span></code></pre></td></tr></table></div></figure></notextile></div>

<p><br />
最后是程序说明:<br />
1. selection-screen: function key最多可以定义5个，否则系统语法检查会出错<br />
2. FC01代码捕捉后如果没有clear p_list的话，系统会添加一条新数据<br />
3. <a href="http://help.sap.com/abapdocu_70/en/ABAPSELECTION-SCREEN_FUNCTIONKEY.htm">SAP系统help和demo</a><br /></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[使用ABAP MEMORY与SAP MEMORY讨论]]></title>
    <link href="http://lomozm.github.io/blog/20140227/shi-yong-abap-memoryyu-sap-memory/"/>
    <updated>2014-02-27T14:07:08+08:00</updated>
    <id>http://lomozm.github.io/blog/20140227/shi-yong-abap-memoryyu-sap-memory</id>
    <content type="html"><![CDATA[
<h3 id="br">术语<br /></h3>

<h5 id="sap-memoryabap-memory">SAP Memory/ABAP Memory：</h5>
<p>为实现数据传递，SAP系统在服务器分配的内存空间，其分配的区域不同 <br /></p>

<h5 id="user-session">User Session:</h5>
<p>用户登录系统时产生，用户登陆一次产生一个<br /></p>

<h5 id="external-session">External Session：</h5>
<p>也称main session，用户开启的一个窗口对应一个external session；其中一个logon user session中可以最大6个external session<br /></p>

<h5 id="internal-session">Internal Session：</h5>
<p>程序运行中，系统为程序分配的session，一个程序可以分配多个internal session，也可能只有一个session，一个external session中最大可以使用20个Internal session<br />
<!-- more -->
User Session、External Session与Internal Session关系图：<br />
<img src="http://lomozm.github.io/images/images/ABAPMemoryAndSAPMemory/image002.gif" alt="i001" /><br />
<br /></p>

<h3 id="section">技术背景</h3>

<h4 id="section-1">总览</h4>
<p>ABAP开发过程中，常需要在session之进行数据传递和共享，SAP提供了两种技术来实现它：SAP Memory和ABAP Memory<br />
一个external session对应着一个ABAP session，所以，一个window里的internal session共用着同一个ABAP session；所以，在一个user logon session中不同的window(external session)共同使用一个SAP memory<br />
SAP Memory、ABAP Memory、Main Session与Internal Session关系图：<br />
<img src="http://lomozm.github.io/images/images/ABAPMemoryAndSAPMemory/image004.gif" alt="i002" /><br /></p>

<h4 id="section-2">区别</h4>

<h5 id="section-3">1、读取和使用方法不同</h5>
<p>SAP内存使用<code>SET/GET parameters</code>方法：<br /></p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
</pre></td><td class="code"><pre><code class=""><span class="line">&lt;!--StartFragment --&gt;SET PARAMETER ID 'MAT' FIELD P_MATNR.
</span><span class="line">GET PARAMETER ID 'MAT' FIELD P_MATNR.</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>ABAP内存使用<code>EXPORT/IMPORT</code>方法：<br /></p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
</pre></td><td class="code"><pre><code class=""><span class="line">&lt;!--StartFragment --&gt;EXPORT P_MATNR = P_MATNR TO MEMORY ID 'ZTESTMAT'.
</span><span class="line">IMPORT P_MATNR = P_MATNR FROM MEMORY ID 'ZTESTMAT'</span></code></pre></td></tr></table></div></figure></notextile></div>

<h5 id="section-4">2、共享范围不同</h5>
<p>SAP内存可以被所有的主session访问，内存数据可以在同一个session中不同程序之间，或者不同session之间共享数据；<br />
ABAP内存只能在同个session的不同程序之间共享数据；<br /></p>

<h5 id="section-5">3、作用范围不同</h5>
<p>SAP内存在整个终端session时间内都有效；<br />
ABAP内存只能在一个session时间内有效；<br /></p>

<h5 id="section-6">4、使用一般原则</h5>
<p>SAP内存用于屏幕默认值输入；<br />
ABAP内存用于模块之间传递数据<br /></p>

<h3 id="section-7">难点分析</h3>

<h4 id="link-program">LINK PROGRAM介绍</h4>
<p>使用ABAP/SAP Memory，是因为它们可以在SAP中充当着“数据存储器”的作用，就比如DB、File等，同时程序中，因为我们大量地使用着Link program，所以为了数据的共享或者传递。<br />
首先简要地总结一下Link program。从大类上来分，主要可以通过以下的图示表述:<br />
<img src="http://lomozm.github.io/images/images/ABAPMemoryAndSAPMemory/image006.gif" alt="i003" /><br />
说明：<br />
“被调用程序插入型”是指：调用程序(calling program)并不结束，当遇到Link 语句时，会去执行被调用程序(called program)，当被调用程序结束后，调用程序继续执行;<br />
“调用程序中止型”是指：调用程序(calling program)当遇到Link 语句时会中止，然后去执行被调用程序(called program)<br /></p>

<h4 id="link-programmemorybr">LINK PROGRAM与MEMORY的关系<br /></h4>

<h5 id="fm">1、对于FM:</h5>
<p>当一个FM被调用时，它对应的Function Group被load进当前的这个 internal session，当其处理完了，calling program继续被处理;(该Function Group下的global data可以继续被使用).<br /></p>

<h5 id="call-transactionsubmit-and-return">2、对于CALL TRANSACTION或SUBMIT AND RETURN</h5>
<p>当运行到这种情况时，系统会重新运行一个internal session,当called program结束后(也可以是使用leave program)，这个internal session会被delete掉，然后calling program继续运行.<br /></p>

<h5 id="submit">3、对于SUBMIT</h5>
<p>当运行到这种情况时，calling program从当前的internal session中被移走，而called program被load进这个internal session.<br /></p>

<h5 id="leave-to-transaction">4、对于LEAVE TO TRANSACTION</h5>
<p>当运行到这种情况时，当前External session中的所有internal session被清掉，而called transaction将会在该external session中新开一个internal session;<br />
另外，该种情况下，该external session所对应的ABAP memory将会被initialize,所以这种情况下，我们不能使用ABAP memory来传递数据，而应该使用SAP Memory;<br /></p>

<h5 id="link-program-1">5、异步的LINK PROGRAM:</h5>
<p>当遇到这种FM时，将会重新打开一个external session,它并行地、独立于当前的external session.<br />
<br /></p>

<h3 id="section-8">思路或想法</h3>
<p>在同一个external session的Link program我们使用ABAP Memory进行传递数据<br />
而在不同的external session间的Link program我们使用SAP Memory进行数据传递。很多时候并不是像ABAP Memory那样直接在程序中完成了Set与Get方法；相反，一般是将其绑定给某一Data element(并激活着Set与Get方法)，从而任何其他程序使用了该Data element的地方都将会有“default”值，也就是说在一个地方的data element的改变会影响其他地方，从而也就达到了数据传递的效果；我们自己在开发Dynpro的程序时，有时候根据实际的需求，也会勾选某些 element的SPA/GPA属性(在SE51 Screen Painter中); 其实，这也是SAP标准所采用的技术<br />
对于FM而言，因为它依附于Function Group，所以，一般如果我们使用FM需要数据传递或者共享的话(除了FM自己的import/export/table外)，我们是使用Function Group的全局变量<br />
<br /></p>

<h3 id="section-9">解决方案与系统实现</h3>

<h4 id="abap-memory">ABAP MEMORY实例</h4>

<h5 id="section-10">主要任务</h5>
<p>程序1： ZTEST_ABAP_MEM_PROG1——将数据写入ABAP内存
1、清空该memory ID
2、向memory ID传递一个<code>work area</code>
3、向memory ID传递一个<code>Internal table</code>
4、向memory ID传递一个<code>Parameter</code></p>

<p>程序2： ZTEST_ABAP_MEM_PROG2——从ABAP内存取出数据
1、从memory ID取得一个<code>work area</code>
2、从memory ID取得一个<code>Internal table</code>
3、从memory ID取得一个<code>Parameter并同时赋给选择屏幕上的<code>parameter</code></code></p>

<h5 id="section-11">程序代码</h5>
<p>ZTEST_ABAP_MEM_PROG1</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
<span class="line-number">24</span>
<span class="line-number">25</span>
<span class="line-number">26</span>
<span class="line-number">27</span>
<span class="line-number">28</span>
<span class="line-number">29</span>
</pre></td><td class="code"><pre><code class=""><span class="line">REPORT  ZTEST_ABAP_MEM_PROG1  No standard page heading  .
</span><span class="line"> 
</span><span class="line">*—Data &amp; Types
</span><span class="line">data:
</span><span class="line">  gs_scutom   type   scustom,
</span><span class="line">  gt_scustom  type  table of scustom,
</span><span class="line">  gv_para     type   char10.
</span><span class="line"> 
</span><span class="line">start-of-selection.
</span><span class="line"> 
</span><span class="line">*—Free Memory
</span><span class="line">  Free memory ID ‘TEST1′.
</span><span class="line">*—Retrieve data
</span><span class="line">*1. Get the structure
</span><span class="line">  select single * from scustom
</span><span class="line">    into gs_scutom
</span><span class="line">    where ID = ‘00000001′.
</span><span class="line">*2. Get the table
</span><span class="line">  select  * from scustom
</span><span class="line">    into table gt_scustom
</span><span class="line">    up to 10 rows
</span><span class="line">    where COUNTRY = ‘DE’.
</span><span class="line">*3. Set the parameter
</span><span class="line">   gv_para = ‘EDISON_TC’.
</span><span class="line">*4. Export to ABAP Memory
</span><span class="line">  Export  gs_scutom   gt_scustom   gv_para
</span><span class="line">  To Memory ID ‘TEST1′.
</span><span class="line">*5. Submit Program 2
</span><span class="line">  Submit ZTEST_ABAP_MEM_PROG2.</span></code></pre></td></tr></table></div></figure></notextile></div>

<p><br />
ZTEST_ABAP_MEM_PROG2</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
<span class="line-number">24</span>
<span class="line-number">25</span>
<span class="line-number">26</span>
<span class="line-number">27</span>
<span class="line-number">28</span>
<span class="line-number">29</span>
<span class="line-number">30</span>
<span class="line-number">31</span>
<span class="line-number">32</span>
<span class="line-number">33</span>
<span class="line-number">34</span>
<span class="line-number">35</span>
<span class="line-number">36</span>
<span class="line-number">37</span>
</pre></td><td class="code"><pre><code class=""><span class="line">REPORT  ZTEST_ABAP_MEM_PROG2  No standard page heading  .
</span><span class="line"> 
</span><span class="line"> *—Data &amp; Types
</span><span class="line"> data:
</span><span class="line">   gs_scutom   type   scustom,
</span><span class="line">   gt_scustom  type  table of scustom,
</span><span class="line">   gv_para     type   char10.
</span><span class="line"> 
</span><span class="line"> data:
</span><span class="line">   ls_scutom  type scustom.
</span><span class="line"> 
</span><span class="line"> parameter: p_para  type char10.
</span><span class="line"> 
</span><span class="line"> start-of-selection.
</span><span class="line"> *1. Get the data from ABAP Memory
</span><span class="line">   Import
</span><span class="line">     gs_scutom
</span><span class="line">     gt_scustom
</span><span class="line">     gv_para to p_para
</span><span class="line">   From Memory ID ‘TEST1′.
</span><span class="line"> 
</span><span class="line"> *2. Write the data
</span><span class="line">   write:/ ‘1. The structure:’,
</span><span class="line">           10, gs_scutom-id,
</span><span class="line">           20, gs_scutom-NAME,
</span><span class="line">           30, gs_scutom-COUNTRY.
</span><span class="line">   uline /(100).
</span><span class="line"> 
</span><span class="line">   write:/ ‘2. The table:’.
</span><span class="line">   Loop at gt_scustom into ls_scutom.
</span><span class="line">     write:/10 ls_scutom-id,
</span><span class="line">           20, ls_scutom-NAME,
</span><span class="line">           30, ls_scutom-COUNTRY.
</span><span class="line">   endloop.
</span><span class="line">   uline /(100).
</span><span class="line"> 
</span><span class="line">   write:/ ‘3. The parameter:’,p_para.</span></code></pre></td></tr></table></div></figure></notextile></div>

<p><br /></p>

<h4 id="sap-memory">SAP MEMORY实例</h4>
<p>不同于ABAP Memory，可以直接在程序中进行指定；对于SAP Memory，它其实是利用的是我们经常所说的SPA/GPA,也就是set parameter和get parameter；所以，这里首先得创建<code>parameter ID</code>;<br />
创建Parameter，我们一般是使用SE80 object Navigator来进行创建,它最长为20位；Parameter的数据是存于数据库表TPARA<br /></p>

<h5 id="section-12">主要任务</h5>
<p>程序1：ZTEST_SAP_MEMORY<em>1——存入数据至SAP Memory中<br /> 它是一个普通的Report程序，它只有一个parameter,但addition了一个parameter ID.然后F8执行会跳转到program 2<br />
程序2：ZTEST_SAP_MEMORY</em>1——把SAP Memory数据取出<br />
它是一个普通的Dynpro程序，它只有一个Screen,在这个Screen上面有一个<code>Input field</code>，同时该input field激活了SAP与GPA并指定了其<code>parameter ID</code>.当点击Application bar上的回到program1后会跳转到program 1<br />
  <br /></p>

<h5 id="section-13">程序代码</h5>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
</pre></td><td class="code"><pre><code class=""><span class="line">REPORT  ZTEST_SAP_MEMORY_1 NO STANDARD PAGE HEADING.
</span><span class="line"> *—PARAMETER
</span><span class="line">   PARAMETERS: p_spa type ZDELM_1 MEMORY ID ZPARA1.
</span><span class="line"> start-of-selection.
</span><span class="line"> *—USING SAP MEMORY
</span><span class="line"> *1. Leave to Transaction –&gt; program 2
</span><span class="line">   leave to TRANSACTION ‘ZSAP_MEM_2′.
</span><span class="line">   
</span><span class="line">   
</span><span class="line">   MODULE USER_COMMAND_0100 INPUT.
</span><span class="line">     CASE SY-UCOMM .
</span><span class="line">       WHEN ‘BACK’ or ‘%EX’ or ‘RW’.
</span><span class="line">         LEAVE to SCREEN 0.
</span><span class="line">       when ‘PROG1′.
</span><span class="line">         LEAVE to TRANSACTION ‘ZSAP_MEM_1′.
</span><span class="line">       WHEN OTHERS.
</span><span class="line">     ENDCASE.
</span><span class="line">   ENDMODULE.                 “ USER_COMMAND_0100  INPUT</span></code></pre></td></tr></table></div></figure></notextile></div>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[TextMate highlight for ABAP]]></title>
    <link href="http://lomozm.github.io/blog/20140220/textmate-highlight-for-abap/"/>
    <updated>2014-02-20T23:21:30+08:00</updated>
    <id>http://lomozm.github.io/blog/20140220/textmate-highlight-for-abap</id>
    <content type="html"><![CDATA[
<h3 id="section">背景</h3>
<p>想找到个在mac下的文本编缉器，后来找到textmate，听说是因为mac os x免费后，MacroMates也跟风开源了。准备以后用它来做abap开发，但是没有语法高亮的话，看起来就太不酷了（不能装B，大家懂的）<br />
 <!--more--></p>

<h3 id="section-1">效果</h3>
<p>闲话少说，看一下效果先<br />
<img src="http://lomozm.github.io/images/images/QQ20140220-2@2x.jpg" alt="001" /><br /></p>

<h3 id="section-2">过程</h3>
<ol>
  <li>下载<a href="http://lomozm.github.io/appendix/ABAP.tmLanguage">ABAP.tmLanguage</a>和<a href="http://lomozm.github.io/appendix/ABAP.textmate">ABAP.textmate</a>两文件到本地<br /></li>
  <li>先新建bundle，取名为ABAP，然后双击<code>ABAP.tmLanguage</code>文件安装，更新abap内容<br /></li>
  <li>进入bundle编器，将<code>ABAP.textmate</code>内容去覆盖原来的。原来的很多标签没加入进去，我进行了引些更改，又懒得改<code>ABAP.tmLanguage</code>文件<br />
<img src="http://lomozm.github.io/images/images/QQ20140221-1@2x.jpg" alt="002" /><br />
最后大功告成了，好好享受编程的乐子吧！！<br /></li>
</ol>

<h3 id="section-3">有用链接</h3>
<p><a href="https://github.com/pvl/abap.tmbundle">源始ABAP.tmLanguage文件下载</a><br />
<a href="http://wiki.macromates.com/Themes/UserSubmittedThemes">textmate和theme效果</a><br />
<a href="http://hiltmon.com/blog/2013/11/09/textmate-2-basics/">textmate基础知识</a><br /></p>

<h3 id="section-4">补充</h3>
<p>今天在目录<code>~/Library/Application Support/Avian/Bundles/</code>下找到了文件<a href="http://lomozm.github.io/appendix/ABAP.tmbundle">ABAP.tmbundle</a>，下载安装即可跳过之前的安装步骤</p>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[MIGO收货时报M3682错误(同一物料在同一批次被使用)]]></title>
    <link href="http://lomozm.github.io/blog/20140103/migoshou-huo-shi-bao-m3682cuo-wu-tong-%5B%3F%5D-wu-liao-zai-tong-%5B%3F%5D-pi-ci-bei-shi-yong/"/>
    <updated>2014-01-03T16:21:47+08:00</updated>
    <id>http://lomozm.github.io/blog/20140103/migoshou-huo-shi-bao-m3682cuo-wu-tong-[?]-wu-liao-zai-tong-[?]-pi-ci-bei-shi-yong</id>
    <content type="html"><![CDATA[
<h3 id="section">场景</h3>
<p>用户在使用migo收货时，发现同一物料同一批次不能同时处理，错误消息是：物料###的批次##被用户##锁定<br /></p>

<h3 id="section-1">解决方法</h3>
<p>见notes:1523750 - MIGO: Message M3682 during goods movement to same batch<br />
使用badi: BATCH_MASTER<br />
method: <code>LOCK_BATCH_MASTER_IN_MIGO</code><br />
<!--more--></p>

<p>注意：<br />
1. notes中关于版本的描述，打这个notes时，相关notes也必须打上<br />
2. 锁数据查看事务代码：sm12<br />
3. badi调用的函数：<code>VB_ENQUEUE_BATCH</code><br /></p>

<h3 id="section-2">出口代码</h3>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
<span class="line-number">24</span>
<span class="line-number">25</span>
<span class="line-number">26</span>
<span class="line-number">27</span>
<span class="line-number">28</span>
<span class="line-number">29</span>
<span class="line-number">30</span>
<span class="line-number">31</span>
<span class="line-number">32</span>
<span class="line-number">33</span>
<span class="line-number">34</span>
<span class="line-number">35</span>
<span class="line-number">36</span>
<span class="line-number">37</span>
<span class="line-number">38</span>
<span class="line-number">39</span>
<span class="line-number">40</span>
<span class="line-number">41</span>
<span class="line-number">42</span>
<span class="line-number">43</span>
<span class="line-number">44</span>
<span class="line-number">45</span>
<span class="line-number">46</span>
<span class="line-number">47</span>
<span class="line-number">48</span>
<span class="line-number">49</span>
<span class="line-number">50</span>
<span class="line-number">51</span>
<span class="line-number">52</span>
<span class="line-number">53</span>
<span class="line-number">54</span>
<span class="line-number">55</span>
<span class="line-number">56</span>
<span class="line-number">57</span>
<span class="line-number">58</span>
<span class="line-number">59</span>
</pre></td><td class="code"><pre><code class=""><span class="line">method IF_EX_BATCH_MASTER~LOCK_BATCH_MASTER_IN_MIGO.
</span><span class="line">
</span><span class="line">  data: it_sel type TABLE OF seqg3,
</span><span class="line">        wa_sel type seqg3,
</span><span class="line">        it_enq type table of seqg3,
</span><span class="line">        wa_enq type seqg3.
</span><span class="line">
</span><span class="line">  data: gname    type  seqg3-gname.
</span><span class="line">  data: garg     type  seqg3-garg.
</span><span class="line">  data: gtarg    type  seqg3-gtarg.
</span><span class="line">  data: guname   type  seqg3-guname.
</span><span class="line">  data: gclient  type  seqg3-gclient.
</span><span class="line">  data: subrc type i.
</span><span class="line">*
</span><span class="line">  if sy-tcode eq 'MIGO'.  "事务代码判断
</span><span class="line">
</span><span class="line">    gname   = 'MCH1'.   "锁定的表
</span><span class="line">    guname  = ''. "sy-uname.  “如果不指定用户，系统默认当前用户，就不能解锁其它用户锁定的数据，所以指定为空
</span><span class="line">    gclient = sy-mandt.
</span><span class="line">    concatenate gclient i_matnr i_charg into garg.  "锁定的对象
</span><span class="line">*读取锁定数据
</span><span class="line">    CALL FUNCTION 'ENQUEUE_READ'
</span><span class="line">      EXPORTING
</span><span class="line">        gclient               = gclient
</span><span class="line">        guname                = guname
</span><span class="line">        gname                 = gname
</span><span class="line">      IMPORTING
</span><span class="line">        subrc                 = subrc
</span><span class="line">      TABLES
</span><span class="line">        enq                   = it_enq
</span><span class="line">      EXCEPTIONS
</span><span class="line">        communication_failure = 2
</span><span class="line">        others                = 1.
</span><span class="line">    if sy-subrc = 0.
</span><span class="line">      C_LOCK_MODE = 'S'.  "更改排它锁为共享锁
</span><span class="line">
</span><span class="line">      delete it_enq where garg ne garg and gmode eq C_LOCK_MODE.
</span><span class="line">
</span><span class="line">      if it_enq is not initial.
</span><span class="line">*删除锁定数据
</span><span class="line">        CALL FUNCTION 'ENQUE_DELETE'
</span><span class="line">          EXPORTING
</span><span class="line">            check_upd_requests = 1
</span><span class="line">          IMPORTING
</span><span class="line">            subrc              = subrc
</span><span class="line">          TABLES
</span><span class="line">            enq                = it_enq.
</span><span class="line">
</span><span class="line">        if subrc eq 0.
</span><span class="line">          clear it_enq.
</span><span class="line">        endif.
</span><span class="line">      endif.
</span><span class="line">    elseif sy-subrc = 2.
</span><span class="line">      exit.
</span><span class="line">    endif.
</span><span class="line">
</span><span class="line">  ENDIF.
</span><span class="line">
</span><span class="line">endmethod.</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>其它有用的链接<br />
<a href="http://help.sap.com/saphelp_erp60_sp/helpdata/en/02/e0b24188b3e534e10000000a1550b0/content.htm">http://help.sap.com/saphelp_erp60_sp/helpdata/en/02/e0b24188b3e534e10000000a1550b0/content.htm</a><br /></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[EVAL_FORMULA 公式计算测试]]></title>
    <link href="http://lomozm.github.io/blog/20131230/eval-formula-gong-shi-ji-suan-ce-shi/"/>
    <updated>2013-12-30T16:36:25+08:00</updated>
    <id>http://lomozm.github.io/blog/20131230/eval-formula-gong-shi-ji-suan-ce-shi</id>
    <content type="html"><![CDATA[
<h3 id="section">应用场景</h3>
<p>当客户需要的报表逻辑较复杂，同一种类的数据进行数据运算，或者再累计计算，或者排除等；如果在程序中写死的话，业务的变更会导致程序的变更，使维持工作量加大<br />
SAP提供了一个函数，使报表运算过程可配置，提高了开发的灵活性<br />
<!--more--></p>

<h3 id="section-1">表定义</h3>
<p><img src="http://lomozm.github.io/images/images/EVAL_FORMULA_test.files/image001.png" alt="m001" /></p>

<h3 id="section-2">值输入</h3>
<p><img src="http://lomozm.github.io/images/images/EVAL_FORMULA_test.files/image003.png" alt="m002" /></p>

<h3 id="section-3">输出结果</h3>
<p><img src="http://lomozm.github.io/images/images/EVAL_FORMULA_test.files/image005.png" alt="m003" /></p>

<h3 id="section-4">程序代码</h3>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
<span class="line-number">24</span>
<span class="line-number">25</span>
<span class="line-number">26</span>
<span class="line-number">27</span>
<span class="line-number">28</span>
<span class="line-number">29</span>
<span class="line-number">30</span>
<span class="line-number">31</span>
<span class="line-number">32</span>
<span class="line-number">33</span>
<span class="line-number">34</span>
<span class="line-number">35</span>
<span class="line-number">36</span>
<span class="line-number">37</span>
<span class="line-number">38</span>
<span class="line-number">39</span>
<span class="line-number">40</span>
<span class="line-number">41</span>
<span class="line-number">42</span>
<span class="line-number">43</span>
<span class="line-number">44</span>
<span class="line-number">45</span>
<span class="line-number">46</span>
<span class="line-number">47</span>
<span class="line-number">48</span>
<span class="line-number">49</span>
<span class="line-number">50</span>
<span class="line-number">51</span>
<span class="line-number">52</span>
<span class="line-number">53</span>
<span class="line-number">54</span>
<span class="line-number">55</span>
<span class="line-number">56</span>
<span class="line-number">57</span>
<span class="line-number">58</span>
<span class="line-number">59</span>
<span class="line-number">60</span>
<span class="line-number">61</span>
<span class="line-number">62</span>
<span class="line-number">63</span>
<span class="line-number">64</span>
<span class="line-number">65</span>
<span class="line-number">66</span>
<span class="line-number">67</span>
<span class="line-number">68</span>
<span class="line-number">69</span>
<span class="line-number">70</span>
<span class="line-number">71</span>
<span class="line-number">72</span>
<span class="line-number">73</span>
<span class="line-number">74</span>
<span class="line-number">75</span>
<span class="line-number">76</span>
<span class="line-number">77</span>
<span class="line-number">78</span>
<span class="line-number">79</span>
<span class="line-number">80</span>
<span class="line-number">81</span>
<span class="line-number">82</span>
<span class="line-number">83</span>
<span class="line-number">84</span>
<span class="line-number">85</span>
<span class="line-number">86</span>
<span class="line-number">87</span>
<span class="line-number">88</span>
<span class="line-number">89</span>
<span class="line-number">90</span>
<span class="line-number">91</span>
<span class="line-number">92</span>
<span class="line-number">93</span>
<span class="line-number">94</span>
<span class="line-number">95</span>
<span class="line-number">96</span>
<span class="line-number">97</span>
<span class="line-number">98</span>
<span class="line-number">99</span>
<span class="line-number">100</span>
<span class="line-number">101</span>
<span class="line-number">102</span>
<span class="line-number">103</span>
<span class="line-number">104</span>
<span class="line-number">105</span>
<span class="line-number">106</span>
<span class="line-number">107</span>
<span class="line-number">108</span>
<span class="line-number">109</span>
<span class="line-number">110</span>
<span class="line-number">111</span>
<span class="line-number">112</span>
<span class="line-number">113</span>
<span class="line-number">114</span>
<span class="line-number">115</span>
<span class="line-number">116</span>
<span class="line-number">117</span>
<span class="line-number">118</span>
<span class="line-number">119</span>
<span class="line-number">120</span>
<span class="line-number">121</span>
<span class="line-number">122</span>
<span class="line-number">123</span>
<span class="line-number">124</span>
<span class="line-number">125</span>
<span class="line-number">126</span>
<span class="line-number">127</span>
<span class="line-number">128</span>
<span class="line-number">129</span>
<span class="line-number">130</span>
<span class="line-number">131</span>
<span class="line-number">132</span>
<span class="line-number">133</span>
<span class="line-number">134</span>
<span class="line-number">135</span>
<span class="line-number">136</span>
<span class="line-number">137</span>
<span class="line-number">138</span>
<span class="line-number">139</span>
<span class="line-number">140</span>
</pre></td><td class="code"><pre><code class=""><span class="line">*&amp;---------------------------------------------------------------------*
</span><span class="line">*&amp; Report  ZTEST03
</span><span class="line">*&amp; 公式计算测试
</span><span class="line">*&amp;---------------------------------------------------------------------*
</span><span class="line">*&amp;
</span><span class="line">*&amp;
</span><span class="line">*&amp;---------------------------------------------------------------------*
</span><span class="line">
</span><span class="line">REPORT  ZTEST03.
</span><span class="line">TYPE-POOLS:  slis.
</span><span class="line">TABLES: ZTEST03_TB.
</span><span class="line">
</span><span class="line">DATA: w_repid LIKE sy-repid,
</span><span class="line">   w_title TYPE lvc_title,
</span><span class="line">   tb_fieldcat TYPE slis_t_fieldcat_alv WITH HEADER LINE,
</span><span class="line">   wa_fields TYPE LINE OF slis_t_fieldcat_alv,
</span><span class="line">   tb_events TYPE slis_t_event WITH HEADER LINE,
</span><span class="line">   wa_layout   TYPE lvc_s_layo,
</span><span class="line">   wa_is_layout     TYPE slis_layout_alv.
</span><span class="line">DATA: gs_layout   TYPE lvc_s_layo.
</span><span class="line">
</span><span class="line">DATA: IT_TAB TYPE TABLE OF ZTEST03_TB WITH HEADER LINE.
</span><span class="line">DATA: IT_TAB2 TYPE TABLE OF ZTEST03_TB WITH HEADER LINE.
</span><span class="line">
</span><span class="line">START-OF-SELECTION.
</span><span class="line">
</span><span class="line">  REFRESH: IT_TAB, IT_TAB2.
</span><span class="line">  SELECT * INTO TABLE IT_TAB FROM ZTEST03_TB.
</span><span class="line">  IT_TAB2[] = IT_TAB[].
</span><span class="line">  LOOP AT IT_TAB WHERE CHAR02 IS NOT INITIAL.
</span><span class="line">    PERFORM FRM_CALCULATE_VALUE USING IT_TAB-DATA1
</span><span class="line">                                      IT_TAB-CHAR02.
</span><span class="line">
</span><span class="line">    MODIFY IT_TAB.
</span><span class="line">  ENDLOOP.
</span><span class="line">
</span><span class="line">END-OF-SELECTION.
</span><span class="line">  PERFORM append_alv USING 'NUMBE' '行号'.
</span><span class="line">  PERFORM append_alv USING 'CHAR01' '标识组1'.
</span><span class="line">  PERFORM append_alv USING 'CHAR02' '标识组2'.
</span><span class="line">  PERFORM append_alv USING 'DATA1' '值'.
</span><span class="line">  PERFORM append_alv USING 'MEINS' '单位'.
</span><span class="line">
</span><span class="line">perform display_alv tables it_tab.
</span><span class="line">
</span><span class="line">
</span><span class="line">FORM append_alv USING value(fieldname) TYPE c
</span><span class="line">                    value(fieldtxt) TYPE c.
</span><span class="line">  tb_fieldcat-fieldname    = fieldname.
</span><span class="line">  tb_fieldcat-reptext_ddic = fieldtxt.
</span><span class="line">  APPEND tb_fieldcat.CLEAR  tb_fieldcat.
</span><span class="line">ENDFORM.                    "append_alv
</span><span class="line">
</span><span class="line">*&amp;---------------------------------------------------------------------*
</span><span class="line">*&amp;      Form  FRM_CALCULATE_VALUE
</span><span class="line">*&amp;---------------------------------------------------------------------*
</span><span class="line">*       text
</span><span class="line">*----------------------------------------------------------------------*
</span><span class="line">*      --&gt;P_ZVALUE   text
</span><span class="line">*      --&gt;P_ZJSGS    text
</span><span class="line">*----------------------------------------------------------------------*
</span><span class="line">FORM FRM_CALCULATE_VALUE USING P_ZVALUE
</span><span class="line">                               P_ZJSGS.
</span><span class="line">*  DATA: FORMEL TYPE FORMEL.
</span><span class="line">  DATA: FORMEL(255) TYPE C.
</span><span class="line">  DATA: G_REPID LIKE SY-REPID.
</span><span class="line">  DATA: L_CC TYPE F.
</span><span class="line">
</span><span class="line">  FORMEL = P_ZJSGS.
</span><span class="line">  G_REPID = SY-REPID.
</span><span class="line">* Work out formula
</span><span class="line">  CALL FUNCTION 'EVAL_FORMULA'
</span><span class="line">    EXPORTING
</span><span class="line">      FORMULA = FORMEL
</span><span class="line">      PROGRAM = G_REPID
</span><span class="line">      ROUTINE = 'FRM_VAR_GET'
</span><span class="line">*        UNIT_OF_MEASURE = 'RMB'
</span><span class="line">    IMPORTING
</span><span class="line">      VALUE   =  L_CC
</span><span class="line">    EXCEPTIONS
</span><span class="line">      OTHERS  = 1.
</span><span class="line">
</span><span class="line">  P_ZVALUE = L_CC.
</span><span class="line">ENDFORM.                    " FRM_CALCULATE_VALUE
</span><span class="line">*&amp;---------------------------------------------------------------------*
</span><span class="line">*&amp;      Form  FRM_VAR_GET
</span><span class="line">*&amp;---------------------------------------------------------------------*
</span><span class="line">*       text
</span><span class="line">*----------------------------------------------------------------------*
</span><span class="line">*      --&gt;VALUE(NAME)   text
</span><span class="line">*      --&gt;VALUE(VALUE)  text
</span><span class="line">*      --&gt;VALUE(SUBRC)  text
</span><span class="line">*----------------------------------------------------------------------*
</span><span class="line">FORM FRM_VAR_GET USING VALUE(NAME)
</span><span class="line">         CHANGING VALUE(VALUE)
</span><span class="line">                  VALUE(SUBRC).
</span><span class="line">  SUBRC = 0.
</span><span class="line">  VALUE = 0.
</span><span class="line">  READ TABLE IT_TAB2 WITH KEY CHAR01 = NAME.
</span><span class="line">  IF SY-SUBRC = 0.
</span><span class="line">    VALUE = IT_TAB2-DATA1.
</span><span class="line">  ELSE.
</span><span class="line">    VALUE = 1.
</span><span class="line">  ENDIF.
</span><span class="line">
</span><span class="line">ENDFORM.                    "FRM_VAR_GET
</span><span class="line">*&amp;---------------------------------------------------------------------*
</span><span class="line">*&amp;      Form  DISPLAY_ALV
</span><span class="line">*&amp;---------------------------------------------------------------------*
</span><span class="line">*       text
</span><span class="line">*----------------------------------------------------------------------*
</span><span class="line">*      --&gt;P_IT_DATA  text
</span><span class="line">*----------------------------------------------------------------------*
</span><span class="line">FORM DISPLAY_ALV  tables  P_IT_DATA.
</span><span class="line">  w_repid = sy-repid.
</span><span class="line">  wa_is_layout-colwidth_optimize = 'X'.     "adjust line width automatic
</span><span class="line">  wa_is_layout-min_linesize      =  100.    "
</span><span class="line">  wa_is_layout-zebra      =  'X'.    "
</span><span class="line">
</span><span class="line">  CALL FUNCTION 'REUSE_ALV_GRID_DISPLAY'
</span><span class="line">    EXPORTING
</span><span class="line">      i_callback_program       = w_repid
</span><span class="line">      is_layout                = wa_is_layout
</span><span class="line">      it_fieldcat              = tb_fieldcat[]
</span><span class="line">*      i_save                   = 'A'
</span><span class="line">*      it_events                = tb_events[]
</span><span class="line">*      i_callback_pf_status_set = 'SET_PF_STATUS'
</span><span class="line">*      I_CALLBACK_USER_COMMAND  = L_USER_COMMAND
</span><span class="line">    TABLES
</span><span class="line">      t_outtab                 = P_IT_DATA[]
</span><span class="line">    EXCEPTIONS
</span><span class="line">      program_error            = 1
</span><span class="line">      OTHERS                   = 2.
</span><span class="line">
</span><span class="line">  IF sy-subrc &lt;&gt; 0.
</span><span class="line">    MESSAGE ID sy-msgid TYPE sy-msgty NUMBER sy-msgno
</span><span class="line">           WITH sy-msgv1 sy-msgv2 sy-msgv3 sy-msgv4.
</span><span class="line">  ENDIF.
</span><span class="line">
</span><span class="line">ENDFORM.</span></code></pre></td></tr></table></div></figure></notextile></div>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[物料编码生成/校验增强（MM01）]]></title>
    <link href="http://lomozm.github.io/blog/20131227/wu-liao-bian-ma-sheng-cheng-slash-xiao-yan-zeng-qiang-%28mm01%29/"/>
    <updated>2013-12-27T16:37:25+08:00</updated>
    <id>http://lomozm.github.io/blog/20131227/wu-liao-bian-ma-sheng-cheng-slash-xiao-yan-zeng-qiang-(mm01)</id>
    <content type="html"><![CDATA[
<p>用事务代码MM01建物料时，物料号生成有两种方式，系统自动分配和用户指定<br />
客户要求比较复杂的情况下（如：编号与物料组有关联），系统提供了相应出口进行编号的生成和校验<br />
tcode: smod<br />
增强：<code>MGA00002</code>:物料主文档（工业）：编号分配<br />
<!--more-->
<img src="http://lomozm.github.io/images/images/79d709262d17ae188283ff911bf5e1a8.jpeg" alt="m001" /><br /></p>

<h3 id="section">相关增强</h3>
<p><img src="http://lomozm.github.io/images/images/1177fb9b1742db2696a12ae3eabae1e4.jpeg" alt="m002" /><br /></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[销售开票更改凭证抬头和行项目 - RV60AFZC]]></title>
    <link href="http://lomozm.github.io/blog/20131227/xiao-shou-kai-piao-geng-gai-ping-zheng-tai-tou-he-xing-xiang-mu-rv60afzc/"/>
    <updated>2013-12-27T13:56:31+08:00</updated>
    <id>http://lomozm.github.io/blog/20131227/xiao-shou-kai-piao-geng-gai-ping-zheng-tai-tou-he-xing-xiang-mu-rv60afzc</id>
    <content type="html"><![CDATA[<p>该增强用于在开票过程中定制凭证抬头和行项目信息<br />
直接在se80中更改即可<br />
<!--more--></p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
<span class="line-number">24</span>
<span class="line-number">25</span>
<span class="line-number">26</span>
<span class="line-number">27</span>
<span class="line-number">28</span>
<span class="line-number">29</span>
<span class="line-number">30</span>
<span class="line-number">31</span>
<span class="line-number">32</span>
<span class="line-number">33</span>
<span class="line-number">34</span>
<span class="line-number">35</span>
<span class="line-number">36</span>
<span class="line-number">37</span>
<span class="line-number">38</span>
<span class="line-number">39</span>
<span class="line-number">40</span>
<span class="line-number">41</span>
<span class="line-number">42</span>
<span class="line-number">43</span>
<span class="line-number">44</span>
<span class="line-number">45</span>
<span class="line-number">46</span>
<span class="line-number">47</span>
<span class="line-number">48</span>
<span class="line-number">49</span>
<span class="line-number">50</span>
<span class="line-number">51</span>
<span class="line-number">52</span>
<span class="line-number">53</span>
<span class="line-number">54</span>
<span class="line-number">55</span>
<span class="line-number">56</span>
<span class="line-number">57</span>
<span class="line-number">58</span>
<span class="line-number">59</span>
<span class="line-number">60</span>
<span class="line-number">61</span>
<span class="line-number">62</span>
<span class="line-number">63</span>
<span class="line-number">64</span>
<span class="line-number">65</span>
<span class="line-number">66</span>
<span class="line-number">67</span>
<span class="line-number">68</span>
<span class="line-number">69</span>
<span class="line-number">70</span>
<span class="line-number">71</span>
<span class="line-number">72</span>
<span class="line-number">73</span>
<span class="line-number">74</span>
<span class="line-number">75</span>
<span class="line-number">76</span>
<span class="line-number">77</span>
<span class="line-number">78</span>
<span class="line-number">79</span>
<span class="line-number">80</span>
<span class="line-number">81</span>
<span class="line-number">82</span>
<span class="line-number">83</span>
<span class="line-number">84</span>
<span class="line-number">85</span>
<span class="line-number">86</span>
<span class="line-number">87</span>
<span class="line-number">88</span>
<span class="line-number">89</span>
<span class="line-number">90</span>
<span class="line-number">91</span>
<span class="line-number">92</span>
<span class="line-number">93</span>
<span class="line-number">94</span>
<span class="line-number">95</span>
<span class="line-number">96</span>
<span class="line-number">97</span>
<span class="line-number">98</span>
<span class="line-number">99</span>
</pre></td><td class="code"><pre><code class=""><span class="line">***INCLUDE RV60AFZC.
</span><span class="line">
</span><span class="line">************************************************************************
</span><span class="line">*                                                                      *
</span><span class="line">* This include is reserved for user modifications                      *
</span><span class="line">* Forms for invoicing                                                  *
</span><span class="line">* The name of modification modules should begin with 'ZZ'.             *
</span><span class="line">*                                                                      *
</span><span class="line">************************************************************************
</span><span class="line">*       USEREXIT_NUMBER_RANGE_INV_DATE                                 *
</span><span class="line">*       USEREXIT_FILL_VBRK_VBRP                                        *
</span><span class="line">************************************************************************
</span><span class="line">
</span><span class="line">*---------------------------------------------------------------------*
</span><span class="line">*       FORM USEREXIT_NUMBER_RANGE_INV_DATE                           *
</span><span class="line">*---------------------------------------------------------------------*
</span><span class="line">*       This userexit can be used to determine the numberranges for   *
</span><span class="line">*       the internal document number. This userexit can be used when  *
</span><span class="line">*       the number_ranger should impact the invoice date via table    *
</span><span class="line">*       TVFKD.                                                        *
</span><span class="line">*       If this userexit is active the USEREXIT_NUMBER_RANGE is not   *
</span><span class="line">*       processed anymore, that means this userexit has priority.     *
</span><span class="line">*       US_RANGE_INTERN - internal number range                       *
</span><span class="line">*       This form is called from form LV60AU02 and LV60AU11           *
</span><span class="line">*---------------------------------------------------------------------*
</span><span class="line">form userexit_number_range_inv_date using us_range_intern.
</span><span class="line">
</span><span class="line">* Example: Number range from TVFK like in standard
</span><span class="line">* US_RANGE_INTERN = TVFK-NUMKI.
</span><span class="line">
</span><span class="line">endform.
</span><span class="line">
</span><span class="line">*---------------------------------------------------------------------*
</span><span class="line">*       FORM USEREXIT_FILL_VBRK_VBRP                                  *
</span><span class="line">*---------------------------------------------------------------------*
</span><span class="line">*       This userexit can be used to fill fields in VBRK and VBRP     *
</span><span class="line">*       Be aware, that at this time the work areas KUAGV KURGV        *
</span><span class="line">*       KUWEV and KUREV are not filled.                               *
</span><span class="line">*       This form is called from FORM VBRK_VBRP_FUELLEN.              *
</span><span class="line">*---------------------------------------------------------------------*
</span><span class="line">form userexit_fill_vbrk_vbrp.
</span><span class="line">
</span><span class="line">* Example: change Tax country
</span><span class="line">*{   INSERT         DEVK900070                                        1
</span><span class="line">*
</span><span class="line">*  主机销售业务VF01开票时（根据销售业务的产品组判断是否为主机销售业务：10 装载机类、11  平地机类、12 挖掘装载机类、13 矿用自卸车、14  其他整机类），
</span><span class="line">*查找销售订单行项目主机物料主数据中“销售组织数据2”中的“物料组2（MVGR2）”字段信息；查找销售订单行项目所对应的产品序列号（SERNR）；
</span><span class="line">*  替换VBRK-ZUONR字段内容为“物料组2（MVGR2）&amp;序列号（SERNR）“
</span><span class="line">
</span><span class="line">*
</span><span class="line">*if sy-uname eq ‘LOMOZM'.
</span><span class="line">**RETURN.
</span><span class="line">*BREAK-POINT.
</span><span class="line">*ENDIF.
</span><span class="line">
</span><span class="line">*data: lt_xvbrk like TABLE OF xvbrk WITH HEADER LINE.
</span><span class="line">*lt_xvbrk[] = xvbrk[].
</span><span class="line">
</span><span class="line">if vbak-spart eq '10' or vbak-spart eq '11' or vbak-spart eq '12' or vbak-spart eq '13' or vbak-spart eq '14'.
</span><span class="line">
</span><span class="line">  check vbak-auart ne 'ZHOR'.  "排除自营出口销售定单类型
</span><span class="line">
</span><span class="line">  data: l_sernr type gernr,
</span><span class="line">        l_bezei type bezei40.
</span><span class="line">  clear: l_sernr.
</span><span class="line">  if lips is not initial.
</span><span class="line">     select single d~sernr into l_sernr
</span><span class="line">       from  ser01 as c inner join objk as d on c~obknr eq d~obknr
</span><span class="line">       where c~lief_nr eq lips-vbeln
</span><span class="line">*         and c~POSNR eq lips-POSNR
</span><span class="line">         and d~sernr ne ''
</span><span class="line">         and c~posnr eq ( select posnr from lips as a inner join mara as b on a~matnr eq b~matnr
</span><span class="line">                                              where vbeln eq lips-vbeln and b~mtart eq 'FERT' ).
</span><span class="line">  else.
</span><span class="line">     select single d~sernr into l_sernr
</span><span class="line">       from  ser02 as c inner join objk as d on c~obknr eq d~obknr
</span><span class="line">       where c~sdaufnr eq vbap-vbeln
</span><span class="line">*         and c~POSNR eq VBAP-POSNR
</span><span class="line">         and d~sernr ne ''
</span><span class="line">         and c~posnr eq ( select posnr from vbap as a inner join mara as b on a~matnr eq b~matnr
</span><span class="line">                                              where vbeln eq vbap-vbeln and b~mtart eq 'FERT' ).
</span><span class="line">
</span><span class="line">  endif.
</span><span class="line">  if l_sernr is not initial. " and vbap-MVGR2 is not INITIAL.
</span><span class="line">*     select SINGLE BEZEI into l_BEZEI from TVM2T where MVGR2 eq vbap-MVGR2 and spras eq sy-langu.
</span><span class="line">*     if l_BEZEI is not INITIAL.
</span><span class="line">*         CONCATENATE l_BEZEI l_sernr+8(10) into VBRK-ZUONR SEPARATED BY '&amp;'.
</span><span class="line">*     endif.
</span><span class="line">     vbrk-zuonr = l_sernr.
</span><span class="line">  else.
</span><span class="line">*     MESSAGE E001(00) WITH '无法确定主机销售业务机型机号'.
</span><span class="line">  endif.
</span><span class="line">endif.
</span><span class="line">
</span><span class="line">
</span><span class="line">*}   INSERT
</span><span class="line">* VBRK-LANDTX = T001-LAND1.
</span><span class="line">
</span><span class="line">endform.</span></code></pre></td></tr></table></div></figure></notextile></div>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[MB1A - Goods movements - for unique batch number]]></title>
    <link href="http://lomozm.github.io/blog/20131227/mb1a-goods-movements-for-unique-batch-number/"/>
    <updated>2013-12-27T13:48:36+08:00</updated>
    <id>http://lomozm.github.io/blog/20131227/mb1a-goods-movements-for-unique-batch-number</id>
    <content type="html"><![CDATA[
<h3 id="question">Question:</h3>

<p>I am using the batch management for the raw materials ,When i do the GI to production order i enterd the batch number .But when i return excess material /defect material to wh (reversal of GI ) , system gave the message that &#8220;Caution! Internal number allocation for materials handled in batches&#8221; . As this is information message , The system  should allow same batch number which is used at the time of GI .</p>
<!--more-->
<p>What is name the user exit ? Or with the help of the configuaration can we control….</p>

<h3 id="answer">Answer:</h3>

<p>For unique batch number try these exits</p>
<p><code>SAPLV01Z-LV01ZU05 XVBZ-&gt;EXIT_V01Z_002</code> <code>SAPLV01Z</code> CFCs for internal batch number assignment</p>
<p><code>SAPLV01Z-LV01ZU07 XVBZ-&gt;EXIT_V01Z_003</code> <code>SAPLV1ZE</code> CFCs for external batch number assignment</p>
<p>Also refer this link:</p>
<p><a href="http://help.sap.com/saphelp_40b/helpdata/ru/dc/1d4b6e5733d1118b3f0060b03ca329/content.htm">http://help.sap.com/saphelp_40b/helpdata/ru/dc/1d4b6e5733d1118b3f0060b03ca329/content.htm</a></p>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[销售售发货badi - LE_SHP_DELIVERY_PROC]]></title>
    <link href="http://lomozm.github.io/blog/20131226/xiao-shou-shou-fa-huo-badi-le-shp-delivery-proc/"/>
    <updated>2013-12-26T15:17:42+08:00</updated>
    <id>http://lomozm.github.io/blog/20131226/xiao-shou-shou-fa-huo-badi-le-shp-delivery-proc</id>
    <content type="html"><![CDATA[
<p>业务要求，销售定单里的行项目交货完成后，自动更改其开票冻结标识；同时，当取消交货后，又改回冻结状态<br /></p>

<h3 id="section">实现方法</h3>
<p>通过实现<code>badi:LE_SHP_DELIVERY_PROC</code>的<code>save_and_publish_document</code>方法，可以完成；因为销售交货及取消都用到这个badi<br />
<!--more-->
<img src="http://lomozm.github.io/images/images/157a73d626f831258455b03c20b5fd96.jpeg" alt="m001" /><br /></p>

<h3 id="section-1">源代码</h3>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
<span class="line-number">24</span>
<span class="line-number">25</span>
<span class="line-number">26</span>
<span class="line-number">27</span>
<span class="line-number">28</span>
<span class="line-number">29</span>
<span class="line-number">30</span>
<span class="line-number">31</span>
<span class="line-number">32</span>
<span class="line-number">33</span>
<span class="line-number">34</span>
<span class="line-number">35</span>
<span class="line-number">36</span>
<span class="line-number">37</span>
<span class="line-number">38</span>
<span class="line-number">39</span>
<span class="line-number">40</span>
<span class="line-number">41</span>
<span class="line-number">42</span>
<span class="line-number">43</span>
<span class="line-number">44</span>
<span class="line-number">45</span>
<span class="line-number">46</span>
<span class="line-number">47</span>
<span class="line-number">48</span>
<span class="line-number">49</span>
<span class="line-number">50</span>
<span class="line-number">51</span>
<span class="line-number">52</span>
<span class="line-number">53</span>
<span class="line-number">54</span>
<span class="line-number">55</span>
<span class="line-number">56</span>
<span class="line-number">57</span>
<span class="line-number">58</span>
<span class="line-number">59</span>
<span class="line-number">60</span>
<span class="line-number">61</span>
<span class="line-number">62</span>
<span class="line-number">63</span>
<span class="line-number">64</span>
<span class="line-number">65</span>
<span class="line-number">66</span>
<span class="line-number">67</span>
<span class="line-number">68</span>
</pre></td><td class="code"><pre><code class=""><span class="line">method if_ex_le_shp_delivery_proc~save_and_publish_document.
</span><span class="line">*  message I001(00) with 'test!'.
</span><span class="line">  data: begin of wa_vbelv_so,
</span><span class="line">          vbelv type vbeln_von,
</span><span class="line">          posnv type posnr_von,
</span><span class="line">          sign type c,
</span><span class="line">      end of wa_vbelv_so.
</span><span class="line">  data: it_vbelv_so like table of wa_vbelv_so.
</span><span class="line">
</span><span class="line">  data: it_vbak type table of vbak,
</span><span class="line">        wa_vbak type vbak,
</span><span class="line">        it_shp_vl10_vbfa_t type shp_vl10_vbfa_t,
</span><span class="line">        wa_shp_vl10_vbfa_t type vbfavb,
</span><span class="line">        it_return type table of bapiret2,
</span><span class="line">        wa_return type bapiret2,
</span><span class="line">        wa_xvbuk type vbukvb.
</span><span class="line">
</span><span class="line">  data: wa_bapisdh1 type bapisdh1,
</span><span class="line">        wa_bapisdh1x type bapisdh1x.
</span><span class="line">
</span><span class="line">  if ( if_tcode eq 'VL02N' or if_tcode eq 'VL01N' ) ."and ( sy-ucomm eq 'WABU_T' )." or sy-ucomm eq 'SICH_T' ).  "事物代码vl01n,vl02n时，当出现发货过帐'WABU_T'事件
</span><span class="line">    loop at it_xvbfa into wa_shp_vl10_vbfa_t where vbtyp_n eq 'J'.  "后续单据为交货单
</span><span class="line">      append wa_shp_vl10_vbfa_t to it_shp_vl10_vbfa_t.
</span><span class="line">
</span><span class="line">      move-corresponding wa_shp_vl10_vbfa_t to wa_vbelv_so.
</span><span class="line">      clear: wa_vbelv_so-sign.
</span><span class="line">      append wa_vbelv_so to it_vbelv_so.    "取销售定单号
</span><span class="line">    endloop.
</span><span class="line">
</span><span class="line">    sort it_vbelv_so by vbelv posnv.
</span><span class="line">    delete adjacent duplicates from it_vbelv_so comparing vbelv." posnv.
</span><span class="line">    loop at it_vbelv_so into wa_vbelv_so.
</span><span class="line">      select single * into wa_vbak from vbak where vbeln eq wa_vbelv_so-vbelv and auart eq 'ZSPT'.  "只针对订单类型'ZSPT'
</span><span class="line">      if sy-subrc ne 0.
</span><span class="line">        wa_vbelv_so-sign = 'X'.
</span><span class="line">        modify it_vbelv_so index sy-tabix from wa_vbelv_so transporting sign.
</span><span class="line">      endif.
</span><span class="line">    endloop.
</span><span class="line">    delete it_vbelv_so where sign eq 'X'.
</span><span class="line">
</span><span class="line">    loop at it_xvbuk into wa_xvbuk.
</span><span class="line">      read table it_vbelv_so into wa_vbelv_so  with key vbelv = wa_xvbuk-vbeln binary search.
</span><span class="line">      if sy-subrc eq 0 and wa_xvbuk-lfgsk eq 'C'.   "销售定单为全部交货
</span><span class="line">        if sy-tcode eq 'VL09' and sy-ucomm eq 'YES'.  "取消发货过帐
</span><span class="line">          wa_bapisdh1-bill_block = '05'.  "开票冻结“检查交货条款”
</span><span class="line">        elseif sy-ucomm eq 'WABU_T'.   "发货过帐'WABU_T'事件
</span><span class="line">          clear:  wa_bapisdh1-bill_block.
</span><span class="line">        else.
</span><span class="line">          exit.
</span><span class="line">        endif.
</span><span class="line">        wa_bapisdh1x-updateflag = 'U'.
</span><span class="line">        wa_bapisdh1x-bill_block = 'X'.
</span><span class="line">        call function 'BAPI_SALESORDER_CHANGE'     "更改销售定单
</span><span class="line">          exporting
</span><span class="line">            salesdocument    = wa_xvbuk-vbeln
</span><span class="line">            order_header_in  = wa_bapisdh1
</span><span class="line">            order_header_inx = wa_bapisdh1x
</span><span class="line">          tables
</span><span class="line">            return           = it_return.
</span><span class="line">        loop at it_return into wa_return where type eq 'E' or type eq 'A'.
</span><span class="line">          message e001(00) with wa_return-message.
</span><span class="line">          return.
</span><span class="line">        endloop.
</span><span class="line">      endif.
</span><span class="line">    endloop.
</span><span class="line">
</span><span class="line">  endif.
</span><span class="line">endmethod.</span></code></pre></td></tr></table></div></figure></notextile></div>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[销售定价显示增强 - LV69AFZZ]]></title>
    <link href="http://lomozm.github.io/blog/20131226/xiao-shou-ding-dan-cheng-ben-xian-shi-zeng-qiang-lv69afzz/"/>
    <updated>2013-12-26T13:53:22+08:00</updated>
    <id>http://lomozm.github.io/blog/20131226/xiao-shou-ding-dan-cheng-ben-xian-shi-zeng-qiang-lv69afzz</id>
    <content type="html"><![CDATA[
<p>业务有时需要部分用户不能看到销售定单的价格，这时我们可以在增强中实现<br />
分两步：1. 在销售定单中处理；2. 在凭证流中处理<br /></p>

<h3 id="section">在销售定单中</h3>
<p>更改<code>INCLUDE LV69AFZZ</code>各个form，先在<code>include</code>中增加下面定义<br /></p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
</pre></td><td class="code"><pre><code class=""><span class="line">DATA: OLD_KOMV LIKE KOMV,
</span><span class="line"> OLD_KOMK LIKE KOMK.
</span><span class="line"> DATA: AUTH_SUBRC LIKE SY-SUBRC.</span></code></pre></td></tr></table></div></figure></notextile></div>

<!--more-->

<p>然后更改<br /></p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
<span class="line-number">24</span>
<span class="line-number">25</span>
<span class="line-number">26</span>
<span class="line-number">27</span>
<span class="line-number">28</span>
<span class="line-number">29</span>
<span class="line-number">30</span>
<span class="line-number">31</span>
<span class="line-number">32</span>
<span class="line-number">33</span>
<span class="line-number">34</span>
<span class="line-number">35</span>
<span class="line-number">36</span>
<span class="line-number">37</span>
<span class="line-number">38</span>
<span class="line-number">39</span>
<span class="line-number">40</span>
<span class="line-number">41</span>
<span class="line-number">42</span>
<span class="line-number">43</span>
<span class="line-number">44</span>
<span class="line-number">45</span>
<span class="line-number">46</span>
<span class="line-number">47</span>
<span class="line-number">48</span>
<span class="line-number">49</span>
<span class="line-number">50</span>
<span class="line-number">51</span>
<span class="line-number">52</span>
<span class="line-number">53</span>
<span class="line-number">54</span>
<span class="line-number">55</span>
<span class="line-number">56</span>
<span class="line-number">57</span>
<span class="line-number">58</span>
<span class="line-number">59</span>
<span class="line-number">60</span>
<span class="line-number">61</span>
<span class="line-number">62</span>
</pre></td><td class="code"><pre><code class=""><span class="line">form userexit_field_modific_leer.
</span><span class="line">  INCLUDE ZZAUTH01.
</span><span class="line"> *}   INSERT
</span><span class="line"> endform.                        " USEREXIT_FIELD_MODIFIC_LEER
</span><span class="line"> *&amp;---------------------------------------------------------------------*
</span><span class="line"> *&amp;      Form  USEREXIT_FIELD_MODIFIC_KZWI
</span><span class="line"> *&amp;---------------------------------------------------------------------*
</span><span class="line"> *       text
</span><span class="line"> *----------------------------------------------------------------------*
</span><span class="line"> *  --&gt;  p1        text
</span><span class="line"> *  &lt;--  p2        text
</span><span class="line"> *----------------------------------------------------------------------*
</span><span class="line"> form userexit_field_modific_kzwi.
</span><span class="line">  INCLUDE ZZAUTH01.
</span><span class="line"> *}   INSERT
</span><span class="line"> endform.                        " USEREXIT_FIELD_MODIFIC_KZWI
</span><span class="line"> *&amp;---------------------------------------------------------------------*
</span><span class="line"> *&amp;      Form  USEREXIT_FIELD_MODIFIC_KOPF
</span><span class="line"> *&amp;---------------------------------------------------------------------*
</span><span class="line"> *       text
</span><span class="line"> *----------------------------------------------------------------------*
</span><span class="line"> *  --&gt;  p1        text
</span><span class="line"> *  &lt;--  p2        text
</span><span class="line"> *----------------------------------------------------------------------*
</span><span class="line"> form userexit_field_modific_kopf.
</span><span class="line">  INCLUDE ZZAUTH01.
</span><span class="line"> *}   INSERT
</span><span class="line"> endform.                   " USEREXIT_FIELD_MODIFIC_KOPF
</span><span class="line"> *&amp;---------------------------------------------------------------------*
</span><span class="line"> *&amp;      Form  USEREXIT_FIELD_MODIFICATION
</span><span class="line"> *&amp;---------------------------------------------------------------------*
</span><span class="line"> *       text
</span><span class="line"> *----------------------------------------------------------------------*
</span><span class="line"> *  --&gt;  p1        text
</span><span class="line"> *  &lt;--  p2        text
</span><span class="line"> *----------------------------------------------------------------------*
</span><span class="line"> form userexit_field_modification.
</span><span class="line">  INCLUDE ZZAUTH01.
</span><span class="line"> *}   INSERT
</span><span class="line"> endform.                       " USEREXIT_FIELD_MODIFICATION
</span><span class="line"> *&amp;---------------------------------------------------------------------*
</span><span class="line"> *&amp;      Form  USEREXIT_PRICING_CHECK
</span><span class="line"> *&amp;---------------------------------------------------------------------*
</span><span class="line"> *       text
</span><span class="line"> *----------------------------------------------------------------------*
</span><span class="line"> *  --&gt;  p1        text
</span><span class="line"> *  &lt;--  p2        text
</span><span class="line"> *----------------------------------------------------------------------*
</span><span class="line"> form userexit_pricing_check.
</span><span class="line">  INCLUDE ZZAUTH02.
</span><span class="line"> *}   INSERT
</span><span class="line"> endform.                             " USEREXIT_PRICING_CHECK
</span><span class="line"> *&amp;---------------------------------------------------------------------*
</span><span class="line"> *&amp;      Form  USEREXIT_CHANGE_PRICING_RULE
</span><span class="line"> *&amp;---------------------------------------------------------------------*
</span><span class="line"> *       text
</span><span class="line"> *----------------------------------------------------------------------*
</span><span class="line"> *      --&gt;P_RV61A_KSTEU  text
</span><span class="line"> *----------------------------------------------------------------------*
</span><span class="line"> form userexit_change_pricing_rule using    p_rv61a_ksteu.
</span><span class="line">
</span><span class="line"> endform.                        " USEREXIT_CHANGE_PRICING_RULE</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>程序名：<br />
<code>ZZAUTH01:   Authorization check for the condition screen</code><br />
<code>ZZAUTH02:   Authorization check for the creation of conditions</code><br /></p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
<span class="line-number">24</span>
<span class="line-number">25</span>
<span class="line-number">26</span>
<span class="line-number">27</span>
<span class="line-number">28</span>
<span class="line-number">29</span>
<span class="line-number">30</span>
<span class="line-number">31</span>
<span class="line-number">32</span>
<span class="line-number">33</span>
<span class="line-number">34</span>
<span class="line-number">35</span>
<span class="line-number">36</span>
<span class="line-number">37</span>
<span class="line-number">38</span>
<span class="line-number">39</span>
<span class="line-number">40</span>
<span class="line-number">41</span>
<span class="line-number">42</span>
<span class="line-number">43</span>
<span class="line-number">44</span>
<span class="line-number">45</span>
<span class="line-number">46</span>
<span class="line-number">47</span>
<span class="line-number">48</span>
<span class="line-number">49</span>
<span class="line-number">50</span>
</pre></td><td class="code"><pre><code class=""><span class="line">*&amp;---------------------------------------------------------------------*
</span><span class="line"> *&amp;  Include           ZZAUTH01
</span><span class="line"> *&amp;---------------------------------------------------------------------*
</span><span class="line"> * Beim ersten Aufruf ist KOMV initial; OLD_KOMK löschen,
</span><span class="line"> * damit auf jeden Fall Berechtigungsprüfung durchgeführt wird.
</span><span class="line"> * Sicherheitshalber zunächst Berechtigung verweigern.
</span><span class="line">
</span><span class="line"> * if komv is initial.
</span><span class="line">  IF SCREEN-NAME = 'FCODE'.
</span><span class="line">    CLEAR OLD_KOMK.
</span><span class="line">    AUTH_SUBRC = 4.
</span><span class="line">  ENDIF.
</span><span class="line">
</span><span class="line"> * Berechtigungsprüfung auf Kalkulationsschema und Stufen-Nr.
</span><span class="line"> * Beim Wechsel der KOMV-Zeile einmalig eine Berechtigungsprüfung
</span><span class="line"> * durchführen
</span><span class="line">  IF KOMK-KALSM NE OLD_KOMK-KALSM OR KOMV-STUNR NE OLD_KOMV-STUNR.
</span><span class="line">    AUTHORITY-CHECK OBJECT 'Z_KONH_KLS'
</span><span class="line">               ID 'ZKALSM' FIELD KOMK-KALSM
</span><span class="line">               ID 'ZSTUNR' FIELD KOMV-STUNR
</span><span class="line">               ID 'ACTVT' DUMMY.
</span><span class="line">    AUTH_SUBRC = SY-SUBRC.
</span><span class="line">    OLD_KOMK = KOMK.
</span><span class="line">    OLD_KOMV = KOMV.
</span><span class="line">  ENDIF.
</span><span class="line">
</span><span class="line">  IF AUTH_SUBRC NE 0 AND ( SCREEN-NAME = 'RV61A-SELKZ'
</span><span class="line">                    OR   SCREEN-NAME = 'KOMV-KAWRT'"条件基值
</span><span class="line">                    OR   SCREEN-NAME = 'RV61A-AWEIN'
</span><span class="line">                    OR   SCREEN-NAME = 'KOMV-KBETR' "VK11中金额
</span><span class="line">                    OR   SCREEN-NAME = 'RV61A-KOEIN'"VK11-货币
</span><span class="line">                    OR   SCREEN-NAME = 'KOMV-KPEIN'"VK11-单位
</span><span class="line">                    OR   SCREEN-NAME = 'KOMV-KMEIN'"VK11-UoM
</span><span class="line">                    OR   SCREEN-NAME = 'KOMV-KWERT' )."定价值
</span><span class="line">    SCREEN-ACTIVE = 0.
</span><span class="line">  ENDIF.
</span><span class="line">  MODIFY SCREEN.
</span><span class="line"> * Ende Berechtigungsprüfung-------------------------------------
</span><span class="line"> *&amp;---------------------------------------------------------------------*  
</span><span class="line"> 2）ZZAUTH02
</span><span class="line"> ***INCLUDE ZZAUTH02.
</span><span class="line">    AUTHORITY-CHECK OBJECT 'Z_KONH_KLS'
</span><span class="line">               ID 'ZKALSM' FIELD KOMK-KALSM
</span><span class="line">               ID 'ZSTUNR' FIELD KOMV-STUNR
</span><span class="line">               ID 'ACTVT' DUMMY.
</span><span class="line">    IF SY-SUBRC NE 0.
</span><span class="line">      MESSAGE E609(VH).
</span><span class="line">    ENDIF.
</span><span class="line">
</span><span class="line"> * Ende Berechtigungsprüfung</span></code></pre></td></tr></table></div></figure></notextile></div>

<p><img src="http://lomozm.github.io/images/images/a95fb0bdc96efb93da5b8d3331cfd91d.jpeg" alt="m001" /><br /></p>

<h3 id="section-1">在凭证流中</h3>
<p>在<code>include LDOCUMENT_FLOW_ALVF01</code>中的<code>FORM DISPLAY_DOCUMENT_FLOW</code>前端添加增强，删除参考值和货币数据即可，使金额不显示：<br /></p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
</pre></td><td class="code"><pre><code class=""><span class="line">FIELD-SYMBOLS: &lt;WA_DOCFLOW&gt; TYPE DOCUMENT_FLOW_ALV_STRUC.
</span><span class="line">  LOOP AT GT_DOCFLOW ASSIGNING &lt;WA_DOCFLOW&gt;.
</span><span class="line">     CLEAR: &lt;WA_DOCFLOW&gt;-RFWRT,
</span><span class="line">            &lt;WA_DOCFLOW&gt;-WAERS.
</span><span class="line">*    modify gt_docflow.
</span><span class="line">  ENDLOOP.</span></code></pre></td></tr></table></div></figure></notextile></div>

<p><img src="http://lomozm.github.io/images/images/0cf1722fb9de37455d6f9f3e4c5aefbd.jpeg" alt="m002" /><br /></p>
]]></content>
  </entry>
  
</feed>
