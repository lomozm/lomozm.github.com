<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[lomozm’s Journal]]></title>
  <link href="http://lomozm.github.io/atom.xml" rel="self"/>
  <link href="http://lomozm.github.io/"/>
  <updated>2014-02-27T15:13:09+08:00</updated>
  <id>http://lomozm.github.io/</id>
  <author>
    <name><![CDATA[lomozm]]></name>
    <email><![CDATA[18064095@qq.com]]></email>
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[使用ABAP MEMORY与SAP MEMORY讨论]]></title>
    <link href="http://lomozm.github.io/blog/20140227/shi-yong-abap-memoryyu-sap-memory/"/>
    <updated>2014-02-27T14:07:08+08:00</updated>
    <id>http://lomozm.github.io/blog/20140227/shi-yong-abap-memoryyu-sap-memory</id>
    <content type="html"><![CDATA[
<h3 id="br">术语<br /></h3>
<p>#####SAP Memory/ABAP Memory：
为实现数据传递，SAP系统在服务器分配的内存空间，其分配的区域不同 <br />
#####User Session: 
用户登录系统时产生，用户登陆一次产生一个<br />
#####External Session：
也称main session，用户开启的一个窗口对应一个external session；其中一个logon user session中可以最大6个external session<br />
#####Internal Session：
程序运行中，系统为程序分配的session，一个程序可以分配多个internal session，也可能只有一个session，一个external session中最大可以使用20个Internal session<br />
<!-- more -->
User Session、External Session与Internal Session关系图：<br />
<img src="http://lomozm.github.io/images/images/ABAPMemoryAndSAPMemory/image002.gif" alt="i001" /><br />
<br /></p>

<h3 id="section">技术背景</h3>
<p>####总览
ABAP开发过程中，常需要在session之进行数据传递和共享，SAP提供了两种技术来实现它：SAP Memory和ABAP Memory<br />
一个external session对应着一个ABAP session，所以，一个window里的internal session共用着同一个ABAP session；所以，在一个user logon session中不同的window(external session)共同使用一个SAP memory<br />
SAP Memory、ABAP Memory、Main Session与Internal Session关系图：<br />
<img src="http://lomozm.github.io/images/images/ABAPMemoryAndSAPMemory/image004.gif" alt="i002" /><br /></p>

<h4 id="section-1">区别</h4>
<p>#####1、读取和使用方法不同
SAP内存使用<code>SET/GET parameters</code>方法：<br /></p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
</pre></td><td class="code"><pre><code class=""><span class="line">&lt;!--StartFragment --&gt;SET PARAMETER ID 'MAT' FIELD P_MATNR.
</span><span class="line">GET PARAMETER ID 'MAT' FIELD P_MATNR.</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>ABAP内存使用<code>EXPORT/IMPORT</code>方法：<br /></p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
</pre></td><td class="code"><pre><code class=""><span class="line">&lt;!--StartFragment --&gt;EXPORT P_MATNR = P_MATNR TO MEMORY ID 'ZTESTMAT'.
</span><span class="line">IMPORT P_MATNR = P_MATNR FROM MEMORY ID 'ZTESTMAT'</span></code></pre></td></tr></table></div></figure></notextile></div>

<h5 id="section-2">2、共享范围不同</h5>
<p>SAP内存可以被所有的主session访问，内存数据可以在同一个session中不同程序之间，或者不同session之间共享数据；<br />
ABAP内存只能在同个session的不同程序之间共享数据；<br />
#####3、作用范围不同
SAP内存在整个终端session时间内都有效；<br />
ABAP内存只能在一个session时间内有效；<br />
#####4、使用一般原则
SAP内存用于屏幕默认值输入；<br />
ABAP内存用于模块之间传递数据<br />
###难点分析
####LINK PROGRAM介绍
使用ABAP/SAP Memory，是因为它们可以在SAP中充当着“数据存储器”的作用，就比如DB、File等，同时程序中，因为我们大量地使用着Link program，所以为了数据的共享或者传递。<br />
首先简要地总结一下Link program。从大类上来分，主要可以通过以下的图示表述:<br />
<img src="http://lomozm.github.io/images/images/ABAPMemoryAndSAPMemory/image006.gif" alt="i003" /><br />
说明：<br />
“被调用程序插入型”是指：调用程序(calling program)并不结束，当遇到Link 语句时，会去执行被调用程序(called program)，当被调用程序结束后，调用程序继续执行;<br />
“调用程序中止型”是指：调用程序(calling program)当遇到Link 语句时会中止，然后去执行被调用程序(called program)<br />
####LINK PROGRAM与MEMORY的关系<br />
#####1、对于FM:
当一个FM被调用时，它对应的Function Group被load进当前的这个 internal session，当其处理完了，calling program继续被处理;(该Function Group下的global data可以继续被使用).<br />
#####2、对于CALL TRANSACTION或SUBMIT AND RETURN
当运行到这种情况时，系统会重新运行一个internal session,当called program结束后(也可以是使用leave program)，这个internal session会被delete掉，然后calling program继续运行.<br />
#####3、对于SUBMIT
当运行到这种情况时，calling program从当前的internal session中被移走，而called program被load进这个internal session.<br />
#####4、对于LEAVE TO TRANSACTION
当运行到这种情况时，当前External session中的所有internal session被清掉，而called transaction将会在该external session中新开一个internal session;<br />
另外，该种情况下，该external session所对应的ABAP memory将会被initialize,所以这种情况下，我们不能使用ABAP memory来传递数据，而应该使用SAP Memory;<br />
#####5、异步的LINK PROGRAM:
当遇到这种FM时，将会重新打开一个external session,它并行地、独立于当前的external session.<br />
<br />
###思路或想法
在同一个external session的Link program我们使用ABAP Memory进行传递数据<br />
而在不同的external session间的Link program我们使用SAP Memory进行数据传递。很多时候并不是像ABAP Memory那样直接在程序中完成了Set与Get方法；相反，一般是将其绑定给某一Data element(并激活着Set与Get方法)，从而任何其他程序使用了该Data element的地方都将会有“default”值，也就是说在一个地方的data element的改变会影响其他地方，从而也就达到了数据传递的效果；我们自己在开发Dynpro的程序时，有时候根据实际的需求，也会勾选某些 element的SPA/GPA属性(在SE51 Screen Painter中); 其实，这也是SAP标准所采用的技术<br />
对于FM而言，因为它依附于Function Group，所以，一般如果我们使用FM需要数据传递或者共享的话(除了FM自己的import/export/table外)，我们是使用Function Group的全局变量<br />
<br />
###解决方案与系统实现
####ABAP MEMORY实例
#####主要任务
程序1： ZTEST_ABAP_MEM_PROG1——将数据写入ABAP内存
1、清空该memory ID
2、向memory ID传递一个<code>work area</code>
3、向memory ID传递一个<code>Internal table</code>
4、向memory ID传递一个<code>Parameter</code></p>

<p>程序2： ZTEST_ABAP_MEM_PROG2——从ABAP内存取出数据
1、从memory ID取得一个<code>work area</code>
2、从memory ID取得一个<code>Internal table</code>
3、从memory ID取得一个<code>Parameter并同时赋给选择屏幕上的<code>parameter</code></code></p>

<h5 id="section-3">程序代码</h5>
<p>ZTEST_ABAP_MEM_PROG1</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
<span class="line-number">24</span>
<span class="line-number">25</span>
<span class="line-number">26</span>
<span class="line-number">27</span>
<span class="line-number">28</span>
<span class="line-number">29</span>
</pre></td><td class="code"><pre><code class=""><span class="line">REPORT  ZTEST_ABAP_MEM_PROG1  No standard page heading  .
</span><span class="line"> 
</span><span class="line">*—Data &amp; Types
</span><span class="line">data:
</span><span class="line">  gs_scutom   type   scustom,
</span><span class="line">  gt_scustom  type  table of scustom,
</span><span class="line">  gv_para     type   char10.
</span><span class="line"> 
</span><span class="line">start-of-selection.
</span><span class="line"> 
</span><span class="line">*—Free Memory
</span><span class="line">  Free memory ID ‘TEST1′.
</span><span class="line">*—Retrieve data
</span><span class="line">*1. Get the structure
</span><span class="line">  select single * from scustom
</span><span class="line">    into gs_scutom
</span><span class="line">    where ID = ‘00000001′.
</span><span class="line">*2. Get the table
</span><span class="line">  select  * from scustom
</span><span class="line">    into table gt_scustom
</span><span class="line">    up to 10 rows
</span><span class="line">    where COUNTRY = ‘DE’.
</span><span class="line">*3. Set the parameter
</span><span class="line">   gv_para = ‘EDISON_TC’.
</span><span class="line">*4. Export to ABAP Memory
</span><span class="line">  Export  gs_scutom   gt_scustom   gv_para
</span><span class="line">  To Memory ID ‘TEST1′.
</span><span class="line">*5. Submit Program 2
</span><span class="line">  Submit ZTEST_ABAP_MEM_PROG2.</span></code></pre></td></tr></table></div></figure></notextile></div>

<p><br />
ZTEST_ABAP_MEM_PROG2</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
<span class="line-number">24</span>
<span class="line-number">25</span>
<span class="line-number">26</span>
<span class="line-number">27</span>
<span class="line-number">28</span>
<span class="line-number">29</span>
<span class="line-number">30</span>
<span class="line-number">31</span>
<span class="line-number">32</span>
<span class="line-number">33</span>
<span class="line-number">34</span>
<span class="line-number">35</span>
<span class="line-number">36</span>
<span class="line-number">37</span>
</pre></td><td class="code"><pre><code class=""><span class="line">REPORT  ZTEST_ABAP_MEM_PROG2  No standard page heading  .
</span><span class="line"> 
</span><span class="line"> *—Data &amp; Types
</span><span class="line"> data:
</span><span class="line">   gs_scutom   type   scustom,
</span><span class="line">   gt_scustom  type  table of scustom,
</span><span class="line">   gv_para     type   char10.
</span><span class="line"> 
</span><span class="line"> data:
</span><span class="line">   ls_scutom  type scustom.
</span><span class="line"> 
</span><span class="line"> parameter: p_para  type char10.
</span><span class="line"> 
</span><span class="line"> start-of-selection.
</span><span class="line"> *1. Get the data from ABAP Memory
</span><span class="line">   Import
</span><span class="line">     gs_scutom
</span><span class="line">     gt_scustom
</span><span class="line">     gv_para to p_para
</span><span class="line">   From Memory ID ‘TEST1′.
</span><span class="line"> 
</span><span class="line"> *2. Write the data
</span><span class="line">   write:/ ‘1. The structure:’,
</span><span class="line">           10, gs_scutom-id,
</span><span class="line">           20, gs_scutom-NAME,
</span><span class="line">           30, gs_scutom-COUNTRY.
</span><span class="line">   uline /(100).
</span><span class="line"> 
</span><span class="line">   write:/ ‘2. The table:’.
</span><span class="line">   Loop at gt_scustom into ls_scutom.
</span><span class="line">     write:/10 ls_scutom-id,
</span><span class="line">           20, ls_scutom-NAME,
</span><span class="line">           30, ls_scutom-COUNTRY.
</span><span class="line">   endloop.
</span><span class="line">   uline /(100).
</span><span class="line"> 
</span><span class="line">   write:/ ‘3. The parameter:’,p_para.</span></code></pre></td></tr></table></div></figure></notextile></div>

<p><br />
####SAP MEMORY实例
不同于ABAP Memory，可以直接在程序中进行指定；对于SAP Memory，它其实是利用的是我们经常所说的SPA/GPA,也就是set parameter和get parameter；所以，这里首先得创建<code>parameter ID</code>;<br />
创建Parameter，我们一般是使用SE80 object Navigator来进行创建,它最长为20位；Parameter的数据是存于数据库表TPARA<br />
#####主要任务
程序1：ZTEST_SAP_MEMORY<em>1——存入数据至SAP Memory中<br /> 它是一个普通的Report程序，它只有一个parameter,但addition了一个parameter ID.然后F8执行会跳转到program 2<br />
程序2：ZTEST_SAP_MEMORY</em>1——把SAP Memory数据取出<br />
它是一个普通的Dynpro程序，它只有一个Screen,在这个Screen上面有一个<code>Input field</code>，同时该input field激活了SAP与GPA并指定了其<code>parameter ID</code>.当点击Application bar上的回到program1后会跳转到program 1<br />
  <br />
#####程序代码</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
</pre></td><td class="code"><pre><code class=""><span class="line">REPORT  ZTEST_SAP_MEMORY_1 NO STANDARD PAGE HEADING.
</span><span class="line"> *—PARAMETER
</span><span class="line">   PARAMETERS: p_spa type ZDELM_1 MEMORY ID ZPARA1.
</span><span class="line"> start-of-selection.
</span><span class="line"> *—USING SAP MEMORY
</span><span class="line"> *1. Leave to Transaction –&gt; program 2
</span><span class="line">   leave to TRANSACTION ‘ZSAP_MEM_2′.
</span><span class="line">   
</span><span class="line">   
</span><span class="line">   MODULE USER_COMMAND_0100 INPUT.
</span><span class="line">     CASE SY-UCOMM .
</span><span class="line">       WHEN ‘BACK’ or ‘%EX’ or ‘RW’.
</span><span class="line">         LEAVE to SCREEN 0.
</span><span class="line">       when ‘PROG1′.
</span><span class="line">         LEAVE to TRANSACTION ‘ZSAP_MEM_1′.
</span><span class="line">       WHEN OTHERS.
</span><span class="line">     ENDCASE.
</span><span class="line">   ENDMODULE.                 “ USER_COMMAND_0100  INPUT</span></code></pre></td></tr></table></div></figure></notextile></div>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[TextMate highlight for ABAP]]></title>
    <link href="http://lomozm.github.io/blog/20140220/textmate-highlight-for-abap/"/>
    <updated>2014-02-20T23:21:30+08:00</updated>
    <id>http://lomozm.github.io/blog/20140220/textmate-highlight-for-abap</id>
    <content type="html"><![CDATA[
<h3 id="section">背景</h3>
<p>想找到个在mac下的文本编缉器，后来找到textmate，听说是因为mac os x免费后，MacroMates也跟风开源了。准备以后用它来做abap开发，但是没有语法高亮的话，看起来就太不酷了（不能装B，大家懂的）<br />
 <!--more--></p>

<h3 id="section-1">效果</h3>
<p>闲话少说，看一下效果先<br />
<img src="http://lomozm.github.io/images/images/QQ20140220-2@2x.jpg" alt="001" /><br /></p>

<h3 id="section-2">过程</h3>
<ol>
  <li>下载<a href="http://lomozm.github.io/appendix/ABAP.tmLanguage">ABAP.tmLanguage</a>和<a href="http://lomozm.github.io/appendix/ABAP.textmate">ABAP.textmate</a>两文件到本地<br /></li>
  <li>先新建bundle，取名为ABAP，然后双击<code>ABAP.tmLanguage</code>文件安装，更新abap内容<br /></li>
  <li>进入bundle编器，将<code>ABAP.textmate</code>内容去覆盖原来的。原来的很多标签没加入进去，我进行了引些更改，又懒得改<code>ABAP.tmLanguage</code>文件<br />
<img src="http://lomozm.github.io/images/images/QQ20140221-1@2x.jpg" alt="002" /><br />
最后大功告成了，好好享受编程的乐子吧！！<br /></li>
</ol>

<h3 id="section-3">有用链接</h3>
<p><a href="https://github.com/pvl/abap.tmbundle">源始ABAP.tmLanguage文件下载</a><br />
<a href="http://wiki.macromates.com/Themes/UserSubmittedThemes">textmate和theme效果</a><br /></p>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[MIGO收货时报M3682错误(同一物料在同一批次被使用)]]></title>
    <link href="http://lomozm.github.io/blog/20140103/migoshou-huo-shi-bao-m3682cuo-wu-tong-%5B%3F%5D-wu-liao-zai-tong-%5B%3F%5D-pi-ci-bei-shi-yong/"/>
    <updated>2014-01-03T16:21:47+08:00</updated>
    <id>http://lomozm.github.io/blog/20140103/migoshou-huo-shi-bao-m3682cuo-wu-tong-[?]-wu-liao-zai-tong-[?]-pi-ci-bei-shi-yong</id>
    <content type="html"><![CDATA[
<h3 id="section">场景</h3>
<p>用户在使用migo收货时，发现同一物料同一批次不能同时处理，错误消息是：物料###的批次##被用户##锁定<br /></p>

<h3 id="section-1">解决方法</h3>
<p>见notes:1523750 - MIGO: Message M3682 during goods movement to same batch<br />
使用badi: BATCH_MASTER<br />
method: <code>LOCK_BATCH_MASTER_IN_MIGO</code><br />
<!--more--></p>

<p>注意：<br />
1. notes中关于版本的描述，打这个notes时，相关notes也必须打上<br />
2. 锁数据查看事务代码：sm12<br />
3. badi调用的函数：<code>VB_ENQUEUE_BATCH</code><br /></p>

<h3 id="section-2">出口代码</h3>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
<span class="line-number">24</span>
<span class="line-number">25</span>
<span class="line-number">26</span>
<span class="line-number">27</span>
<span class="line-number">28</span>
<span class="line-number">29</span>
<span class="line-number">30</span>
<span class="line-number">31</span>
<span class="line-number">32</span>
<span class="line-number">33</span>
<span class="line-number">34</span>
<span class="line-number">35</span>
<span class="line-number">36</span>
<span class="line-number">37</span>
<span class="line-number">38</span>
<span class="line-number">39</span>
<span class="line-number">40</span>
<span class="line-number">41</span>
<span class="line-number">42</span>
<span class="line-number">43</span>
<span class="line-number">44</span>
<span class="line-number">45</span>
<span class="line-number">46</span>
<span class="line-number">47</span>
<span class="line-number">48</span>
<span class="line-number">49</span>
<span class="line-number">50</span>
<span class="line-number">51</span>
<span class="line-number">52</span>
<span class="line-number">53</span>
<span class="line-number">54</span>
<span class="line-number">55</span>
<span class="line-number">56</span>
<span class="line-number">57</span>
<span class="line-number">58</span>
<span class="line-number">59</span>
</pre></td><td class="code"><pre><code class=""><span class="line">method IF_EX_BATCH_MASTER~LOCK_BATCH_MASTER_IN_MIGO.
</span><span class="line">
</span><span class="line">  data: it_sel type TABLE OF seqg3,
</span><span class="line">        wa_sel type seqg3,
</span><span class="line">        it_enq type table of seqg3,
</span><span class="line">        wa_enq type seqg3.
</span><span class="line">
</span><span class="line">  data: gname    type  seqg3-gname.
</span><span class="line">  data: garg     type  seqg3-garg.
</span><span class="line">  data: gtarg    type  seqg3-gtarg.
</span><span class="line">  data: guname   type  seqg3-guname.
</span><span class="line">  data: gclient  type  seqg3-gclient.
</span><span class="line">  data: subrc type i.
</span><span class="line">*
</span><span class="line">  if sy-tcode eq 'MIGO'.  "事务代码判断
</span><span class="line">
</span><span class="line">    gname   = 'MCH1'.   "锁定的表
</span><span class="line">    guname  = ''. "sy-uname.  “如果不指定用户，系统默认当前用户，就不能解锁其它用户锁定的数据，所以指定为空
</span><span class="line">    gclient = sy-mandt.
</span><span class="line">    concatenate gclient i_matnr i_charg into garg.  "锁定的对象
</span><span class="line">*读取锁定数据
</span><span class="line">    CALL FUNCTION 'ENQUEUE_READ'
</span><span class="line">      EXPORTING
</span><span class="line">        gclient               = gclient
</span><span class="line">        guname                = guname
</span><span class="line">        gname                 = gname
</span><span class="line">      IMPORTING
</span><span class="line">        subrc                 = subrc
</span><span class="line">      TABLES
</span><span class="line">        enq                   = it_enq
</span><span class="line">      EXCEPTIONS
</span><span class="line">        communication_failure = 2
</span><span class="line">        others                = 1.
</span><span class="line">    if sy-subrc = 0.
</span><span class="line">      C_LOCK_MODE = 'S'.  "更改排它锁为共享锁
</span><span class="line">
</span><span class="line">      delete it_enq where garg ne garg and gmode eq C_LOCK_MODE.
</span><span class="line">
</span><span class="line">      if it_enq is not initial.
</span><span class="line">*删除锁定数据
</span><span class="line">        CALL FUNCTION 'ENQUE_DELETE'
</span><span class="line">          EXPORTING
</span><span class="line">            check_upd_requests = 1
</span><span class="line">          IMPORTING
</span><span class="line">            subrc              = subrc
</span><span class="line">          TABLES
</span><span class="line">            enq                = it_enq.
</span><span class="line">
</span><span class="line">        if subrc eq 0.
</span><span class="line">          clear it_enq.
</span><span class="line">        endif.
</span><span class="line">      endif.
</span><span class="line">    elseif sy-subrc = 2.
</span><span class="line">      exit.
</span><span class="line">    endif.
</span><span class="line">
</span><span class="line">  ENDIF.
</span><span class="line">
</span><span class="line">endmethod.</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>其它有用的链接<br />
<a href="http://help.sap.com/saphelp_erp60_sp/helpdata/en/02/e0b24188b3e534e10000000a1550b0/content.htm">http://help.sap.com/saphelp_erp60_sp/helpdata/en/02/e0b24188b3e534e10000000a1550b0/content.htm</a><br /></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[EVAL_FORMULA 公式计算测试]]></title>
    <link href="http://lomozm.github.io/blog/20131230/eval-formula-gong-shi-ji-suan-ce-shi/"/>
    <updated>2013-12-30T16:36:25+08:00</updated>
    <id>http://lomozm.github.io/blog/20131230/eval-formula-gong-shi-ji-suan-ce-shi</id>
    <content type="html"><![CDATA[
<h3 id="section">应用场景</h3>
<p>当客户需要的报表逻辑较复杂，同一种类的数据进行数据运算，或者再累计计算，或者排除等；如果在程序中写死的话，业务的变更会导致程序的变更，使维持工作量加大<br />
SAP提供了一个函数，使报表运算过程可配置，提高了开发的灵活性<br />
<!--more--></p>

<h3 id="section-1">表定义</h3>
<p><img src="http://lomozm.github.io/images/images/EVAL_FORMULA_test.files/image001.png" alt="m001" /></p>

<h3 id="section-2">值输入</h3>
<p><img src="http://lomozm.github.io/images/images/EVAL_FORMULA_test.files/image003.png" alt="m002" /></p>

<h3 id="section-3">输出结果</h3>
<p><img src="http://lomozm.github.io/images/images/EVAL_FORMULA_test.files/image005.png" alt="m003" /></p>

<h3 id="section-4">程序代码</h3>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
<span class="line-number">24</span>
<span class="line-number">25</span>
<span class="line-number">26</span>
<span class="line-number">27</span>
<span class="line-number">28</span>
<span class="line-number">29</span>
<span class="line-number">30</span>
<span class="line-number">31</span>
<span class="line-number">32</span>
<span class="line-number">33</span>
<span class="line-number">34</span>
<span class="line-number">35</span>
<span class="line-number">36</span>
<span class="line-number">37</span>
<span class="line-number">38</span>
<span class="line-number">39</span>
<span class="line-number">40</span>
<span class="line-number">41</span>
<span class="line-number">42</span>
<span class="line-number">43</span>
<span class="line-number">44</span>
<span class="line-number">45</span>
<span class="line-number">46</span>
<span class="line-number">47</span>
<span class="line-number">48</span>
<span class="line-number">49</span>
<span class="line-number">50</span>
<span class="line-number">51</span>
<span class="line-number">52</span>
<span class="line-number">53</span>
<span class="line-number">54</span>
<span class="line-number">55</span>
<span class="line-number">56</span>
<span class="line-number">57</span>
<span class="line-number">58</span>
<span class="line-number">59</span>
<span class="line-number">60</span>
<span class="line-number">61</span>
<span class="line-number">62</span>
<span class="line-number">63</span>
<span class="line-number">64</span>
<span class="line-number">65</span>
<span class="line-number">66</span>
<span class="line-number">67</span>
<span class="line-number">68</span>
<span class="line-number">69</span>
<span class="line-number">70</span>
<span class="line-number">71</span>
<span class="line-number">72</span>
<span class="line-number">73</span>
<span class="line-number">74</span>
<span class="line-number">75</span>
<span class="line-number">76</span>
<span class="line-number">77</span>
<span class="line-number">78</span>
<span class="line-number">79</span>
<span class="line-number">80</span>
<span class="line-number">81</span>
<span class="line-number">82</span>
<span class="line-number">83</span>
<span class="line-number">84</span>
<span class="line-number">85</span>
<span class="line-number">86</span>
<span class="line-number">87</span>
<span class="line-number">88</span>
<span class="line-number">89</span>
<span class="line-number">90</span>
<span class="line-number">91</span>
<span class="line-number">92</span>
<span class="line-number">93</span>
<span class="line-number">94</span>
<span class="line-number">95</span>
<span class="line-number">96</span>
<span class="line-number">97</span>
<span class="line-number">98</span>
<span class="line-number">99</span>
<span class="line-number">100</span>
<span class="line-number">101</span>
<span class="line-number">102</span>
<span class="line-number">103</span>
<span class="line-number">104</span>
<span class="line-number">105</span>
<span class="line-number">106</span>
<span class="line-number">107</span>
<span class="line-number">108</span>
<span class="line-number">109</span>
<span class="line-number">110</span>
<span class="line-number">111</span>
<span class="line-number">112</span>
<span class="line-number">113</span>
<span class="line-number">114</span>
<span class="line-number">115</span>
<span class="line-number">116</span>
<span class="line-number">117</span>
<span class="line-number">118</span>
<span class="line-number">119</span>
<span class="line-number">120</span>
<span class="line-number">121</span>
<span class="line-number">122</span>
<span class="line-number">123</span>
<span class="line-number">124</span>
<span class="line-number">125</span>
<span class="line-number">126</span>
<span class="line-number">127</span>
<span class="line-number">128</span>
<span class="line-number">129</span>
<span class="line-number">130</span>
<span class="line-number">131</span>
<span class="line-number">132</span>
<span class="line-number">133</span>
<span class="line-number">134</span>
<span class="line-number">135</span>
<span class="line-number">136</span>
<span class="line-number">137</span>
<span class="line-number">138</span>
<span class="line-number">139</span>
<span class="line-number">140</span>
</pre></td><td class="code"><pre><code class=""><span class="line">*&amp;---------------------------------------------------------------------*
</span><span class="line">*&amp; Report  ZTEST03
</span><span class="line">*&amp; 公式计算测试
</span><span class="line">*&amp;---------------------------------------------------------------------*
</span><span class="line">*&amp;
</span><span class="line">*&amp;
</span><span class="line">*&amp;---------------------------------------------------------------------*
</span><span class="line">
</span><span class="line">REPORT  ZTEST03.
</span><span class="line">TYPE-POOLS:  slis.
</span><span class="line">TABLES: ZTEST03_TB.
</span><span class="line">
</span><span class="line">DATA: w_repid LIKE sy-repid,
</span><span class="line">   w_title TYPE lvc_title,
</span><span class="line">   tb_fieldcat TYPE slis_t_fieldcat_alv WITH HEADER LINE,
</span><span class="line">   wa_fields TYPE LINE OF slis_t_fieldcat_alv,
</span><span class="line">   tb_events TYPE slis_t_event WITH HEADER LINE,
</span><span class="line">   wa_layout   TYPE lvc_s_layo,
</span><span class="line">   wa_is_layout     TYPE slis_layout_alv.
</span><span class="line">DATA: gs_layout   TYPE lvc_s_layo.
</span><span class="line">
</span><span class="line">DATA: IT_TAB TYPE TABLE OF ZTEST03_TB WITH HEADER LINE.
</span><span class="line">DATA: IT_TAB2 TYPE TABLE OF ZTEST03_TB WITH HEADER LINE.
</span><span class="line">
</span><span class="line">START-OF-SELECTION.
</span><span class="line">
</span><span class="line">  REFRESH: IT_TAB, IT_TAB2.
</span><span class="line">  SELECT * INTO TABLE IT_TAB FROM ZTEST03_TB.
</span><span class="line">  IT_TAB2[] = IT_TAB[].
</span><span class="line">  LOOP AT IT_TAB WHERE CHAR02 IS NOT INITIAL.
</span><span class="line">    PERFORM FRM_CALCULATE_VALUE USING IT_TAB-DATA1
</span><span class="line">                                      IT_TAB-CHAR02.
</span><span class="line">
</span><span class="line">    MODIFY IT_TAB.
</span><span class="line">  ENDLOOP.
</span><span class="line">
</span><span class="line">END-OF-SELECTION.
</span><span class="line">  PERFORM append_alv USING 'NUMBE' '行号'.
</span><span class="line">  PERFORM append_alv USING 'CHAR01' '标识组1'.
</span><span class="line">  PERFORM append_alv USING 'CHAR02' '标识组2'.
</span><span class="line">  PERFORM append_alv USING 'DATA1' '值'.
</span><span class="line">  PERFORM append_alv USING 'MEINS' '单位'.
</span><span class="line">
</span><span class="line">perform display_alv tables it_tab.
</span><span class="line">
</span><span class="line">
</span><span class="line">FORM append_alv USING value(fieldname) TYPE c
</span><span class="line">                    value(fieldtxt) TYPE c.
</span><span class="line">  tb_fieldcat-fieldname    = fieldname.
</span><span class="line">  tb_fieldcat-reptext_ddic = fieldtxt.
</span><span class="line">  APPEND tb_fieldcat.CLEAR  tb_fieldcat.
</span><span class="line">ENDFORM.                    "append_alv
</span><span class="line">
</span><span class="line">*&amp;---------------------------------------------------------------------*
</span><span class="line">*&amp;      Form  FRM_CALCULATE_VALUE
</span><span class="line">*&amp;---------------------------------------------------------------------*
</span><span class="line">*       text
</span><span class="line">*----------------------------------------------------------------------*
</span><span class="line">*      --&gt;P_ZVALUE   text
</span><span class="line">*      --&gt;P_ZJSGS    text
</span><span class="line">*----------------------------------------------------------------------*
</span><span class="line">FORM FRM_CALCULATE_VALUE USING P_ZVALUE
</span><span class="line">                               P_ZJSGS.
</span><span class="line">*  DATA: FORMEL TYPE FORMEL.
</span><span class="line">  DATA: FORMEL(255) TYPE C.
</span><span class="line">  DATA: G_REPID LIKE SY-REPID.
</span><span class="line">  DATA: L_CC TYPE F.
</span><span class="line">
</span><span class="line">  FORMEL = P_ZJSGS.
</span><span class="line">  G_REPID = SY-REPID.
</span><span class="line">* Work out formula
</span><span class="line">  CALL FUNCTION 'EVAL_FORMULA'
</span><span class="line">    EXPORTING
</span><span class="line">      FORMULA = FORMEL
</span><span class="line">      PROGRAM = G_REPID
</span><span class="line">      ROUTINE = 'FRM_VAR_GET'
</span><span class="line">*        UNIT_OF_MEASURE = 'RMB'
</span><span class="line">    IMPORTING
</span><span class="line">      VALUE   =  L_CC
</span><span class="line">    EXCEPTIONS
</span><span class="line">      OTHERS  = 1.
</span><span class="line">
</span><span class="line">  P_ZVALUE = L_CC.
</span><span class="line">ENDFORM.                    " FRM_CALCULATE_VALUE
</span><span class="line">*&amp;---------------------------------------------------------------------*
</span><span class="line">*&amp;      Form  FRM_VAR_GET
</span><span class="line">*&amp;---------------------------------------------------------------------*
</span><span class="line">*       text
</span><span class="line">*----------------------------------------------------------------------*
</span><span class="line">*      --&gt;VALUE(NAME)   text
</span><span class="line">*      --&gt;VALUE(VALUE)  text
</span><span class="line">*      --&gt;VALUE(SUBRC)  text
</span><span class="line">*----------------------------------------------------------------------*
</span><span class="line">FORM FRM_VAR_GET USING VALUE(NAME)
</span><span class="line">         CHANGING VALUE(VALUE)
</span><span class="line">                  VALUE(SUBRC).
</span><span class="line">  SUBRC = 0.
</span><span class="line">  VALUE = 0.
</span><span class="line">  READ TABLE IT_TAB2 WITH KEY CHAR01 = NAME.
</span><span class="line">  IF SY-SUBRC = 0.
</span><span class="line">    VALUE = IT_TAB2-DATA1.
</span><span class="line">  ELSE.
</span><span class="line">    VALUE = 1.
</span><span class="line">  ENDIF.
</span><span class="line">
</span><span class="line">ENDFORM.                    "FRM_VAR_GET
</span><span class="line">*&amp;---------------------------------------------------------------------*
</span><span class="line">*&amp;      Form  DISPLAY_ALV
</span><span class="line">*&amp;---------------------------------------------------------------------*
</span><span class="line">*       text
</span><span class="line">*----------------------------------------------------------------------*
</span><span class="line">*      --&gt;P_IT_DATA  text
</span><span class="line">*----------------------------------------------------------------------*
</span><span class="line">FORM DISPLAY_ALV  tables  P_IT_DATA.
</span><span class="line">  w_repid = sy-repid.
</span><span class="line">  wa_is_layout-colwidth_optimize = 'X'.     "adjust line width automatic
</span><span class="line">  wa_is_layout-min_linesize      =  100.    "
</span><span class="line">  wa_is_layout-zebra      =  'X'.    "
</span><span class="line">
</span><span class="line">  CALL FUNCTION 'REUSE_ALV_GRID_DISPLAY'
</span><span class="line">    EXPORTING
</span><span class="line">      i_callback_program       = w_repid
</span><span class="line">      is_layout                = wa_is_layout
</span><span class="line">      it_fieldcat              = tb_fieldcat[]
</span><span class="line">*      i_save                   = 'A'
</span><span class="line">*      it_events                = tb_events[]
</span><span class="line">*      i_callback_pf_status_set = 'SET_PF_STATUS'
</span><span class="line">*      I_CALLBACK_USER_COMMAND  = L_USER_COMMAND
</span><span class="line">    TABLES
</span><span class="line">      t_outtab                 = P_IT_DATA[]
</span><span class="line">    EXCEPTIONS
</span><span class="line">      program_error            = 1
</span><span class="line">      OTHERS                   = 2.
</span><span class="line">
</span><span class="line">  IF sy-subrc &lt;&gt; 0.
</span><span class="line">    MESSAGE ID sy-msgid TYPE sy-msgty NUMBER sy-msgno
</span><span class="line">           WITH sy-msgv1 sy-msgv2 sy-msgv3 sy-msgv4.
</span><span class="line">  ENDIF.
</span><span class="line">
</span><span class="line">ENDFORM.</span></code></pre></td></tr></table></div></figure></notextile></div>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[物料编码生成/校验增强（MM01）]]></title>
    <link href="http://lomozm.github.io/blog/20131227/wu-liao-bian-ma-sheng-cheng-slash-xiao-yan-zeng-qiang-%28mm01%29/"/>
    <updated>2013-12-27T16:37:25+08:00</updated>
    <id>http://lomozm.github.io/blog/20131227/wu-liao-bian-ma-sheng-cheng-slash-xiao-yan-zeng-qiang-(mm01)</id>
    <content type="html"><![CDATA[
<p>用事务代码MM01建物料时，物料号生成有两种方式，系统自动分配和用户指定<br />
客户要求比较复杂的情况下（如：编号与物料组有关联），系统提供了相应出口进行编号的生成和校验<br />
tcode: smod<br />
增强：<code>MGA00002</code>:物料主文档（工业）：编号分配<br />
<!--more-->
<img src="http://lomozm.github.io/images/images/79d709262d17ae188283ff911bf5e1a8.jpeg" alt="m001" /><br /></p>

<h3 id="section">相关增强</h3>
<p><img src="http://lomozm.github.io/images/images/1177fb9b1742db2696a12ae3eabae1e4.jpeg" alt="m002" /><br /></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[销售开票更改凭证抬头和行项目 - RV60AFZC]]></title>
    <link href="http://lomozm.github.io/blog/20131227/xiao-shou-kai-piao-geng-gai-ping-zheng-tai-tou-he-xing-xiang-mu-rv60afzc/"/>
    <updated>2013-12-27T13:56:31+08:00</updated>
    <id>http://lomozm.github.io/blog/20131227/xiao-shou-kai-piao-geng-gai-ping-zheng-tai-tou-he-xing-xiang-mu-rv60afzc</id>
    <content type="html"><![CDATA[<p>该增强用于在开票过程中定制凭证抬头和行项目信息<br />
直接在se80中更改即可<br />
<!--more--></p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
<span class="line-number">24</span>
<span class="line-number">25</span>
<span class="line-number">26</span>
<span class="line-number">27</span>
<span class="line-number">28</span>
<span class="line-number">29</span>
<span class="line-number">30</span>
<span class="line-number">31</span>
<span class="line-number">32</span>
<span class="line-number">33</span>
<span class="line-number">34</span>
<span class="line-number">35</span>
<span class="line-number">36</span>
<span class="line-number">37</span>
<span class="line-number">38</span>
<span class="line-number">39</span>
<span class="line-number">40</span>
<span class="line-number">41</span>
<span class="line-number">42</span>
<span class="line-number">43</span>
<span class="line-number">44</span>
<span class="line-number">45</span>
<span class="line-number">46</span>
<span class="line-number">47</span>
<span class="line-number">48</span>
<span class="line-number">49</span>
<span class="line-number">50</span>
<span class="line-number">51</span>
<span class="line-number">52</span>
<span class="line-number">53</span>
<span class="line-number">54</span>
<span class="line-number">55</span>
<span class="line-number">56</span>
<span class="line-number">57</span>
<span class="line-number">58</span>
<span class="line-number">59</span>
<span class="line-number">60</span>
<span class="line-number">61</span>
<span class="line-number">62</span>
<span class="line-number">63</span>
<span class="line-number">64</span>
<span class="line-number">65</span>
<span class="line-number">66</span>
<span class="line-number">67</span>
<span class="line-number">68</span>
<span class="line-number">69</span>
<span class="line-number">70</span>
<span class="line-number">71</span>
<span class="line-number">72</span>
<span class="line-number">73</span>
<span class="line-number">74</span>
<span class="line-number">75</span>
<span class="line-number">76</span>
<span class="line-number">77</span>
<span class="line-number">78</span>
<span class="line-number">79</span>
<span class="line-number">80</span>
<span class="line-number">81</span>
<span class="line-number">82</span>
<span class="line-number">83</span>
<span class="line-number">84</span>
<span class="line-number">85</span>
<span class="line-number">86</span>
<span class="line-number">87</span>
<span class="line-number">88</span>
<span class="line-number">89</span>
<span class="line-number">90</span>
<span class="line-number">91</span>
<span class="line-number">92</span>
<span class="line-number">93</span>
<span class="line-number">94</span>
<span class="line-number">95</span>
<span class="line-number">96</span>
<span class="line-number">97</span>
<span class="line-number">98</span>
<span class="line-number">99</span>
</pre></td><td class="code"><pre><code class=""><span class="line">***INCLUDE RV60AFZC.
</span><span class="line">
</span><span class="line">************************************************************************
</span><span class="line">*                                                                      *
</span><span class="line">* This include is reserved for user modifications                      *
</span><span class="line">* Forms for invoicing                                                  *
</span><span class="line">* The name of modification modules should begin with 'ZZ'.             *
</span><span class="line">*                                                                      *
</span><span class="line">************************************************************************
</span><span class="line">*       USEREXIT_NUMBER_RANGE_INV_DATE                                 *
</span><span class="line">*       USEREXIT_FILL_VBRK_VBRP                                        *
</span><span class="line">************************************************************************
</span><span class="line">
</span><span class="line">*---------------------------------------------------------------------*
</span><span class="line">*       FORM USEREXIT_NUMBER_RANGE_INV_DATE                           *
</span><span class="line">*---------------------------------------------------------------------*
</span><span class="line">*       This userexit can be used to determine the numberranges for   *
</span><span class="line">*       the internal document number. This userexit can be used when  *
</span><span class="line">*       the number_ranger should impact the invoice date via table    *
</span><span class="line">*       TVFKD.                                                        *
</span><span class="line">*       If this userexit is active the USEREXIT_NUMBER_RANGE is not   *
</span><span class="line">*       processed anymore, that means this userexit has priority.     *
</span><span class="line">*       US_RANGE_INTERN - internal number range                       *
</span><span class="line">*       This form is called from form LV60AU02 and LV60AU11           *
</span><span class="line">*---------------------------------------------------------------------*
</span><span class="line">form userexit_number_range_inv_date using us_range_intern.
</span><span class="line">
</span><span class="line">* Example: Number range from TVFK like in standard
</span><span class="line">* US_RANGE_INTERN = TVFK-NUMKI.
</span><span class="line">
</span><span class="line">endform.
</span><span class="line">
</span><span class="line">*---------------------------------------------------------------------*
</span><span class="line">*       FORM USEREXIT_FILL_VBRK_VBRP                                  *
</span><span class="line">*---------------------------------------------------------------------*
</span><span class="line">*       This userexit can be used to fill fields in VBRK and VBRP     *
</span><span class="line">*       Be aware, that at this time the work areas KUAGV KURGV        *
</span><span class="line">*       KUWEV and KUREV are not filled.                               *
</span><span class="line">*       This form is called from FORM VBRK_VBRP_FUELLEN.              *
</span><span class="line">*---------------------------------------------------------------------*
</span><span class="line">form userexit_fill_vbrk_vbrp.
</span><span class="line">
</span><span class="line">* Example: change Tax country
</span><span class="line">*{   INSERT         DEVK900070                                        1
</span><span class="line">*
</span><span class="line">*  主机销售业务VF01开票时（根据销售业务的产品组判断是否为主机销售业务：10 装载机类、11  平地机类、12 挖掘装载机类、13 矿用自卸车、14  其他整机类），
</span><span class="line">*查找销售订单行项目主机物料主数据中“销售组织数据2”中的“物料组2（MVGR2）”字段信息；查找销售订单行项目所对应的产品序列号（SERNR）；
</span><span class="line">*  替换VBRK-ZUONR字段内容为“物料组2（MVGR2）&amp;序列号（SERNR）“
</span><span class="line">
</span><span class="line">*
</span><span class="line">*if sy-uname eq ‘LOMOZM'.
</span><span class="line">**RETURN.
</span><span class="line">*BREAK-POINT.
</span><span class="line">*ENDIF.
</span><span class="line">
</span><span class="line">*data: lt_xvbrk like TABLE OF xvbrk WITH HEADER LINE.
</span><span class="line">*lt_xvbrk[] = xvbrk[].
</span><span class="line">
</span><span class="line">if vbak-spart eq '10' or vbak-spart eq '11' or vbak-spart eq '12' or vbak-spart eq '13' or vbak-spart eq '14'.
</span><span class="line">
</span><span class="line">  check vbak-auart ne 'ZHOR'.  "排除自营出口销售定单类型
</span><span class="line">
</span><span class="line">  data: l_sernr type gernr,
</span><span class="line">        l_bezei type bezei40.
</span><span class="line">  clear: l_sernr.
</span><span class="line">  if lips is not initial.
</span><span class="line">     select single d~sernr into l_sernr
</span><span class="line">       from  ser01 as c inner join objk as d on c~obknr eq d~obknr
</span><span class="line">       where c~lief_nr eq lips-vbeln
</span><span class="line">*         and c~POSNR eq lips-POSNR
</span><span class="line">         and d~sernr ne ''
</span><span class="line">         and c~posnr eq ( select posnr from lips as a inner join mara as b on a~matnr eq b~matnr
</span><span class="line">                                              where vbeln eq lips-vbeln and b~mtart eq 'FERT' ).
</span><span class="line">  else.
</span><span class="line">     select single d~sernr into l_sernr
</span><span class="line">       from  ser02 as c inner join objk as d on c~obknr eq d~obknr
</span><span class="line">       where c~sdaufnr eq vbap-vbeln
</span><span class="line">*         and c~POSNR eq VBAP-POSNR
</span><span class="line">         and d~sernr ne ''
</span><span class="line">         and c~posnr eq ( select posnr from vbap as a inner join mara as b on a~matnr eq b~matnr
</span><span class="line">                                              where vbeln eq vbap-vbeln and b~mtart eq 'FERT' ).
</span><span class="line">
</span><span class="line">  endif.
</span><span class="line">  if l_sernr is not initial. " and vbap-MVGR2 is not INITIAL.
</span><span class="line">*     select SINGLE BEZEI into l_BEZEI from TVM2T where MVGR2 eq vbap-MVGR2 and spras eq sy-langu.
</span><span class="line">*     if l_BEZEI is not INITIAL.
</span><span class="line">*         CONCATENATE l_BEZEI l_sernr+8(10) into VBRK-ZUONR SEPARATED BY '&amp;'.
</span><span class="line">*     endif.
</span><span class="line">     vbrk-zuonr = l_sernr.
</span><span class="line">  else.
</span><span class="line">*     MESSAGE E001(00) WITH '无法确定主机销售业务机型机号'.
</span><span class="line">  endif.
</span><span class="line">endif.
</span><span class="line">
</span><span class="line">
</span><span class="line">*}   INSERT
</span><span class="line">* VBRK-LANDTX = T001-LAND1.
</span><span class="line">
</span><span class="line">endform.</span></code></pre></td></tr></table></div></figure></notextile></div>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[MB1A - Goods movements - for unique batch number]]></title>
    <link href="http://lomozm.github.io/blog/20131227/mb1a-goods-movements-for-unique-batch-number/"/>
    <updated>2013-12-27T13:48:36+08:00</updated>
    <id>http://lomozm.github.io/blog/20131227/mb1a-goods-movements-for-unique-batch-number</id>
    <content type="html"><![CDATA[
<h3 id="question">Question:</h3>

<p>I am using the batch management for the raw materials ,When i do the GI to production order i enterd the batch number .But when i return excess material /defect material to wh (reversal of GI ) , system gave the message that &#8220;Caution! Internal number allocation for materials handled in batches&#8221; . As this is information message , The system  should allow same batch number which is used at the time of GI .</p>
<!--more-->
<p>What is name the user exit ? Or with the help of the configuaration can we control….</p>

<h3 id="answer">Answer:</h3>

<p>For unique batch number try these exits</p>
<p><code>SAPLV01Z-LV01ZU05 XVBZ-&gt;EXIT_V01Z_002</code> <code>SAPLV01Z</code> CFCs for internal batch number assignment</p>
<p><code>SAPLV01Z-LV01ZU07 XVBZ-&gt;EXIT_V01Z_003</code> <code>SAPLV1ZE</code> CFCs for external batch number assignment</p>
<p>Also refer this link:</p>
<p><a href="http://help.sap.com/saphelp_40b/helpdata/ru/dc/1d4b6e5733d1118b3f0060b03ca329/content.htm">http://help.sap.com/saphelp_40b/helpdata/ru/dc/1d4b6e5733d1118b3f0060b03ca329/content.htm</a></p>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[销售售发货badi - LE_SHP_DELIVERY_PROC]]></title>
    <link href="http://lomozm.github.io/blog/20131226/xiao-shou-shou-fa-huo-badi-le-shp-delivery-proc/"/>
    <updated>2013-12-26T15:17:42+08:00</updated>
    <id>http://lomozm.github.io/blog/20131226/xiao-shou-shou-fa-huo-badi-le-shp-delivery-proc</id>
    <content type="html"><![CDATA[
<p>业务要求，销售定单里的行项目交货完成后，自动更改其开票冻结标识；同时，当取消交货后，又改回冻结状态<br /></p>

<h3 id="section">实现方法</h3>
<p>通过实现<code>badi:LE_SHP_DELIVERY_PROC</code>的<code>save_and_publish_document</code>方法，可以完成；因为销售交货及取消都用到这个badi<br />
<!--more-->
<img src="http://lomozm.github.io/images/images/157a73d626f831258455b03c20b5fd96.jpeg" alt="m001" /><br /></p>

<h3 id="section-1">源代码</h3>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
<span class="line-number">24</span>
<span class="line-number">25</span>
<span class="line-number">26</span>
<span class="line-number">27</span>
<span class="line-number">28</span>
<span class="line-number">29</span>
<span class="line-number">30</span>
<span class="line-number">31</span>
<span class="line-number">32</span>
<span class="line-number">33</span>
<span class="line-number">34</span>
<span class="line-number">35</span>
<span class="line-number">36</span>
<span class="line-number">37</span>
<span class="line-number">38</span>
<span class="line-number">39</span>
<span class="line-number">40</span>
<span class="line-number">41</span>
<span class="line-number">42</span>
<span class="line-number">43</span>
<span class="line-number">44</span>
<span class="line-number">45</span>
<span class="line-number">46</span>
<span class="line-number">47</span>
<span class="line-number">48</span>
<span class="line-number">49</span>
<span class="line-number">50</span>
<span class="line-number">51</span>
<span class="line-number">52</span>
<span class="line-number">53</span>
<span class="line-number">54</span>
<span class="line-number">55</span>
<span class="line-number">56</span>
<span class="line-number">57</span>
<span class="line-number">58</span>
<span class="line-number">59</span>
<span class="line-number">60</span>
<span class="line-number">61</span>
<span class="line-number">62</span>
<span class="line-number">63</span>
<span class="line-number">64</span>
<span class="line-number">65</span>
<span class="line-number">66</span>
<span class="line-number">67</span>
<span class="line-number">68</span>
</pre></td><td class="code"><pre><code class=""><span class="line">method if_ex_le_shp_delivery_proc~save_and_publish_document.
</span><span class="line">*  message I001(00) with 'test!'.
</span><span class="line">  data: begin of wa_vbelv_so,
</span><span class="line">          vbelv type vbeln_von,
</span><span class="line">          posnv type posnr_von,
</span><span class="line">          sign type c,
</span><span class="line">      end of wa_vbelv_so.
</span><span class="line">  data: it_vbelv_so like table of wa_vbelv_so.
</span><span class="line">
</span><span class="line">  data: it_vbak type table of vbak,
</span><span class="line">        wa_vbak type vbak,
</span><span class="line">        it_shp_vl10_vbfa_t type shp_vl10_vbfa_t,
</span><span class="line">        wa_shp_vl10_vbfa_t type vbfavb,
</span><span class="line">        it_return type table of bapiret2,
</span><span class="line">        wa_return type bapiret2,
</span><span class="line">        wa_xvbuk type vbukvb.
</span><span class="line">
</span><span class="line">  data: wa_bapisdh1 type bapisdh1,
</span><span class="line">        wa_bapisdh1x type bapisdh1x.
</span><span class="line">
</span><span class="line">  if ( if_tcode eq 'VL02N' or if_tcode eq 'VL01N' ) ."and ( sy-ucomm eq 'WABU_T' )." or sy-ucomm eq 'SICH_T' ).  "事物代码vl01n,vl02n时，当出现发货过帐'WABU_T'事件
</span><span class="line">    loop at it_xvbfa into wa_shp_vl10_vbfa_t where vbtyp_n eq 'J'.  "后续单据为交货单
</span><span class="line">      append wa_shp_vl10_vbfa_t to it_shp_vl10_vbfa_t.
</span><span class="line">
</span><span class="line">      move-corresponding wa_shp_vl10_vbfa_t to wa_vbelv_so.
</span><span class="line">      clear: wa_vbelv_so-sign.
</span><span class="line">      append wa_vbelv_so to it_vbelv_so.    "取销售定单号
</span><span class="line">    endloop.
</span><span class="line">
</span><span class="line">    sort it_vbelv_so by vbelv posnv.
</span><span class="line">    delete adjacent duplicates from it_vbelv_so comparing vbelv." posnv.
</span><span class="line">    loop at it_vbelv_so into wa_vbelv_so.
</span><span class="line">      select single * into wa_vbak from vbak where vbeln eq wa_vbelv_so-vbelv and auart eq 'ZSPT'.  "只针对订单类型'ZSPT'
</span><span class="line">      if sy-subrc ne 0.
</span><span class="line">        wa_vbelv_so-sign = 'X'.
</span><span class="line">        modify it_vbelv_so index sy-tabix from wa_vbelv_so transporting sign.
</span><span class="line">      endif.
</span><span class="line">    endloop.
</span><span class="line">    delete it_vbelv_so where sign eq 'X'.
</span><span class="line">
</span><span class="line">    loop at it_xvbuk into wa_xvbuk.
</span><span class="line">      read table it_vbelv_so into wa_vbelv_so  with key vbelv = wa_xvbuk-vbeln binary search.
</span><span class="line">      if sy-subrc eq 0 and wa_xvbuk-lfgsk eq 'C'.   "销售定单为全部交货
</span><span class="line">        if sy-tcode eq 'VL09' and sy-ucomm eq 'YES'.  "取消发货过帐
</span><span class="line">          wa_bapisdh1-bill_block = '05'.  "开票冻结“检查交货条款”
</span><span class="line">        elseif sy-ucomm eq 'WABU_T'.   "发货过帐'WABU_T'事件
</span><span class="line">          clear:  wa_bapisdh1-bill_block.
</span><span class="line">        else.
</span><span class="line">          exit.
</span><span class="line">        endif.
</span><span class="line">        wa_bapisdh1x-updateflag = 'U'.
</span><span class="line">        wa_bapisdh1x-bill_block = 'X'.
</span><span class="line">        call function 'BAPI_SALESORDER_CHANGE'     "更改销售定单
</span><span class="line">          exporting
</span><span class="line">            salesdocument    = wa_xvbuk-vbeln
</span><span class="line">            order_header_in  = wa_bapisdh1
</span><span class="line">            order_header_inx = wa_bapisdh1x
</span><span class="line">          tables
</span><span class="line">            return           = it_return.
</span><span class="line">        loop at it_return into wa_return where type eq 'E' or type eq 'A'.
</span><span class="line">          message e001(00) with wa_return-message.
</span><span class="line">          return.
</span><span class="line">        endloop.
</span><span class="line">      endif.
</span><span class="line">    endloop.
</span><span class="line">
</span><span class="line">  endif.
</span><span class="line">endmethod.</span></code></pre></td></tr></table></div></figure></notextile></div>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[销售定单成本显示增强 - LV69AFZZ]]></title>
    <link href="http://lomozm.github.io/blog/20131226/xiao-shou-ding-dan-cheng-ben-xian-shi-zeng-qiang-lv69afzz/"/>
    <updated>2013-12-26T13:53:22+08:00</updated>
    <id>http://lomozm.github.io/blog/20131226/xiao-shou-ding-dan-cheng-ben-xian-shi-zeng-qiang-lv69afzz</id>
    <content type="html"><![CDATA[
<p>业务有时需要部分用户不能看到销售定单的价格，这时我们可以在增强中实现<br />
分两步：1. 在销售定单中处理；2. 在凭证流中处理<br /></p>

<h3 id="section">在销售定单中</h3>
<p>更改<code>INCLUDE LV69AFZZ</code>各个form，先在<code>include</code>中增加下面定义<br /></p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
</pre></td><td class="code"><pre><code class=""><span class="line">DATA: OLD_KOMV LIKE KOMV,
</span><span class="line"> OLD_KOMK LIKE KOMK.
</span><span class="line"> DATA: AUTH_SUBRC LIKE SY-SUBRC.</span></code></pre></td></tr></table></div></figure></notextile></div>

<!--more-->

<p>然后更改<br /></p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
<span class="line-number">24</span>
<span class="line-number">25</span>
<span class="line-number">26</span>
<span class="line-number">27</span>
<span class="line-number">28</span>
<span class="line-number">29</span>
<span class="line-number">30</span>
<span class="line-number">31</span>
<span class="line-number">32</span>
<span class="line-number">33</span>
<span class="line-number">34</span>
<span class="line-number">35</span>
<span class="line-number">36</span>
<span class="line-number">37</span>
<span class="line-number">38</span>
<span class="line-number">39</span>
<span class="line-number">40</span>
<span class="line-number">41</span>
<span class="line-number">42</span>
<span class="line-number">43</span>
<span class="line-number">44</span>
<span class="line-number">45</span>
<span class="line-number">46</span>
<span class="line-number">47</span>
<span class="line-number">48</span>
<span class="line-number">49</span>
<span class="line-number">50</span>
<span class="line-number">51</span>
<span class="line-number">52</span>
<span class="line-number">53</span>
<span class="line-number">54</span>
<span class="line-number">55</span>
<span class="line-number">56</span>
<span class="line-number">57</span>
<span class="line-number">58</span>
<span class="line-number">59</span>
<span class="line-number">60</span>
<span class="line-number">61</span>
<span class="line-number">62</span>
</pre></td><td class="code"><pre><code class=""><span class="line">form userexit_field_modific_leer.
</span><span class="line">  INCLUDE ZZAUTH01.
</span><span class="line"> *}   INSERT
</span><span class="line"> endform.                        " USEREXIT_FIELD_MODIFIC_LEER
</span><span class="line"> *&amp;---------------------------------------------------------------------*
</span><span class="line"> *&amp;      Form  USEREXIT_FIELD_MODIFIC_KZWI
</span><span class="line"> *&amp;---------------------------------------------------------------------*
</span><span class="line"> *       text
</span><span class="line"> *----------------------------------------------------------------------*
</span><span class="line"> *  --&gt;  p1        text
</span><span class="line"> *  &lt;--  p2        text
</span><span class="line"> *----------------------------------------------------------------------*
</span><span class="line"> form userexit_field_modific_kzwi.
</span><span class="line">  INCLUDE ZZAUTH01.
</span><span class="line"> *}   INSERT
</span><span class="line"> endform.                        " USEREXIT_FIELD_MODIFIC_KZWI
</span><span class="line"> *&amp;---------------------------------------------------------------------*
</span><span class="line"> *&amp;      Form  USEREXIT_FIELD_MODIFIC_KOPF
</span><span class="line"> *&amp;---------------------------------------------------------------------*
</span><span class="line"> *       text
</span><span class="line"> *----------------------------------------------------------------------*
</span><span class="line"> *  --&gt;  p1        text
</span><span class="line"> *  &lt;--  p2        text
</span><span class="line"> *----------------------------------------------------------------------*
</span><span class="line"> form userexit_field_modific_kopf.
</span><span class="line">  INCLUDE ZZAUTH01.
</span><span class="line"> *}   INSERT
</span><span class="line"> endform.                   " USEREXIT_FIELD_MODIFIC_KOPF
</span><span class="line"> *&amp;---------------------------------------------------------------------*
</span><span class="line"> *&amp;      Form  USEREXIT_FIELD_MODIFICATION
</span><span class="line"> *&amp;---------------------------------------------------------------------*
</span><span class="line"> *       text
</span><span class="line"> *----------------------------------------------------------------------*
</span><span class="line"> *  --&gt;  p1        text
</span><span class="line"> *  &lt;--  p2        text
</span><span class="line"> *----------------------------------------------------------------------*
</span><span class="line"> form userexit_field_modification.
</span><span class="line">  INCLUDE ZZAUTH01.
</span><span class="line"> *}   INSERT
</span><span class="line"> endform.                       " USEREXIT_FIELD_MODIFICATION
</span><span class="line"> *&amp;---------------------------------------------------------------------*
</span><span class="line"> *&amp;      Form  USEREXIT_PRICING_CHECK
</span><span class="line"> *&amp;---------------------------------------------------------------------*
</span><span class="line"> *       text
</span><span class="line"> *----------------------------------------------------------------------*
</span><span class="line"> *  --&gt;  p1        text
</span><span class="line"> *  &lt;--  p2        text
</span><span class="line"> *----------------------------------------------------------------------*
</span><span class="line"> form userexit_pricing_check.
</span><span class="line">  INCLUDE ZZAUTH02.
</span><span class="line"> *}   INSERT
</span><span class="line"> endform.                             " USEREXIT_PRICING_CHECK
</span><span class="line"> *&amp;---------------------------------------------------------------------*
</span><span class="line"> *&amp;      Form  USEREXIT_CHANGE_PRICING_RULE
</span><span class="line"> *&amp;---------------------------------------------------------------------*
</span><span class="line"> *       text
</span><span class="line"> *----------------------------------------------------------------------*
</span><span class="line"> *      --&gt;P_RV61A_KSTEU  text
</span><span class="line"> *----------------------------------------------------------------------*
</span><span class="line"> form userexit_change_pricing_rule using    p_rv61a_ksteu.
</span><span class="line">
</span><span class="line"> endform.                        " USEREXIT_CHANGE_PRICING_RULE</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>程序名：<br />
<code>ZZAUTH01:   Authorization check for the condition screen</code><br />
<code>ZZAUTH02:   Authorization check for the creation of conditions</code><br /></p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
<span class="line-number">24</span>
<span class="line-number">25</span>
<span class="line-number">26</span>
<span class="line-number">27</span>
<span class="line-number">28</span>
<span class="line-number">29</span>
<span class="line-number">30</span>
<span class="line-number">31</span>
<span class="line-number">32</span>
<span class="line-number">33</span>
<span class="line-number">34</span>
<span class="line-number">35</span>
<span class="line-number">36</span>
<span class="line-number">37</span>
<span class="line-number">38</span>
<span class="line-number">39</span>
<span class="line-number">40</span>
<span class="line-number">41</span>
<span class="line-number">42</span>
<span class="line-number">43</span>
<span class="line-number">44</span>
<span class="line-number">45</span>
<span class="line-number">46</span>
<span class="line-number">47</span>
<span class="line-number">48</span>
<span class="line-number">49</span>
<span class="line-number">50</span>
</pre></td><td class="code"><pre><code class=""><span class="line">*&amp;---------------------------------------------------------------------*
</span><span class="line"> *&amp;  Include           ZZAUTH01
</span><span class="line"> *&amp;---------------------------------------------------------------------*
</span><span class="line"> * Beim ersten Aufruf ist KOMV initial; OLD_KOMK löschen,
</span><span class="line"> * damit auf jeden Fall Berechtigungsprüfung durchgeführt wird.
</span><span class="line"> * Sicherheitshalber zunächst Berechtigung verweigern.
</span><span class="line">
</span><span class="line"> * if komv is initial.
</span><span class="line">  IF SCREEN-NAME = 'FCODE'.
</span><span class="line">    CLEAR OLD_KOMK.
</span><span class="line">    AUTH_SUBRC = 4.
</span><span class="line">  ENDIF.
</span><span class="line">
</span><span class="line"> * Berechtigungsprüfung auf Kalkulationsschema und Stufen-Nr.
</span><span class="line"> * Beim Wechsel der KOMV-Zeile einmalig eine Berechtigungsprüfung
</span><span class="line"> * durchführen
</span><span class="line">  IF KOMK-KALSM NE OLD_KOMK-KALSM OR KOMV-STUNR NE OLD_KOMV-STUNR.
</span><span class="line">    AUTHORITY-CHECK OBJECT 'Z_KONH_KLS'
</span><span class="line">               ID 'ZKALSM' FIELD KOMK-KALSM
</span><span class="line">               ID 'ZSTUNR' FIELD KOMV-STUNR
</span><span class="line">               ID 'ACTVT' DUMMY.
</span><span class="line">    AUTH_SUBRC = SY-SUBRC.
</span><span class="line">    OLD_KOMK = KOMK.
</span><span class="line">    OLD_KOMV = KOMV.
</span><span class="line">  ENDIF.
</span><span class="line">
</span><span class="line">  IF AUTH_SUBRC NE 0 AND ( SCREEN-NAME = 'RV61A-SELKZ'
</span><span class="line">                    OR   SCREEN-NAME = 'KOMV-KAWRT'"条件基值
</span><span class="line">                    OR   SCREEN-NAME = 'RV61A-AWEIN'
</span><span class="line">                    OR   SCREEN-NAME = 'KOMV-KBETR' "VK11中金额
</span><span class="line">                    OR   SCREEN-NAME = 'RV61A-KOEIN'"VK11-货币
</span><span class="line">                    OR   SCREEN-NAME = 'KOMV-KPEIN'"VK11-单位
</span><span class="line">                    OR   SCREEN-NAME = 'KOMV-KMEIN'"VK11-UoM
</span><span class="line">                    OR   SCREEN-NAME = 'KOMV-KWERT' )."定价值
</span><span class="line">    SCREEN-ACTIVE = 0.
</span><span class="line">  ENDIF.
</span><span class="line">  MODIFY SCREEN.
</span><span class="line"> * Ende Berechtigungsprüfung-------------------------------------
</span><span class="line"> *&amp;---------------------------------------------------------------------*  
</span><span class="line"> 2）ZZAUTH02
</span><span class="line"> ***INCLUDE ZZAUTH02.
</span><span class="line">    AUTHORITY-CHECK OBJECT 'Z_KONH_KLS'
</span><span class="line">               ID 'ZKALSM' FIELD KOMK-KALSM
</span><span class="line">               ID 'ZSTUNR' FIELD KOMV-STUNR
</span><span class="line">               ID 'ACTVT' DUMMY.
</span><span class="line">    IF SY-SUBRC NE 0.
</span><span class="line">      MESSAGE E609(VH).
</span><span class="line">    ENDIF.
</span><span class="line">
</span><span class="line"> * Ende Berechtigungsprüfung</span></code></pre></td></tr></table></div></figure></notextile></div>

<p><img src="http://lomozm.github.io/images/images/a95fb0bdc96efb93da5b8d3331cfd91d.jpeg" alt="m001" /><br /></p>

<h3 id="section-1">在凭证流中</h3>
<p>在<code>include LDOCUMENT_FLOW_ALVF01</code>中的<code>FORM DISPLAY_DOCUMENT_FLOW</code>前端添加增强，删除参考值和货币数据即可，使金额不显示：<br /></p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
</pre></td><td class="code"><pre><code class=""><span class="line">FIELD-SYMBOLS: &lt;WA_DOCFLOW&gt; TYPE DOCUMENT_FLOW_ALV_STRUC.
</span><span class="line">  LOOP AT GT_DOCFLOW ASSIGNING &lt;WA_DOCFLOW&gt;.
</span><span class="line">     CLEAR: &lt;WA_DOCFLOW&gt;-RFWRT,
</span><span class="line">            &lt;WA_DOCFLOW&gt;-WAERS.
</span><span class="line">*    modify gt_docflow.
</span><span class="line">  ENDLOOP.</span></code></pre></td></tr></table></div></figure></notextile></div>

<p><img src="http://lomozm.github.io/images/images/0cf1722fb9de37455d6f9f3e4c5aefbd.jpeg" alt="m002" /><br /></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[BW层次主数据加载]]></title>
    <link href="http://lomozm.github.io/blog/20131226/bwceng-ci-zhu-shu-ju-jia-zai/"/>
    <updated>2013-12-26T11:12:19+08:00</updated>
    <id>http://lomozm.github.io/blog/20131226/bwceng-ci-zhu-shu-ju-jia-zai</id>
    <content type="html"><![CDATA[
<h3 id="r3ksh2">R3系统中，事务代码KSH2，在源数据中新增成本中心</h3>
<p><img src="http://lomozm.github.io/images/images/hierarchyloadetl.files/image001.png" alt="m001" /><br />
<!--more-->
### BW系统中，事务代码RSA1，上载成本中心（0COSTCENTER）数据，可以看出层次更新有两个，在此分别表示中/英文
<img src="http://lomozm.github.io/images/images/hierarchyloadetl.files/image003.png" alt="m002" /><br /></p>

<h3 id="full">上载路径：文本 -&gt; 属性 -&gt; 层次结构，且只用FULL上载就可以了，因为主数据上载是覆盖性的</h3>
<p><img src="http://lomozm.github.io/images/images/hierarchyloadetl.files/image005.png" alt="m003" /><br />
可以看出这个上载已在处理链中，单击开始进行文本上载，同时对于主数据属性的更新也是如此<br />
<img src="http://lomozm.github.io/images/images/hierarchyloadetl.files/image007.png" alt="m004" /><br /></p>

<h3 id="r3infopackage">对于层次上载，在“层次结构选择”中可以看到来自R3的所有成本中心层次；如果需要上载多个层次结构，则需要建多个InfoPackage来上载相应数据，然后开始上载</h3>
<p><img src="http://lomozm.github.io/images/images/hierarchyloadetl.files/image009.jpg" alt="m005" /><br /></p>

<h3 id="bwrsh1">上载成功后，BW系统中，事务代码RSH1，可以看到更新的内容</h3>
<p><img src="http://lomozm.github.io/images/images/hierarchyloadetl.files/image011.png" alt="m006" /><br /></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[SAP工作流开发实例]]></title>
    <link href="http://lomozm.github.io/blog/20131225/sapgong-zuo-liu-kai-fa-shi-li/"/>
    <updated>2013-12-25T16:33:52+08:00</updated>
    <id>http://lomozm.github.io/blog/20131225/sapgong-zuo-liu-kai-fa-shi-li</id>
    <content type="html"><![CDATA[
<p>开发事务代码目录截屏<br />
<img src="http://lomozm.github.io/images/images/SAPWorkFlowStepbyStep.files/image001.png" alt="m001" /><br />
其他可能使用到的事务代码——<br />
SWE2：显示/维护事件类型链接<br />
SWEL：显示事件记录<br />
 <!--more--></p>

<h3 id="tcode-su01">准备 – Tcode: su01创建接收工作流用户</h3>
<p>创建用户名: GW-TEST2, 密码: ******；当工作流提交后，下一步处理的用户<br />
<img src="http://lomozm.github.io/images/images/SAPWorkFlowStepbyStep.files/image002.png" alt="m002" /><br /></p>

<h3 id="tcode-se11-">步骤1 – Tcode: se11 建表存储工作流数据</h3>
<p>表ZWFTST01用于存放工作流审批数据<br />
<img src="http://lomozm.github.io/images/images/SAPWorkFlowStepbyStep.files/image003.png" alt="m003" /><br />
表<code>ZWFTST02</code>用于存放工作流内容数据<br />
<img src="http://lomozm.github.io/images/images/SAPWorkFlowStepbyStep.files/image004.png" alt="m004" /><br /></p>

<h3 id="tcode-se80">步骤2 - Tcode: se80函数组</h3>
<p>工作流的数据操作使用函数方式调用，必需放在在函数组中<br />
函数组名：<code>ZTEST_SWF</code>，创建后，使它激活<br />
<img src="http://lomozm.github.io/images/images/SAPWorkFlowStepbyStep.files/image005.png" alt="m005" /><br />
进入函数组，在<code>INCLUDE LZTEST_SWFTOP</code>中加入全局定义数据<br />
<img src="http://lomozm.github.io/images/images/SAPWorkFlowStepbyStep.files/image006.png" alt="m006" /><br /></p>

<h3 id="tcode-se37-">步骤3 – Tcode: se37 创建工作流界面处理函数</h3>
<p>工作流处理过程中，需要对数据进行操作，同时，数据处理完成后，提交到下一个节点处理。这些都是函数<code>ZTEST_SWF_SCREEN_01</code>的功能<br />
<img src="http://lomozm.github.io/images/images/SAPWorkFlowStepbyStep.files/image007.png" alt="m007" /><br />
输入参数<br />
<img src="http://lomozm.github.io/images/images/SAPWorkFlowStepbyStep.files/image008.png" alt="m008" /><br />
屏幕调用<br />
<img src="http://lomozm.github.io/images/images/SAPWorkFlowStepbyStep.files/image009.png" alt="m009" /><br />
状态0100定义<br />
<img src="http://lomozm.github.io/images/images/SAPWorkFlowStepbyStep.files/image010.png" alt="m010" /><br />
标题0100定义<br />
<img src="http://lomozm.github.io/images/images/SAPWorkFlowStepbyStep.files/image011.png" alt="m011" /><br />
屏幕0100逻辑流截屏<br />
<img src="http://lomozm.github.io/images/images/SAPWorkFlowStepbyStep.files/image012.png" alt="m012" /><br />
附函数源代码<br />
Data define——<br /></p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
</pre></td><td class="code"><pre><code class=""><span class="line">FUNCTION-POOL ZTEST_SWF.                    "MESSAGE-ID ..
</span><span class="line">INCLUDE &lt;cntn01&gt;. "操作工作流的容器元素
</span><span class="line">
</span><span class="line">data: gwa_02 type ZWFTST02,
</span><span class="line">      gwa_01 type zwftst01.
</span><span class="line">
</span><span class="line">DATA: OK_CODE TYPE SY-UCOMM.
</span><span class="line">
</span><span class="line">data: it_pa0001 type table of pa0001 with header line.
</span><span class="line">data: g_string type char20.
</span><span class="line">
</span><span class="line">*&amp;SPWIZARD: DECLARATION OF TABLECONTROL 'TAB_CONTROL' ITSELF
</span><span class="line">CONTROLS: TAB_CONTROL TYPE TABLEVIEW USING SCREEN 0100.</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>Before output——<br /></p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
<span class="line-number">24</span>
<span class="line-number">25</span>
<span class="line-number">26</span>
<span class="line-number">27</span>
<span class="line-number">28</span>
<span class="line-number">29</span>
<span class="line-number">30</span>
</pre></td><td class="code"><pre><code class=""><span class="line">*----------------------------------------------------------------------*
</span><span class="line">***INCLUDE LZTEST_SWFO01 .
</span><span class="line">*----------------------------------------------------------------------*
</span><span class="line">*&amp;---------------------------------------------------------------------*
</span><span class="line">*&amp;      Module  STATUS_0100  OUTPUT
</span><span class="line">*&amp;---------------------------------------------------------------------*
</span><span class="line">*       text
</span><span class="line">*----------------------------------------------------------------------*
</span><span class="line">MODULE STATUS_0100 OUTPUT.
</span><span class="line">  SET PF-STATUS '0100'.
</span><span class="line">  SET TITLEBAR '100'.
</span><span class="line">
</span><span class="line">  clear: ok_code.
</span><span class="line">  perform get_initial using gwa_02-wfcode.
</span><span class="line">
</span><span class="line">ENDMODULE.                 " STATUS_0100  OUTPUT
</span><span class="line">
</span><span class="line">*&amp;SPWIZARD: OUTPUT MODULE FOR TC 'TAB_CONTROL'. DO NOT CHANGE THIS LINE!
</span><span class="line">*&amp;SPWIZARD: UPDATE LINES FOR EQUIVALENT SCROLLBAR
</span><span class="line">MODULE TAB_CONTROL_CHANGE_TC_ATTR OUTPUT.
</span><span class="line">  DESCRIBE TABLE IT_PA0001 LINES TAB_CONTROL-lines.
</span><span class="line">ENDMODULE.                    "TAB_CONTROL_CHANGE_TC_ATTR OUTPUT
</span><span class="line">*&amp;---------------------------------------------------------------------*
</span><span class="line">*&amp;      Module  GET_INITIAL_DATA  OUTPUT
</span><span class="line">*&amp;---------------------------------------------------------------------*
</span><span class="line">*       text
</span><span class="line">*----------------------------------------------------------------------*
</span><span class="line">MODULE GET_INITIAL_DATA OUTPUT.
</span><span class="line">  select * into table it_pa0001 from pa0001 up to 2 rows.
</span><span class="line">ENDMODULE.                 " GET_INITIAL_DATA  OUTPUT</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>After input——<br /></p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
<span class="line-number">24</span>
<span class="line-number">25</span>
<span class="line-number">26</span>
<span class="line-number">27</span>
<span class="line-number">28</span>
<span class="line-number">29</span>
<span class="line-number">30</span>
</pre></td><td class="code"><pre><code class=""><span class="line">*----------------------------------------------------------------------*
</span><span class="line">***INCLUDE LZTEST_SWFI01 .
</span><span class="line">*----------------------------------------------------------------------*
</span><span class="line">*&amp;---------------------------------------------------------------------*
</span><span class="line">*&amp;      Module  SCREEN_EXIT  INPUT
</span><span class="line">*&amp;---------------------------------------------------------------------*
</span><span class="line">*       text
</span><span class="line">*----------------------------------------------------------------------*
</span><span class="line">MODULE SCREEN_EXIT INPUT.
</span><span class="line">  leave program.
</span><span class="line">ENDMODULE.                 " SCREEN_EXIT  INPUT
</span><span class="line">*&amp;---------------------------------------------------------------------*
</span><span class="line">*&amp;      Module  USER_COMMAND_0100  INPUT
</span><span class="line">*&amp;---------------------------------------------------------------------*
</span><span class="line">*       text
</span><span class="line">*----------------------------------------------------------------------*
</span><span class="line">MODULE USER_COMMAND_0100 INPUT.
</span><span class="line">  case ok_code.
</span><span class="line">    when 'APPRO'.
</span><span class="line">      PERFORM CALL_APPROVAL_WF.
</span><span class="line">      LEAVE TO SCREEN 0.
</span><span class="line">    WHEN 'REJEC'.
</span><span class="line">      PERFORM CALL_REJECT_WF.
</span><span class="line">      LEAVE TO SCREEN 0.
</span><span class="line">    when 'CLICK'.
</span><span class="line">      PERFORM DOUBLE_CLICK_PROCESS." '-然后，进行处理
</span><span class="line">    WHEN 'BACK'.
</span><span class="line">      LEAVE TO SCREEN 0.
</span><span class="line">  ENDCASE.
</span><span class="line">ENDMODULE.                 " USER_COMMAND_0100  INPUT</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>Forms——<br /></p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
<span class="line-number">24</span>
<span class="line-number">25</span>
<span class="line-number">26</span>
<span class="line-number">27</span>
<span class="line-number">28</span>
<span class="line-number">29</span>
<span class="line-number">30</span>
<span class="line-number">31</span>
<span class="line-number">32</span>
<span class="line-number">33</span>
<span class="line-number">34</span>
<span class="line-number">35</span>
<span class="line-number">36</span>
<span class="line-number">37</span>
<span class="line-number">38</span>
<span class="line-number">39</span>
<span class="line-number">40</span>
<span class="line-number">41</span>
<span class="line-number">42</span>
<span class="line-number">43</span>
<span class="line-number">44</span>
<span class="line-number">45</span>
<span class="line-number">46</span>
<span class="line-number">47</span>
<span class="line-number">48</span>
<span class="line-number">49</span>
<span class="line-number">50</span>
<span class="line-number">51</span>
<span class="line-number">52</span>
<span class="line-number">53</span>
<span class="line-number">54</span>
<span class="line-number">55</span>
<span class="line-number">56</span>
<span class="line-number">57</span>
<span class="line-number">58</span>
<span class="line-number">59</span>
<span class="line-number">60</span>
<span class="line-number">61</span>
<span class="line-number">62</span>
<span class="line-number">63</span>
<span class="line-number">64</span>
<span class="line-number">65</span>
<span class="line-number">66</span>
<span class="line-number">67</span>
<span class="line-number">68</span>
<span class="line-number">69</span>
<span class="line-number">70</span>
<span class="line-number">71</span>
<span class="line-number">72</span>
<span class="line-number">73</span>
<span class="line-number">74</span>
<span class="line-number">75</span>
<span class="line-number">76</span>
<span class="line-number">77</span>
<span class="line-number">78</span>
<span class="line-number">79</span>
<span class="line-number">80</span>
<span class="line-number">81</span>
<span class="line-number">82</span>
<span class="line-number">83</span>
<span class="line-number">84</span>
<span class="line-number">85</span>
<span class="line-number">86</span>
<span class="line-number">87</span>
<span class="line-number">88</span>
<span class="line-number">89</span>
<span class="line-number">90</span>
<span class="line-number">91</span>
<span class="line-number">92</span>
<span class="line-number">93</span>
<span class="line-number">94</span>
<span class="line-number">95</span>
<span class="line-number">96</span>
<span class="line-number">97</span>
<span class="line-number">98</span>
<span class="line-number">99</span>
<span class="line-number">100</span>
<span class="line-number">101</span>
<span class="line-number">102</span>
<span class="line-number">103</span>
<span class="line-number">104</span>
<span class="line-number">105</span>
<span class="line-number">106</span>
<span class="line-number">107</span>
<span class="line-number">108</span>
<span class="line-number">109</span>
<span class="line-number">110</span>
<span class="line-number">111</span>
<span class="line-number">112</span>
<span class="line-number">113</span>
<span class="line-number">114</span>
<span class="line-number">115</span>
<span class="line-number">116</span>
<span class="line-number">117</span>
<span class="line-number">118</span>
<span class="line-number">119</span>
<span class="line-number">120</span>
<span class="line-number">121</span>
<span class="line-number">122</span>
<span class="line-number">123</span>
<span class="line-number">124</span>
<span class="line-number">125</span>
<span class="line-number">126</span>
<span class="line-number">127</span>
<span class="line-number">128</span>
<span class="line-number">129</span>
<span class="line-number">130</span>
<span class="line-number">131</span>
<span class="line-number">132</span>
<span class="line-number">133</span>
<span class="line-number">134</span>
<span class="line-number">135</span>
<span class="line-number">136</span>
<span class="line-number">137</span>
</pre></td><td class="code"><pre><code class=""><span class="line">*----------------------------------------------------------------------*
</span><span class="line">*  INCLUDE LZTEST_SWFF01 .
</span><span class="line">*----------------------------------------------------------------------*
</span><span class="line">*&amp;---------------------------------------------------------------------*
</span><span class="line">*&amp;      Form  GET_INITIAL
</span><span class="line">*&amp;---------------------------------------------------------------------*
</span><span class="line">*       text
</span><span class="line">*----------------------------------------------------------------------*
</span><span class="line">*      --&gt;P_GWA_02_WFCODE  text
</span><span class="line">*----------------------------------------------------------------------*
</span><span class="line">FORM GET_INITIAL  USING    P_GWA_02_WFCODE.
</span><span class="line">
</span><span class="line">  select single * into gwa_01 from ZWFTST01
</span><span class="line">    where wfcode eq P_GWA_02_WFCODE.
</span><span class="line">
</span><span class="line">ENDFORM.                    " GET_INITIAL
</span><span class="line">*&amp;---------------------------------------------------------------------*
</span><span class="line">*&amp;      Form  CALL_APPROVAL_WF
</span><span class="line">*&amp;---------------------------------------------------------------------*
</span><span class="line">*       text
</span><span class="line">*----------------------------------------------------------------------*
</span><span class="line">*  --&gt;  p1        text
</span><span class="line">*  &lt;--  p2        text
</span><span class="line">*----------------------------------------------------------------------*
</span><span class="line">FORM CALL_APPROVAL_WF .
</span><span class="line">  DATA: ls_instanceid TYPE char32,
</span><span class="line">        ls_event TYPE char61,
</span><span class="line">        ls_workflowname TYPE char30.
</span><span class="line">  DATA: im_event_container TYPE REF TO if_swf_ifs_parameter_container.
</span><span class="line">  DATA: ls_rc TYPE sy-subrc.
</span><span class="line">
</span><span class="line">  CONCATENATE 'Z##' gwa_02-wFcode  INTO LS_INSTANCEID.  "工作流号码
</span><span class="line">
</span><span class="line">  LS_EVENT        = 'APPROVED'.
</span><span class="line">  LS_WORKFLOWNAME = 'ZTEST_SWF01_01'.
</span><span class="line">  CALL METHOD CL_SWF_EVT_EVENT=&gt;GET_EVENT_CONTAINER
</span><span class="line">    EXPORTING
</span><span class="line">      IM_OBJCATEG  = CL_SWF_EVT_EVENT=&gt;MC_OBJCATEG_CL
</span><span class="line">      IM_OBJTYPE   = LS_WORKFLOWNAME
</span><span class="line">      IM_EVENT     = LS_EVENT
</span><span class="line">    RECEIVING
</span><span class="line">      RE_REFERENCE = IM_EVENT_CONTAINER.
</span><span class="line">
</span><span class="line">** because APPROVED event have not parameters
</span><span class="line">
</span><span class="line">*  CALL METHOD IM_EVENT_CONTAINER-&gt;SET
</span><span class="line">*    EXPORTING
</span><span class="line">*      NAME  = 'PARA_EV_SIGN'
</span><span class="line">*      VALUE = l_PARA_EV_SIGN.
</span><span class="line">
</span><span class="line">  CALL FUNCTION 'ZTRIGGERWF'
</span><span class="line">    EXPORTING
</span><span class="line">      INSTANCEID         = LS_INSTANCEID
</span><span class="line">      EVENT              = LS_EVENT
</span><span class="line">      WORKFLOWNAME       = LS_WORKFLOWNAME
</span><span class="line">      IM_EVENT_CONTAINER = IM_EVENT_CONTAINER
</span><span class="line">    IMPORTING
</span><span class="line">      RC                 = LS_RC.
</span><span class="line">  IF LS_RC = 0.
</span><span class="line">    gwa_02-state = 'M'.   "to modify text
</span><span class="line">    modify ZWFTST02 from gwa_02.
</span><span class="line">
</span><span class="line">    LEAVE TO SCREEN 0.
</span><span class="line">  endif.
</span><span class="line">
</span><span class="line">ENDFORM.                    " CALL_APPROVAL_WF
</span><span class="line">*&amp;---------------------------------------------------------------------*
</span><span class="line">*&amp;      Form  CALL_REJECT_WF
</span><span class="line">*&amp;---------------------------------------------------------------------*
</span><span class="line">*       text
</span><span class="line">*----------------------------------------------------------------------*
</span><span class="line">*  --&gt;  p1        text
</span><span class="line">*  &lt;--  p2        text
</span><span class="line">*----------------------------------------------------------------------*
</span><span class="line">FORM CALL_REJECT_WF .
</span><span class="line">  DATA: ls_instanceid TYPE char32,
</span><span class="line">        ls_event TYPE char61,
</span><span class="line">        ls_workflowname TYPE char30.
</span><span class="line">  DATA: im_event_container TYPE REF TO if_swf_ifs_parameter_container.
</span><span class="line">  DATA: ls_rc TYPE sy-subrc.
</span><span class="line">
</span><span class="line">  CONCATENATE 'Z##' gwa_02-wFcode  INTO LS_INSTANCEID.  "工作流号码
</span><span class="line">
</span><span class="line">  LS_EVENT        = 'REJECTED'.
</span><span class="line">  LS_WORKFLOWNAME = 'ZTEST_SWF01_01'.
</span><span class="line">  CALL METHOD CL_SWF_EVT_EVENT=&gt;GET_EVENT_CONTAINER
</span><span class="line">    EXPORTING
</span><span class="line">      IM_OBJCATEG  = CL_SWF_EVT_EVENT=&gt;MC_OBJCATEG_CL
</span><span class="line">      IM_OBJTYPE   = LS_WORKFLOWNAME
</span><span class="line">      IM_EVENT     = LS_EVENT
</span><span class="line">    RECEIVING
</span><span class="line">      RE_REFERENCE = IM_EVENT_CONTAINER.
</span><span class="line">
</span><span class="line">** because REJECTED event have not parameters
</span><span class="line">
</span><span class="line">*  CALL METHOD IM_EVENT_CONTAINER-&gt;SET
</span><span class="line">*    EXPORTING
</span><span class="line">*      NAME  = 'PARA_EV_SIGN'
</span><span class="line">*      VALUE = l_PARA_EV_SIGN.
</span><span class="line">
</span><span class="line">  CALL FUNCTION 'ZTRIGGERWF'
</span><span class="line">    EXPORTING
</span><span class="line">      INSTANCEID         = LS_INSTANCEID
</span><span class="line">      EVENT              = LS_EVENT
</span><span class="line">      WORKFLOWNAME       = LS_WORKFLOWNAME
</span><span class="line">      IM_EVENT_CONTAINER = IM_EVENT_CONTAINER
</span><span class="line">    IMPORTING
</span><span class="line">      RC                 = LS_RC.
</span><span class="line">  IF LS_RC = 0.
</span><span class="line">    gwa_02-state = 'E'.   "to mail
</span><span class="line">    modify ZWFTST02 from gwa_02.
</span><span class="line">
</span><span class="line">    LEAVE TO SCREEN 0.
</span><span class="line">  endif.
</span><span class="line">ENDFORM.                    " CALL_REJECT_WF
</span><span class="line">*&amp;---------------------------------------------------------------------*
</span><span class="line">*&amp;      Form  DOUBLE_CLICK_PROCESS
</span><span class="line">*&amp;---------------------------------------------------------------------*
</span><span class="line">*       text
</span><span class="line">*----------------------------------------------------------------------*
</span><span class="line">*  --&gt;  p1        text
</span><span class="line">*  &lt;--  p2        text
</span><span class="line">*----------------------------------------------------------------------*
</span><span class="line">FORM DOUBLE_CLICK_PROCESS .
</span><span class="line">  DATA: LV_LINE       TYPE I,
</span><span class="line">          LV_CUR_LINE   TYPE I.
</span><span class="line">
</span><span class="line">* GET CURSOR FIELD f LINE l OFFSET o.
</span><span class="line">  GET CURSOR LINE LV_CUR_LINE.  "--先取得光标所在的行
</span><span class="line">  LV_LINE = TAB_CONTROL-TOP_LINE + LV_CUR_LINE - 1.  "--然后，计算对应着的内表中的行
</span><span class="line">
</span><span class="line">*  READ TABLE GT_ZESTSR01 INDEX LV_LINE. " --然后读取内表中双击行的内容，进行下的处理
</span><span class="line">*  IF GT_ZESTSR01-END_IL NE '99991231'.
</span><span class="line">*    ......processing......
</span><span class="line">*  ENDIF.
</span><span class="line">
</span><span class="line">ENDFORM.</span></code></pre></td></tr></table></div></figure></notextile></div>

<h3 id="tcodese37">步骤4 – Tcode:se37创建获取审批人函数</h3>
<p>创建函数<code>ZTEST_SWF_GET_APPROVER</code>取得工作流的审批人<br />
<img src="http://lomozm.github.io/images/images/SAPWorkFlowStepbyStep.files/image017.png" alt="m017" /><br />
参数<br />
<img src="http://lomozm.github.io/images/images/SAPWorkFlowStepbyStep.files/image018.png" alt="m018" /><br />
源代码截屏<br />
<img src="http://lomozm.github.io/images/images/SAPWorkFlowStepbyStep.files/image019.png" alt="m019" /><br /></p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
<span class="line-number">24</span>
<span class="line-number">25</span>
<span class="line-number">26</span>
<span class="line-number">27</span>
<span class="line-number">28</span>
<span class="line-number">29</span>
<span class="line-number">30</span>
<span class="line-number">31</span>
<span class="line-number">32</span>
</pre></td><td class="code"><pre><code class=""><span class="line">FUNCTION ZTEST_SWF_GET_APPROVER.
</span><span class="line">*"----------------------------------------------------------------------
</span><span class="line">*"*"Local interface:
</span><span class="line">*"  TABLES
</span><span class="line">*"      AC_CONTAINER STRUCTURE  SWCONT
</span><span class="line">*"      ACTOR_TAB STRUCTURE  SWHACTOR
</span><span class="line">*"----------------------------------------------------------------------
</span><span class="line">
</span><span class="line">*  DATA:l_czlx TYPE char02,
</span><span class="line">*       l_hzdh TYPE z00hrhzdh,
</span><span class="line">*       l_hcws TYPE z00hrhcws.
</span><span class="line">  data: wf_code_cont type char20,
</span><span class="line">        wa_ZWFTST01 type ZWFTST01.
</span><span class="line">  swc_container_to_runtime ac_container.
</span><span class="line">  REFRESH actor_tab.
</span><span class="line">*&amp; 获取工作流中的容器元素值
</span><span class="line">*  swc_get_element ac_container 'CZLX'    l_czlx.
</span><span class="line">*  swc_get_element ac_container 'HZDH'    l_hzdh.
</span><span class="line">*  swc_get_element ac_container 'HCWS'    l_hcws.
</span><span class="line">  swc_get_element ac_container 'WF_CODE_CONT'    wf_code_cont.
</span><span class="line">**加入审批用户
</span><span class="line">  select single * into corresponding fields of wa_ZWFTST01
</span><span class="line">    from ZWFTST01
</span><span class="line">    where WFCODE eq wf_code_cont.
</span><span class="line">  if sy-subrc eq 0.
</span><span class="line">    actor_tab-objid = wa_ZWFTST01-APPRO.
</span><span class="line">  else.
</span><span class="line">    actor_tab-objid = 'GW-ZM'.
</span><span class="line">  endif.
</span><span class="line">  actor_tab-otype = 'US'.   "用户类型
</span><span class="line">  APPEND actor_tab.
</span><span class="line">ENDFUNCTION.</span></code></pre></td></tr></table></div></figure></notextile></div>

<h3 id="tcode-se37--1">步骤5 – Tcode: se37 创建工作流触发函数</h3>
<p>创建函数<code>ZTRIGGERWF</code>，在程序中调用该函数触发工作流<br />
参数<br />
<img src="http://lomozm.github.io/images/images/SAPWorkFlowStepbyStep.files/image020.png" alt="m020" /><br />
<img src="http://lomozm.github.io/images/images/SAPWorkFlowStepbyStep.files/image021.png" alt="m021" /><br />
代码截屏<br />
<img src="http://lomozm.github.io/images/images/SAPWorkFlowStepbyStep.files/image022.png" alt="m022" /><br /></p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
<span class="line-number">24</span>
<span class="line-number">25</span>
<span class="line-number">26</span>
<span class="line-number">27</span>
<span class="line-number">28</span>
<span class="line-number">29</span>
<span class="line-number">30</span>
<span class="line-number">31</span>
<span class="line-number">32</span>
<span class="line-number">33</span>
<span class="line-number">34</span>
<span class="line-number">35</span>
<span class="line-number">36</span>
<span class="line-number">37</span>
<span class="line-number">38</span>
</pre></td><td class="code"><pre><code class=""><span class="line">FUNCTION ZTRIGGERWF.
</span><span class="line">*"----------------------------------------------------------------------
</span><span class="line">*"*"Local interface:
</span><span class="line">*"  IMPORTING
</span><span class="line">*"     VALUE(INSTANCEID) TYPE  CHAR32
</span><span class="line">*"     VALUE(EVENT) TYPE  CHAR61
</span><span class="line">*"     VALUE(WORKFLOWNAME) TYPE  CHAR30
</span><span class="line">*"     REFERENCE(IM_EVENT_CONTAINER) TYPE REF TO
</span><span class="line">*"        IF_SWF_IFS_PARAMETER_CONTAINER OPTIONAL
</span><span class="line">*"  EXPORTING
</span><span class="line">*"     REFERENCE(RC) TYPE  SY-SUBRC
</span><span class="line">*"----------------------------------------------------------------------
</span><span class="line">  DATA:
</span><span class="line">           lv_objtype       TYPE sibftypeid,
</span><span class="line">           lv_event         TYPE sibfevent,
</span><span class="line">           lv_objkey        TYPE sibfinstid.
</span><span class="line">
</span><span class="line">  lv_objtype = workflowname.
</span><span class="line">  lv_event   = event.
</span><span class="line">  lv_objkey = instanceid.
</span><span class="line">
</span><span class="line">* Raise the event
</span><span class="line">  TRY.
</span><span class="line">      CALL METHOD cl_swf_evt_event=&gt;raise
</span><span class="line">        EXPORTING
</span><span class="line">          im_objcateg = cl_swf_evt_event=&gt;mc_objcateg_cl
</span><span class="line">          im_objtype  = lv_objtype
</span><span class="line">          im_event    = lv_event
</span><span class="line">          im_objkey   = lv_objkey
</span><span class="line">          im_event_container = im_event_container.
</span><span class="line">      rc = 0.
</span><span class="line">    CATCH cx_swf_evt_invalid_objtype .
</span><span class="line">      rc = 1.
</span><span class="line">    CATCH cx_swf_evt_invalid_event .
</span><span class="line">      rc = 2.
</span><span class="line">  ENDTRY.
</span><span class="line">  COMMIT WORK AND WAIT.
</span><span class="line">ENDFUNCTION.</span></code></pre></td></tr></table></div></figure></notextile></div>

<h3 id="tcode-se80-">步骤6 – Tcode: se80 创建工作流处理类</h3>
<p>创建类<code>ZTEST_SWF01_01</code>用于响应工作流处理过程中的事件<br />
<img src="http://lomozm.github.io/images/images/SAPWorkFlowStepbyStep.files/image023.png" alt="m023" /><br />
<img src="http://lomozm.github.io/images/images/SAPWorkFlowStepbyStep.files/image024.png" alt="m024" /><br />
<img src="http://lomozm.github.io/images/images/SAPWorkFlowStepbyStep.files/image025.png" alt="m025" /><br />
<img src="http://lomozm.github.io/images/images/SAPWorkFlowStepbyStep.files/image026.png" alt="m026" /><br />
新增 3 接口(仅需这3个就行了)：<code>BI_OBJECT</code>，<code>BI_PERSISTENT</code>，<code>IF_WORKFLOW</code><br />
<img src="http://lomozm.github.io/images/images/SAPWorkFlowStepbyStep.files/image027.png" alt="m027" /><br />
新增属性，<code>SIBFLPOR</code>是必需的<br />
<img src="http://lomozm.github.io/images/images/SAPWorkFlowStepbyStep.files/image028.png" alt="m028" /><br />
新增方法，<code>CONSTRUCTOR</code>是必需的<br />
<img src="http://lomozm.github.io/images/images/SAPWorkFlowStepbyStep.files/image029.png" alt="m029" /><br />
各方法的参数<br />
<img src="http://lomozm.github.io/images/images/SAPWorkFlowStepbyStep.files/image030.png" alt="m030" /><br />
<img src="http://lomozm.github.io/images/images/SAPWorkFlowStepbyStep.files/image031.png" alt="m031" /><br />
<img src="http://lomozm.github.io/images/images/SAPWorkFlowStepbyStep.files/image032.png" alt="m032" /><br />
方法<code>CONSTRUCTOR</code>代码<br />
<img src="http://lomozm.github.io/images/images/SAPWorkFlowStepbyStep.files/image033.png" alt="m033" /><br />
方法<code>BI_PERSISTENT~FIND_BY_LPOR</code>代码<br />
<img src="http://lomozm.github.io/images/images/SAPWorkFlowStepbyStep.files/image034.png" alt="m034" /><br />
方法<code>BI_PERSISTENT~LPOR</code>代码<br />
<img src="http://lomozm.github.io/images/images/SAPWorkFlowStepbyStep.files/image035.png" alt="m035" /><br />
方法<code>METH_DISPLAY</code>代码<br />
<img src="http://lomozm.github.io/images/images/SAPWorkFlowStepbyStep.files/image036.png" alt="m036" /><br />
方法<code>APPROVE</code>代码<br />
<img src="http://lomozm.github.io/images/images/SAPWorkFlowStepbyStep.files/image037.png" alt="m037" /><br />
新增事件<br />
<img src="http://lomozm.github.io/images/images/SAPWorkFlowStepbyStep.files/image038.png" alt="m038" /><br />
事件参数<br />
<img src="http://lomozm.github.io/images/images/SAPWorkFlowStepbyStep.files/image039.png" alt="m039" /><br />
最后，激活该类<br /></p>

<h3 id="tcodese24">步骤7 – Tcode:se24事件完成后执行该类中事件</h3>
<p>新类<code>ZTEST_SWF01_EXIT</code>从demo类<code>CL_SWF_WORKITEM_EXIT_TST</code>拷贝过来，再改方法<code>CHANGE_CONT_ELEMENT</code>基本不需要更改<br />
<img src="http://lomozm.github.io/images/images/SAPWorkFlowStepbyStep.files/image040.png" alt="m040" /><br /></p>

<h3 id="tcode-pfacins-">步骤8 – Tcode: PFAC_INS 创建审批规则</h3>
<p><img src="http://lomozm.github.io/images/images/SAPWorkFlowStepbyStep.files/image041.png" alt="m041" /><br />
<img src="http://lomozm.github.io/images/images/SAPWorkFlowStepbyStep.files/image042.png" alt="m042" /><br /></p>

<h3 id="tcode-swdb-">步骤9 – Tcode: swdb 新建工作流</h3>
<p>新建工作流<code>zwf_test001</code><br />
<img src="http://lomozm.github.io/images/images/SAPWorkFlowStepbyStep.files/image043.png" alt="m043" /><br />
选择工作流容器<br />
<img src="http://lomozm.github.io/images/images/SAPWorkFlowStepbyStep.files/image044.png" alt="m044" /><br />
向容器中新增元素<br />
<img src="http://lomozm.github.io/images/images/SAPWorkFlowStepbyStep.files/image045.png" alt="m045" /><br />
<img src="http://lomozm.github.io/images/images/SAPWorkFlowStepbyStep.files/image046.png" alt="m046" /><br />
<img src="http://lomozm.github.io/images/images/SAPWorkFlowStepbyStep.files/image047.png" alt="m047" /><br />
<img src="http://lomozm.github.io/images/images/SAPWorkFlowStepbyStep.files/image048.png" alt="m048" /><br />
保存该工作流，系统会自动分配工作流编号<br />
<img src="http://lomozm.github.io/images/images/SAPWorkFlowStepbyStep.files/image049.png" alt="m049" /><br />
维护工作流头部信息<br />
<img src="http://lomozm.github.io/images/images/SAPWorkFlowStepbyStep.files/image050.png" alt="m050" /><br />
设置开始事件<br />
<img src="http://lomozm.github.io/images/images/SAPWorkFlowStepbyStep.files/image051.png" alt="m051" /><br />
为该事件绑定输入参数<br />
<img src="http://lomozm.github.io/images/images/SAPWorkFlowStepbyStep.files/image052.png" alt="m052" /><br />
<em>注意: 参数传输过程!!</em><br />
激活开始事件<br />
<img src="http://lomozm.github.io/images/images/SAPWorkFlowStepbyStep.files/image053.png" alt="m053" /><br />
回到工作流设计主界面, 双击<img src="http://lomozm.github.io/images/images/SAPWorkFlowStepbyStep.files/image054.png" alt="m054" />, 选择<img src="http://lomozm.github.io/images/images/SAPWorkFlowStepbyStep.files/image055.png" alt="m055" /><br />创建任务<br />
<img src="http://lomozm.github.io/images/images/SAPWorkFlowStepbyStep.files/image056.png" alt="m056" /><br />
输入文本信息, 因为不需要参数传输，不需要点击<img src="http://lomozm.github.io/images/images/SAPWorkFlowStepbyStep.files/image057.png" alt="m057" /><br />
<img src="http://lomozm.github.io/images/images/SAPWorkFlowStepbyStep.files/image058.png" alt="m058" /><br />
新增元素<code>WF_code_cont</code>到容器中<br />
<img src="http://lomozm.github.io/images/images/SAPWorkFlowStepbyStep.files/image059.png" alt="m059" /><br />
新增结束事件，当前事件结束后，可能触发的事件，主要用于事件之间的参数传递<br />
<img src="http://lomozm.github.io/images/images/SAPWorkFlowStepbyStep.files/image060.png" alt="m060" /><br />
<img src="http://lomozm.github.io/images/images/SAPWorkFlowStepbyStep.files/image061.png" alt="m061" /><br />
保存并回退, 如果出现下面屏幕, 选<img src="http://lomozm.github.io/images/images/SAPWorkFlowStepbyStep.files/image062.png" alt="m062" /><br />
<img src="http://lomozm.github.io/images/images/SAPWorkFlowStepbyStep.files/image063.png" alt="m063" /><br />
<img src="http://lomozm.github.io/images/images/SAPWorkFlowStepbyStep.files/image064.png" alt="m064" /><br />
<img src="http://lomozm.github.io/images/images/SAPWorkFlowStepbyStep.files/image065.png" alt="m065" /><br />
分配审批规则，选择步骤8定义的规则<br />
<img src="http://lomozm.github.io/images/images/SAPWorkFlowStepbyStep.files/image066.png" alt="m066" /><br />
参数绑定<br />
<img src="http://lomozm.github.io/images/images/SAPWorkFlowStepbyStep.files/image067.png" alt="m067" /><br />
该事件完成了，屏幕如下<br />
<img src="http://lomozm.github.io/images/images/SAPWorkFlowStepbyStep.files/image068.png" alt="m068" /><br />
再把<code>ZTEST_SWF01_EXIT</code>类加入<code>program exits</code>中<br />
<img src="http://lomozm.github.io/images/images/SAPWorkFlowStepbyStep.files/image069.png" alt="m069" /><br />
如果出现下面信息：<br />
<img src="http://lomozm.github.io/images/images/SAPWorkFlowStepbyStep.files/image070.png" alt="m070" /><br />
点击<img src="http://lomozm.github.io/images/images/SAPWorkFlowStepbyStep.files/image071.png" alt="m071" /><br />
<img src="http://lomozm.github.io/images/images/SAPWorkFlowStepbyStep.files/image072.png" alt="m072" /><br />
选“一般任务”，再<img src="http://lomozm.github.io/images/images/SAPWorkFlowStepbyStep.files/image073.png" alt="m073" />就行了<br />
新增邮件事件在拒绝线上，右击鼠标<br />
<img src="http://lomozm.github.io/images/images/SAPWorkFlowStepbyStep.files/image074.png" alt="m074" /><br />
<img src="http://lomozm.github.io/images/images/SAPWorkFlowStepbyStep.files/image075.png" alt="m075" /><br />
<img src="http://lomozm.github.io/images/images/SAPWorkFlowStepbyStep.files/image076.png" alt="m076" /><br />
点击<img src="http://lomozm.github.io/images/images/SAPWorkFlowStepbyStep.files/image073.png" alt="m073" />完成步聚<br />
再新增一个事件<br />
<img src="http://lomozm.github.io/images/images/SAPWorkFlowStepbyStep.files/image077.png" alt="m077" /><br />
点击<img src="http://lomozm.github.io/images/images/SAPWorkFlowStepbyStep.files/image073.png" alt="m073" />完成步聚<br />
最终流程图<br />
<img src="http://lomozm.github.io/images/images/SAPWorkFlowStepbyStep.files/image078.png" alt="m078" /><br /></p>

<h3 id="tcode-se38-">步骤10 – Tcode: se38 新增程序去触发流程开始</h3>
<p>完整代码<br /></p>

<p>方法1:<br /></p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
<span class="line-number">24</span>
<span class="line-number">25</span>
<span class="line-number">26</span>
<span class="line-number">27</span>
<span class="line-number">28</span>
<span class="line-number">29</span>
<span class="line-number">30</span>
<span class="line-number">31</span>
<span class="line-number">32</span>
<span class="line-number">33</span>
<span class="line-number">34</span>
<span class="line-number">35</span>
<span class="line-number">36</span>
<span class="line-number">37</span>
<span class="line-number">38</span>
<span class="line-number">39</span>
<span class="line-number">40</span>
<span class="line-number">41</span>
<span class="line-number">42</span>
<span class="line-number">43</span>
<span class="line-number">44</span>
<span class="line-number">45</span>
<span class="line-number">46</span>
<span class="line-number">47</span>
<span class="line-number">48</span>
<span class="line-number">49</span>
<span class="line-number">50</span>
<span class="line-number">51</span>
<span class="line-number">52</span>
<span class="line-number">53</span>
<span class="line-number">54</span>
<span class="line-number">55</span>
<span class="line-number">56</span>
<span class="line-number">57</span>
<span class="line-number">58</span>
<span class="line-number">59</span>
<span class="line-number">60</span>
<span class="line-number">61</span>
</pre></td><td class="code"><pre><code class=""><span class="line">FORM CREATE_WORKFLOW .
</span><span class="line">  DATA: ls_instanceid TYPE char32,
</span><span class="line">        ls_event TYPE char61,
</span><span class="line">        ls_workflowname TYPE char30.
</span><span class="line">  DATA: im_event_container TYPE REF TO if_swf_ifs_parameter_container.
</span><span class="line">  DATA: ls_rc TYPE sy-subrc.
</span><span class="line">
</span><span class="line">  data: l_PARA_EV_SIGN type char10,
</span><span class="line">        lwa_test02 type ZWFTST02,
</span><span class="line">        lwa_test01 type zwftst01.
</span><span class="line">
</span><span class="line">  check p_wcode is not initial.
</span><span class="line">  lwa_test02-wfcode = p_wcode.
</span><span class="line">  lwa_test02-ctext = p_ctext.
</span><span class="line">
</span><span class="line">  lwa_test01-wfcode = p_wcode.
</span><span class="line">  lwa_test01-CUSER = sy-uname.
</span><span class="line">  lwa_test01-CDATE = sy-datum.
</span><span class="line">  lwa_test01-appro = p_appro.
</span><span class="line">  modify zwftst01 from  lwa_test01.
</span><span class="line">
</span><span class="line">  CONCATENATE 'Z##' p_wcode  INTO LS_INSTANCEID.  "工作流号码
</span><span class="line">  lwa_test02-WFCODENO = LS_INSTANCEID.
</span><span class="line">  lwa_test02-state = 'C'.
</span><span class="line">  modify ZWFTST02 from lwa_test02.
</span><span class="line">
</span><span class="line">  LS_EVENT        = 'CREATED'.
</span><span class="line">  LS_WORKFLOWNAME = 'ZTEST_SWF01_01'.
</span><span class="line">  CALL METHOD CL_SWF_EVT_EVENT=&gt;GET_EVENT_CONTAINER
</span><span class="line">    EXPORTING
</span><span class="line">      IM_OBJCATEG  = CL_SWF_EVT_EVENT=&gt;MC_OBJCATEG_CL
</span><span class="line">      IM_OBJTYPE   = LS_WORKFLOWNAME
</span><span class="line">      IM_EVENT     = LS_EVENT
</span><span class="line">    RECEIVING
</span><span class="line">      RE_REFERENCE = IM_EVENT_CONTAINER.
</span><span class="line">
</span><span class="line">  l_PARA_EV_SIGN = p_wcode.
</span><span class="line">  CALL METHOD IM_EVENT_CONTAINER-&gt;SET
</span><span class="line">    EXPORTING
</span><span class="line">      NAME  = 'PARA_EV_SIGN'
</span><span class="line">      VALUE = l_PARA_EV_SIGN.
</span><span class="line">
</span><span class="line">  CALL FUNCTION 'ZTRIGGERWF'
</span><span class="line">    EXPORTING
</span><span class="line">      INSTANCEID         = LS_INSTANCEID
</span><span class="line">      EVENT              = LS_EVENT
</span><span class="line">      WORKFLOWNAME       = LS_WORKFLOWNAME
</span><span class="line">      IM_EVENT_CONTAINER = IM_EVENT_CONTAINER
</span><span class="line">    IMPORTING
</span><span class="line">      RC                 = LS_RC.
</span><span class="line">  IF LS_RC = 0.
</span><span class="line">    lwa_test02-state = 'A'.
</span><span class="line">    modify ZWFTST02 from lwa_test02.
</span><span class="line">    if sy-subrc eq 0.
</span><span class="line">      write: / 'The work flow: ',
</span><span class="line">                p_wcode,
</span><span class="line">                ' is started'.
</span><span class="line">    endif.
</span><span class="line">  endif.
</span><span class="line">
</span><span class="line">ENDFORM.</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>方法2:<br /></p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
<span class="line-number">24</span>
<span class="line-number">25</span>
<span class="line-number">26</span>
<span class="line-number">27</span>
<span class="line-number">28</span>
<span class="line-number">29</span>
<span class="line-number">30</span>
<span class="line-number">31</span>
<span class="line-number">32</span>
<span class="line-number">33</span>
<span class="line-number">34</span>
<span class="line-number">35</span>
<span class="line-number">36</span>
<span class="line-number">37</span>
<span class="line-number">38</span>
<span class="line-number">39</span>
<span class="line-number">40</span>
<span class="line-number">41</span>
<span class="line-number">42</span>
<span class="line-number">43</span>
<span class="line-number">44</span>
<span class="line-number">45</span>
<span class="line-number">46</span>
<span class="line-number">47</span>
<span class="line-number">48</span>
<span class="line-number">49</span>
<span class="line-number">50</span>
<span class="line-number">51</span>
<span class="line-number">52</span>
</pre></td><td class="code"><pre><code class=""><span class="line">FORM CREATE_WORKFLOW2 .
</span><span class="line">  DATA: ZAGENTS  LIKE TABLE OF SWHACTOR WITH HEADER LINE.   "agents
</span><span class="line">  DATA WF_INITIATOR LIKE SWHACTOR   OCCURS 1 WITH HEADER LINE.
</span><span class="line">  DATA BEGIN OF WI_CONTAINER OCCURS 0.
</span><span class="line">          INCLUDE STRUCTURE SWCONT.
</span><span class="line">  DATA END OF WI_CONTAINER.
</span><span class="line">
</span><span class="line">
</span><span class="line">  DATA: ls_instanceid TYPE char32.
</span><span class="line">  data: l_PARA_EV_SIGN type char10,
</span><span class="line">      lwa_test02 type ZWFTST02,
</span><span class="line">      lwa_test01 type zwftst01.
</span><span class="line">
</span><span class="line">  check p_wcode is not initial.
</span><span class="line">  lwa_test02-wfcode = p_wcode.
</span><span class="line">  lwa_test02-ctext = p_ctext.
</span><span class="line">
</span><span class="line">  lwa_test01-wfcode = p_wcode.
</span><span class="line">  lwa_test01-CUSER = sy-uname.
</span><span class="line">  lwa_test01-CDATE = sy-datum.
</span><span class="line">  lwa_test01-appro = p_appro.
</span><span class="line">  modify zwftst01 from  lwa_test01.
</span><span class="line">
</span><span class="line">  CONCATENATE 'Z##' p_wcode  INTO LS_INSTANCEID.  "工作流号码
</span><span class="line">  lwa_test02-WFCODENO = LS_INSTANCEID.
</span><span class="line">  lwa_test02-state = 'C'.
</span><span class="line">  modify ZWFTST02 from lwa_test02.
</span><span class="line">
</span><span class="line">* Some workflow-specific initializing
</span><span class="line">  WF_INITIATOR-OTYPE = 'US'.
</span><span class="line">  WF_INITIATOR-OBJID = 'GW-ZM'.
</span><span class="line">
</span><span class="line">  SWC_SET_ELEMENT WI_CONTAINER '_WF_INITIATOR' WF_INITIATOR.
</span><span class="line">  SWC_SET_ELEMENT WI_CONTAINER 'WF_SIGN_TEXT'  p_wcode."
</span><span class="line">  SWC_SET_ELEMENT WI_CONTAINER 'WF_CODE_CONT'  p_wcode."
</span><span class="line">
</span><span class="line">  CALL FUNCTION 'SWW_WI_START_SIMPLE'
</span><span class="line">    EXPORTING
</span><span class="line">      TASK         = 'WS91100048'
</span><span class="line">    TABLES
</span><span class="line">      AGENTS       = ZAGENTS
</span><span class="line">      WI_CONTAINER = WI_CONTAINER.
</span><span class="line">  IF SY-SUBRC &lt;&gt; 0.
</span><span class="line">    MESSAGE ID SY-MSGID TYPE SY-MSGTY NUMBER SY-MSGNO
</span><span class="line">            WITH SY-MSGV1 SY-MSGV2 SY-MSGV3 SY-MSGV4.
</span><span class="line">  else.
</span><span class="line">    write: / 'The work flow 2: ',
</span><span class="line">              p_wcode,
</span><span class="line">              ' is started'.
</span><span class="line">  ENDIF.
</span><span class="line">
</span><span class="line">ENDFORM.</span></code></pre></td></tr></table></div></figure></notextile></div>

<h3 id="section">问题解决——</h3>
<p>1. 如果出现：<br />
<img src="http://lomozm.github.io/images/images/SAPWorkFlowStepbyStep.files/image080.png" alt="m080" /><br />
解决方法：<br />
在工作流类中，加入<code>BI_PERSISTENT~FIND_BY_LPOR</code>函数代码；注意函数<code>SWF_UTL_INVOKE_CLIF_METHOD</code>在所有工作流调用时，都会使这个函数；如果更改了类的方法，没有激活的话，也会报这种异常<br /></p>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[针对SAP程序强出窗口的调试]]></title>
    <link href="http://lomozm.github.io/blog/20131225/zhen-dui-sapcheng-xu-qiang-chu-chuang-kou-de-diao-shi/"/>
    <updated>2013-12-25T14:21:15+08:00</updated>
    <id>http://lomozm.github.io/blog/20131225/zhen-dui-sapcheng-xu-qiang-chu-chuang-kou-de-diao-shi</id>
    <content type="html"><![CDATA[
<p>常会碰到对SAP程序进行调试，无非有以下几种
</p>
<p>1. 在程序中打断点或者加入breakpoint语名
</p>
<p>2. 输入<code>/H</code>命令
</p>
<!--more-->
<p>
如果是在系统程序中，想对强出窗口对进调试的话，只能使用第1种方法，找到相应的代码加断点，非常麻烦</p>

<p>感谢以前项目组一同事，提供了一断<a href="http://lomozm.github.io/appendix/popup debug.txt" title="File download">代码</a>，只需要把它写入到txt文件中，在弹出窗口时，把这个文件拖至弹出窗口上，相当于加入了<code>/h</code>命令<br /></p>
<p>代码入下：</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
</pre></td><td class="code"><pre><code class=""><span class="line">[FUNCTION]
</span><span class="line">
</span><span class="line">Command=/H
</span><span class="line">Title=Barry Test
</span><span class="line">Type=SystemCommand</span></code></pre></td></tr></table></div></figure></notextile></div>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[金额格式化 - 千分符]]></title>
    <link href="http://lomozm.github.io/blog/20131225/jin-e-ge-shi-hua-qian-fen-fu/"/>
    <updated>2013-12-25T11:55:59+08:00</updated>
    <id>http://lomozm.github.io/blog/20131225/jin-e-ge-shi-hua-qian-fen-fu</id>
    <content type="html"><![CDATA[
<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
</pre></td><td class="code"><pre><code class=""><span class="line">function z_num2str.
</span><span class="line">*"----------------------------------------------------------------------
</span><span class="line">*"*"本地接口：
</span><span class="line">*"  IMPORTING
</span><span class="line">*"     REFERENCE(INUM) TYPE  STRING
</span><span class="line">*"  EXPORTING
</span><span class="line">*"     REFERENCE(ZSTR) TYPE  STRING
</span><span class="line">*"----------------------------------------------------------------------</span></code></pre></td></tr></table></div></figure></notextile></div>

<!--more-->

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
<span class="line-number">24</span>
<span class="line-number">25</span>
<span class="line-number">26</span>
<span class="line-number">27</span>
<span class="line-number">28</span>
<span class="line-number">29</span>
<span class="line-number">30</span>
<span class="line-number">31</span>
<span class="line-number">32</span>
<span class="line-number">33</span>
<span class="line-number">34</span>
<span class="line-number">35</span>
<span class="line-number">36</span>
<span class="line-number">37</span>
<span class="line-number">38</span>
<span class="line-number">39</span>
<span class="line-number">40</span>
<span class="line-number">41</span>
<span class="line-number">42</span>
<span class="line-number">43</span>
<span class="line-number">44</span>
<span class="line-number">45</span>
<span class="line-number">46</span>
<span class="line-number">47</span>
<span class="line-number">48</span>
<span class="line-number">49</span>
</pre></td><td class="code"><pre><code class=""><span class="line">data : zclen type i,
</span><span class="line">        znum type dmbtr,
</span><span class="line">  n type i,
</span><span class="line">  zcstr(20) type c,
</span><span class="line">  zcstr2(20) type c,
</span><span class="line">  zctemp(3) type c,
</span><span class="line">  zflag(1) type c value '.',
</span><span class="line">  zflag2 type i value 0,
</span><span class="line">  zcdec(20) type c. "记录小数部分.
</span><span class="line">  zstr = ''.
</span><span class="line">  znum = INUM.
</span><span class="line">  check znum &lt;&gt; 0.
</span><span class="line">  if znum &lt;= -1000.
</span><span class="line">    zflag2 = 1.
</span><span class="line">    znum = abs( znum ).
</span><span class="line">  endif.
</span><span class="line">  if znum &gt;= 1000.
</span><span class="line">    zcstr = znum.
</span><span class="line">* 压缩字符串，去除前面的空格。
</span><span class="line">    condense zcstr no-gaps.
</span><span class="line">* 分离整数与小数，好单独处理整数。
</span><span class="line">    split zcstr at zflag into zcstr zcdec.
</span><span class="line">    zclen = strlen( zcstr ).
</span><span class="line">* 在循环中从右面在每三位的前面加上一个逗号。
</span><span class="line">    while zclen &gt; 3.
</span><span class="line">      n = zclen - 3.
</span><span class="line">      zctemp = zcstr+n(3).
</span><span class="line">      if not zcstr2 is initial.
</span><span class="line">        concatenate zctemp zcstr2 into zcstr2 separated by ','.
</span><span class="line">      else.
</span><span class="line">        zcstr2 = zctemp.
</span><span class="line">      endif.
</span><span class="line">      zclen = zclen - 3.
</span><span class="line">    endwhile.
</span><span class="line">* 将不剩下的不足三位数加到前面
</span><span class="line">    concatenate zcstr+0(zclen) zcstr2 into zcstr2 separated by ','.
</span><span class="line">    if zflag2 = 1.
</span><span class="line">      concatenate '-' zcstr2 into zcstr2.
</span><span class="line">    endif.
</span><span class="line">    clear zcstr.
</span><span class="line">* 将处理过的整数与小数连接起来。
</span><span class="line">    concatenate zcstr2 zcdec into zcstr separated by zflag.
</span><span class="line">* 将值返回
</span><span class="line">    zstr = zcstr.
</span><span class="line">  else.
</span><span class="line">    zstr = znum.
</span><span class="line">  endif.
</span><span class="line">
</span><span class="line">endfunction.</span></code></pre></td></tr></table></div></figure></notextile></div>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[数字检查 - 通过正则表达式]]></title>
    <link href="http://lomozm.github.io/blog/20131225/shu-zi-jian-cha-tong-guo-zheng-ze-biao-da-shi/"/>
    <updated>2013-12-25T11:50:56+08:00</updated>
    <id>http://lomozm.github.io/blog/20131225/shu-zi-jian-cha-tong-guo-zheng-ze-biao-da-shi</id>
    <content type="html"><![CDATA[<ol>
  <li>函数代码</li>
</ol>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
</pre></td><td class="code"><pre><code class=""><span class="line">function z_is_number_check.
</span><span class="line">*"----------------------------------------------------------------------
</span><span class="line">*"*"本地接口：
</span><span class="line">*"  IMPORTING
</span><span class="line">*"     REFERENCE(I_STRING) TYPE  STRING
</span><span class="line">*"     REFERENCE(I_MARKER) TYPE  STRING
</span><span class="line">*"  EXPORTING
</span><span class="line">*"     REFERENCE(O_IS_NUM) TYPE  CHAR1
</span><span class="line">*"----------------------------------------------------------------------</span></code></pre></td></tr></table></div></figure></notextile></div>

<!--more-->

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
</pre></td><td class="code"><pre><code class=""><span class="line">data: g_regex_ref   type ref to cl_abap_regex,
</span><span class="line">        g_matcher_ref type ref to cl_abap_matcher.
</span><span class="line">
</span><span class="line">  clear: o_is_num.
</span><span class="line">
</span><span class="line">  create object g_regex_ref
</span><span class="line">    exporting
</span><span class="line">      pattern = i_marker.
</span><span class="line">
</span><span class="line">  if i_string is not initial.
</span><span class="line">    g_matcher_ref = g_regex_ref-&gt;create_matcher( text = i_string ).
</span><span class="line">    o_is_num = g_matcher_ref-&gt;match( ).  " if matched the P_G_MATCH value is 'X', else value is space
</span><span class="line">  else.
</span><span class="line">    o_is_num = 'X'.
</span><span class="line">  endif.
</span><span class="line">
</span><span class="line">  free g_regex_ref.
</span><span class="line">
</span><span class="line">endfunction.</span></code></pre></td></tr></table></div></figure></notextile></div>

<ol>
  <li>使用方法</li>
</ol>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
</pre></td><td class="code"><pre><code class=""><span class="line">data: i_str type string value '1000',
</span><span class="line">      i_mark type string value '\d+',
</span><span class="line">      o_num type char1.
</span><span class="line">     
</span><span class="line">call function 'ZG001_IS_NUMBER_CHECK'
</span><span class="line">  exporting
</span><span class="line">    i_string       = i_str
</span><span class="line">    i_marker       = i_mark
</span><span class="line"> IMPORTING
</span><span class="line">   O_IS_NUM       = o_num
</span><span class="line">          .</span></code></pre></td></tr></table></div></figure></notextile></div>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[金额转大写英文]]></title>
    <link href="http://lomozm.github.io/blog/20131225/jin-e-zhuan-da-xie-ying-wen/"/>
    <updated>2013-12-25T11:46:25+08:00</updated>
    <id>http://lomozm.github.io/blog/20131225/jin-e-zhuan-da-xie-ying-wen</id>
    <content type="html"><![CDATA[
<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
</pre></td><td class="code"><pre><code class=""><span class="line">function zcurr2english.
</span><span class="line">*"----------------------------------------------------------------------
</span><span class="line">*"*"本地接口：
</span><span class="line">*"  IMPORTING
</span><span class="line">*"     REFERENCE(FROM_NUM) TYPE  DMBTR
</span><span class="line">*"  EXPORTING
</span><span class="line">*"     REFERENCE(TO_STR) TYPE  STRING
</span><span class="line">*"----------------------------------------------------------------------</span></code></pre></td></tr></table></div></figure></notextile></div>

<!--more-->

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
<span class="line-number">24</span>
<span class="line-number">25</span>
<span class="line-number">26</span>
<span class="line-number">27</span>
<span class="line-number">28</span>
<span class="line-number">29</span>
<span class="line-number">30</span>
<span class="line-number">31</span>
<span class="line-number">32</span>
<span class="line-number">33</span>
<span class="line-number">34</span>
<span class="line-number">35</span>
<span class="line-number">36</span>
<span class="line-number">37</span>
<span class="line-number">38</span>
<span class="line-number">39</span>
<span class="line-number">40</span>
<span class="line-number">41</span>
<span class="line-number">42</span>
<span class="line-number">43</span>
<span class="line-number">44</span>
<span class="line-number">45</span>
<span class="line-number">46</span>
<span class="line-number">47</span>
<span class="line-number">48</span>
<span class="line-number">49</span>
<span class="line-number">50</span>
<span class="line-number">51</span>
<span class="line-number">52</span>
<span class="line-number">53</span>
<span class="line-number">54</span>
<span class="line-number">55</span>
<span class="line-number">56</span>
<span class="line-number">57</span>
<span class="line-number">58</span>
<span class="line-number">59</span>
<span class="line-number">60</span>
<span class="line-number">61</span>
<span class="line-number">62</span>
<span class="line-number">63</span>
<span class="line-number">64</span>
<span class="line-number">65</span>
<span class="line-number">66</span>
<span class="line-number">67</span>
<span class="line-number">68</span>
<span class="line-number">69</span>
<span class="line-number">70</span>
<span class="line-number">71</span>
<span class="line-number">72</span>
<span class="line-number">73</span>
<span class="line-number">74</span>
<span class="line-number">75</span>
<span class="line-number">76</span>
<span class="line-number">77</span>
<span class="line-number">78</span>
<span class="line-number">79</span>
<span class="line-number">80</span>
<span class="line-number">81</span>
<span class="line-number">82</span>
<span class="line-number">83</span>
<span class="line-number">84</span>
<span class="line-number">85</span>
<span class="line-number">86</span>
<span class="line-number">87</span>
<span class="line-number">88</span>
<span class="line-number">89</span>
<span class="line-number">90</span>
<span class="line-number">91</span>
<span class="line-number">92</span>
<span class="line-number">93</span>
<span class="line-number">94</span>
<span class="line-number">95</span>
<span class="line-number">96</span>
<span class="line-number">97</span>
<span class="line-number">98</span>
<span class="line-number">99</span>
<span class="line-number">100</span>
<span class="line-number">101</span>
<span class="line-number">102</span>
<span class="line-number">103</span>
<span class="line-number">104</span>
<span class="line-number">105</span>
<span class="line-number">106</span>
<span class="line-number">107</span>
<span class="line-number">108</span>
<span class="line-number">109</span>
<span class="line-number">110</span>
<span class="line-number">111</span>
<span class="line-number">112</span>
<span class="line-number">113</span>
<span class="line-number">114</span>
<span class="line-number">115</span>
<span class="line-number">116</span>
<span class="line-number">117</span>
<span class="line-number">118</span>
<span class="line-number">119</span>
<span class="line-number">120</span>
<span class="line-number">121</span>
<span class="line-number">122</span>
<span class="line-number">123</span>
<span class="line-number">124</span>
<span class="line-number">125</span>
<span class="line-number">126</span>
<span class="line-number">127</span>
<span class="line-number">128</span>
<span class="line-number">129</span>
<span class="line-number">130</span>
<span class="line-number">131</span>
<span class="line-number">132</span>
<span class="line-number">133</span>
<span class="line-number">134</span>
<span class="line-number">135</span>
<span class="line-number">136</span>
<span class="line-number">137</span>
<span class="line-number">138</span>
<span class="line-number">139</span>
<span class="line-number">140</span>
<span class="line-number">141</span>
<span class="line-number">142</span>
<span class="line-number">143</span>
<span class="line-number">144</span>
<span class="line-number">145</span>
<span class="line-number">146</span>
<span class="line-number">147</span>
<span class="line-number">148</span>
<span class="line-number">149</span>
<span class="line-number">150</span>
<span class="line-number">151</span>
<span class="line-number">152</span>
<span class="line-number">153</span>
<span class="line-number">154</span>
<span class="line-number">155</span>
<span class="line-number">156</span>
<span class="line-number">157</span>
<span class="line-number">158</span>
<span class="line-number">159</span>
<span class="line-number">160</span>
<span class="line-number">161</span>
<span class="line-number">162</span>
<span class="line-number">163</span>
<span class="line-number">164</span>
<span class="line-number">165</span>
<span class="line-number">166</span>
<span class="line-number">167</span>
<span class="line-number">168</span>
<span class="line-number">169</span>
<span class="line-number">170</span>
<span class="line-number">171</span>
<span class="line-number">172</span>
<span class="line-number">173</span>
<span class="line-number">174</span>
<span class="line-number">175</span>
<span class="line-number">176</span>
<span class="line-number">177</span>
<span class="line-number">178</span>
<span class="line-number">179</span>
<span class="line-number">180</span>
<span class="line-number">181</span>
<span class="line-number">182</span>
<span class="line-number">183</span>
<span class="line-number">184</span>
<span class="line-number">185</span>
<span class="line-number">186</span>
<span class="line-number">187</span>
<span class="line-number">188</span>
<span class="line-number">189</span>
<span class="line-number">190</span>
<span class="line-number">191</span>
<span class="line-number">192</span>
<span class="line-number">193</span>
<span class="line-number">194</span>
<span class="line-number">195</span>
<span class="line-number">196</span>
<span class="line-number">197</span>
<span class="line-number">198</span>
<span class="line-number">199</span>
<span class="line-number">200</span>
<span class="line-number">201</span>
<span class="line-number">202</span>
<span class="line-number">203</span>
<span class="line-number">204</span>
<span class="line-number">205</span>
<span class="line-number">206</span>
<span class="line-number">207</span>
<span class="line-number">208</span>
<span class="line-number">209</span>
<span class="line-number">210</span>
<span class="line-number">211</span>
<span class="line-number">212</span>
<span class="line-number">213</span>
<span class="line-number">214</span>
<span class="line-number">215</span>
<span class="line-number">216</span>
<span class="line-number">217</span>
<span class="line-number">218</span>
<span class="line-number">219</span>
<span class="line-number">220</span>
<span class="line-number">221</span>
<span class="line-number">222</span>
<span class="line-number">223</span>
<span class="line-number">224</span>
<span class="line-number">225</span>
<span class="line-number">226</span>
<span class="line-number">227</span>
<span class="line-number">228</span>
<span class="line-number">229</span>
<span class="line-number">230</span>
<span class="line-number">231</span>
<span class="line-number">232</span>
<span class="line-number">233</span>
<span class="line-number">234</span>
<span class="line-number">235</span>
<span class="line-number">236</span>
<span class="line-number">237</span>
<span class="line-number">238</span>
<span class="line-number">239</span>
<span class="line-number">240</span>
<span class="line-number">241</span>
<span class="line-number">242</span>
<span class="line-number">243</span>
<span class="line-number">244</span>
<span class="line-number">245</span>
<span class="line-number">246</span>
<span class="line-number">247</span>
<span class="line-number">248</span>
<span class="line-number">249</span>
<span class="line-number">250</span>
<span class="line-number">251</span>
<span class="line-number">252</span>
<span class="line-number">253</span>
<span class="line-number">254</span>
<span class="line-number">255</span>
<span class="line-number">256</span>
<span class="line-number">257</span>
<span class="line-number">258</span>
<span class="line-number">259</span>
<span class="line-number">260</span>
<span class="line-number">261</span>
<span class="line-number">262</span>
<span class="line-number">263</span>
<span class="line-number">264</span>
<span class="line-number">265</span>
<span class="line-number">266</span>
<span class="line-number">267</span>
<span class="line-number">268</span>
<span class="line-number">269</span>
<span class="line-number">270</span>
<span class="line-number">271</span>
<span class="line-number">272</span>
<span class="line-number">273</span>
<span class="line-number">274</span>
<span class="line-number">275</span>
<span class="line-number">276</span>
<span class="line-number">277</span>
<span class="line-number">278</span>
<span class="line-number">279</span>
<span class="line-number">280</span>
<span class="line-number">281</span>
<span class="line-number">282</span>
<span class="line-number">283</span>
<span class="line-number">284</span>
<span class="line-number">285</span>
<span class="line-number">286</span>
<span class="line-number">287</span>
<span class="line-number">288</span>
<span class="line-number">289</span>
<span class="line-number">290</span>
<span class="line-number">291</span>
<span class="line-number">292</span>
<span class="line-number">293</span>
<span class="line-number">294</span>
<span class="line-number">295</span>
<span class="line-number">296</span>
<span class="line-number">297</span>
<span class="line-number">298</span>
<span class="line-number">299</span>
<span class="line-number">300</span>
<span class="line-number">301</span>
<span class="line-number">302</span>
<span class="line-number">303</span>
<span class="line-number">304</span>
<span class="line-number">305</span>
<span class="line-number">306</span>
<span class="line-number">307</span>
<span class="line-number">308</span>
<span class="line-number">309</span>
<span class="line-number">310</span>
<span class="line-number">311</span>
<span class="line-number">312</span>
<span class="line-number">313</span>
<span class="line-number">314</span>
<span class="line-number">315</span>
<span class="line-number">316</span>
<span class="line-number">317</span>
<span class="line-number">318</span>
<span class="line-number">319</span>
<span class="line-number">320</span>
<span class="line-number">321</span>
<span class="line-number">322</span>
<span class="line-number">323</span>
<span class="line-number">324</span>
<span class="line-number">325</span>
<span class="line-number">326</span>
<span class="line-number">327</span>
<span class="line-number">328</span>
<span class="line-number">329</span>
<span class="line-number">330</span>
<span class="line-number">331</span>
<span class="line-number">332</span>
<span class="line-number">333</span>
<span class="line-number">334</span>
<span class="line-number">335</span>
<span class="line-number">336</span>
<span class="line-number">337</span>
<span class="line-number">338</span>
<span class="line-number">339</span>
<span class="line-number">340</span>
<span class="line-number">341</span>
<span class="line-number">342</span>
<span class="line-number">343</span>
<span class="line-number">344</span>
<span class="line-number">345</span>
<span class="line-number">346</span>
<span class="line-number">347</span>
<span class="line-number">348</span>
<span class="line-number">349</span>
<span class="line-number">350</span>
<span class="line-number">351</span>
<span class="line-number">352</span>
<span class="line-number">353</span>
<span class="line-number">354</span>
<span class="line-number">355</span>
<span class="line-number">356</span>
<span class="line-number">357</span>
<span class="line-number">358</span>
<span class="line-number">359</span>
<span class="line-number">360</span>
<span class="line-number">361</span>
<span class="line-number">362</span>
<span class="line-number">363</span>
<span class="line-number">364</span>
<span class="line-number">365</span>
<span class="line-number">366</span>
<span class="line-number">367</span>
<span class="line-number">368</span>
<span class="line-number">369</span>
<span class="line-number">370</span>
<span class="line-number">371</span>
<span class="line-number">372</span>
<span class="line-number">373</span>
<span class="line-number">374</span>
<span class="line-number">375</span>
<span class="line-number">376</span>
<span class="line-number">377</span>
<span class="line-number">378</span>
<span class="line-number">379</span>
<span class="line-number">380</span>
<span class="line-number">381</span>
<span class="line-number">382</span>
<span class="line-number">383</span>
<span class="line-number">384</span>
<span class="line-number">385</span>
<span class="line-number">386</span>
<span class="line-number">387</span>
<span class="line-number">388</span>
<span class="line-number">389</span>
<span class="line-number">390</span>
<span class="line-number">391</span>
<span class="line-number">392</span>
<span class="line-number">393</span>
<span class="line-number">394</span>
<span class="line-number">395</span>
<span class="line-number">396</span>
<span class="line-number">397</span>
<span class="line-number">398</span>
<span class="line-number">399</span>
<span class="line-number">400</span>
<span class="line-number">401</span>
<span class="line-number">402</span>
<span class="line-number">403</span>
<span class="line-number">404</span>
<span class="line-number">405</span>
<span class="line-number">406</span>
<span class="line-number">407</span>
<span class="line-number">408</span>
<span class="line-number">409</span>
<span class="line-number">410</span>
<span class="line-number">411</span>
<span class="line-number">412</span>
<span class="line-number">413</span>
<span class="line-number">414</span>
<span class="line-number">415</span>
<span class="line-number">416</span>
<span class="line-number">417</span>
<span class="line-number">418</span>
<span class="line-number">419</span>
<span class="line-number">420</span>
<span class="line-number">421</span>
<span class="line-number">422</span>
<span class="line-number">423</span>
<span class="line-number">424</span>
<span class="line-number">425</span>
<span class="line-number">426</span>
<span class="line-number">427</span>
<span class="line-number">428</span>
<span class="line-number">429</span>
<span class="line-number">430</span>
<span class="line-number">431</span>
<span class="line-number">432</span>
<span class="line-number">433</span>
<span class="line-number">434</span>
<span class="line-number">435</span>
<span class="line-number">436</span>
<span class="line-number">437</span>
<span class="line-number">438</span>
<span class="line-number">439</span>
<span class="line-number">440</span>
<span class="line-number">441</span>
<span class="line-number">442</span>
<span class="line-number">443</span>
<span class="line-number">444</span>
<span class="line-number">445</span>
<span class="line-number">446</span>
<span class="line-number">447</span>
<span class="line-number">448</span>
<span class="line-number">449</span>
<span class="line-number">450</span>
<span class="line-number">451</span>
<span class="line-number">452</span>
<span class="line-number">453</span>
<span class="line-number">454</span>
<span class="line-number">455</span>
<span class="line-number">456</span>
<span class="line-number">457</span>
<span class="line-number">458</span>
<span class="line-number">459</span>
<span class="line-number">460</span>
<span class="line-number">461</span>
<span class="line-number">462</span>
<span class="line-number">463</span>
<span class="line-number">464</span>
<span class="line-number">465</span>
<span class="line-number">466</span>
<span class="line-number">467</span>
<span class="line-number">468</span>
<span class="line-number">469</span>
<span class="line-number">470</span>
<span class="line-number">471</span>
<span class="line-number">472</span>
<span class="line-number">473</span>
<span class="line-number">474</span>
<span class="line-number">475</span>
<span class="line-number">476</span>
<span class="line-number">477</span>
<span class="line-number">478</span>
<span class="line-number">479</span>
<span class="line-number">480</span>
<span class="line-number">481</span>
<span class="line-number">482</span>
<span class="line-number">483</span>
<span class="line-number">484</span>
<span class="line-number">485</span>
<span class="line-number">486</span>
<span class="line-number">487</span>
<span class="line-number">488</span>
<span class="line-number">489</span>
<span class="line-number">490</span>
<span class="line-number">491</span>
<span class="line-number">492</span>
<span class="line-number">493</span>
<span class="line-number">494</span>
<span class="line-number">495</span>
<span class="line-number">496</span>
<span class="line-number">497</span>
<span class="line-number">498</span>
<span class="line-number">499</span>
<span class="line-number">500</span>
<span class="line-number">501</span>
<span class="line-number">502</span>
<span class="line-number">503</span>
<span class="line-number">504</span>
<span class="line-number">505</span>
<span class="line-number">506</span>
<span class="line-number">507</span>
<span class="line-number">508</span>
<span class="line-number">509</span>
<span class="line-number">510</span>
<span class="line-number">511</span>
<span class="line-number">512</span>
<span class="line-number">513</span>
<span class="line-number">514</span>
<span class="line-number">515</span>
<span class="line-number">516</span>
<span class="line-number">517</span>
<span class="line-number">518</span>
<span class="line-number">519</span>
<span class="line-number">520</span>
<span class="line-number">521</span>
<span class="line-number">522</span>
<span class="line-number">523</span>
<span class="line-number">524</span>
<span class="line-number">525</span>
<span class="line-number">526</span>
<span class="line-number">527</span>
<span class="line-number">528</span>
<span class="line-number">529</span>
<span class="line-number">530</span>
<span class="line-number">531</span>
<span class="line-number">532</span>
<span class="line-number">533</span>
<span class="line-number">534</span>
<span class="line-number">535</span>
<span class="line-number">536</span>
<span class="line-number">537</span>
<span class="line-number">538</span>
<span class="line-number">539</span>
<span class="line-number">540</span>
<span class="line-number">541</span>
<span class="line-number">542</span>
<span class="line-number">543</span>
<span class="line-number">544</span>
<span class="line-number">545</span>
<span class="line-number">546</span>
<span class="line-number">547</span>
<span class="line-number">548</span>
<span class="line-number">549</span>
<span class="line-number">550</span>
<span class="line-number">551</span>
<span class="line-number">552</span>
<span class="line-number">553</span>
<span class="line-number">554</span>
<span class="line-number">555</span>
<span class="line-number">556</span>
<span class="line-number">557</span>
<span class="line-number">558</span>
<span class="line-number">559</span>
<span class="line-number">560</span>
<span class="line-number">561</span>
<span class="line-number">562</span>
<span class="line-number">563</span>
<span class="line-number">564</span>
<span class="line-number">565</span>
<span class="line-number">566</span>
<span class="line-number">567</span>
<span class="line-number">568</span>
<span class="line-number">569</span>
<span class="line-number">570</span>
<span class="line-number">571</span>
<span class="line-number">572</span>
<span class="line-number">573</span>
<span class="line-number">574</span>
<span class="line-number">575</span>
<span class="line-number">576</span>
<span class="line-number">577</span>
<span class="line-number">578</span>
<span class="line-number">579</span>
<span class="line-number">580</span>
<span class="line-number">581</span>
<span class="line-number">582</span>
<span class="line-number">583</span>
<span class="line-number">584</span>
<span class="line-number">585</span>
<span class="line-number">586</span>
<span class="line-number">587</span>
<span class="line-number">588</span>
<span class="line-number">589</span>
<span class="line-number">590</span>
<span class="line-number">591</span>
<span class="line-number">592</span>
<span class="line-number">593</span>
<span class="line-number">594</span>
<span class="line-number">595</span>
<span class="line-number">596</span>
<span class="line-number">597</span>
<span class="line-number">598</span>
<span class="line-number">599</span>
<span class="line-number">600</span>
<span class="line-number">601</span>
<span class="line-number">602</span>
<span class="line-number">603</span>
<span class="line-number">604</span>
<span class="line-number">605</span>
<span class="line-number">606</span>
<span class="line-number">607</span>
<span class="line-number">608</span>
<span class="line-number">609</span>
<span class="line-number">610</span>
<span class="line-number">611</span>
<span class="line-number">612</span>
<span class="line-number">613</span>
<span class="line-number">614</span>
<span class="line-number">615</span>
<span class="line-number">616</span>
<span class="line-number">617</span>
<span class="line-number">618</span>
<span class="line-number">619</span>
<span class="line-number">620</span>
<span class="line-number">621</span>
<span class="line-number">622</span>
<span class="line-number">623</span>
<span class="line-number">624</span>
<span class="line-number">625</span>
<span class="line-number">626</span>
<span class="line-number">627</span>
<span class="line-number">628</span>
<span class="line-number">629</span>
<span class="line-number">630</span>
<span class="line-number">631</span>
<span class="line-number">632</span>
<span class="line-number">633</span>
<span class="line-number">634</span>
<span class="line-number">635</span>
<span class="line-number">636</span>
<span class="line-number">637</span>
<span class="line-number">638</span>
<span class="line-number">639</span>
<span class="line-number">640</span>
<span class="line-number">641</span>
<span class="line-number">642</span>
<span class="line-number">643</span>
<span class="line-number">644</span>
<span class="line-number">645</span>
<span class="line-number">646</span>
<span class="line-number">647</span>
<span class="line-number">648</span>
<span class="line-number">649</span>
<span class="line-number">650</span>
<span class="line-number">651</span>
<span class="line-number">652</span>
<span class="line-number">653</span>
<span class="line-number">654</span>
<span class="line-number">655</span>
<span class="line-number">656</span>
<span class="line-number">657</span>
<span class="line-number">658</span>
<span class="line-number">659</span>
<span class="line-number">660</span>
<span class="line-number">661</span>
<span class="line-number">662</span>
<span class="line-number">663</span>
<span class="line-number">664</span>
<span class="line-number">665</span>
<span class="line-number">666</span>
<span class="line-number">667</span>
<span class="line-number">668</span>
<span class="line-number">669</span>
<span class="line-number">670</span>
<span class="line-number">671</span>
<span class="line-number">672</span>
<span class="line-number">673</span>
<span class="line-number">674</span>
<span class="line-number">675</span>
<span class="line-number">676</span>
<span class="line-number">677</span>
<span class="line-number">678</span>
<span class="line-number">679</span>
<span class="line-number">680</span>
<span class="line-number">681</span>
<span class="line-number">682</span>
<span class="line-number">683</span>
<span class="line-number">684</span>
<span class="line-number">685</span>
<span class="line-number">686</span>
<span class="line-number">687</span>
<span class="line-number">688</span>
<span class="line-number">689</span>
<span class="line-number">690</span>
<span class="line-number">691</span>
<span class="line-number">692</span>
<span class="line-number">693</span>
<span class="line-number">694</span>
<span class="line-number">695</span>
<span class="line-number">696</span>
<span class="line-number">697</span>
<span class="line-number">698</span>
<span class="line-number">699</span>
<span class="line-number">700</span>
<span class="line-number">701</span>
<span class="line-number">702</span>
<span class="line-number">703</span>
<span class="line-number">704</span>
<span class="line-number">705</span>
<span class="line-number">706</span>
<span class="line-number">707</span>
<span class="line-number">708</span>
<span class="line-number">709</span>
<span class="line-number">710</span>
<span class="line-number">711</span>
<span class="line-number">712</span>
<span class="line-number">713</span>
<span class="line-number">714</span>
<span class="line-number">715</span>
<span class="line-number">716</span>
<span class="line-number">717</span>
<span class="line-number">718</span>
<span class="line-number">719</span>
<span class="line-number">720</span>
<span class="line-number">721</span>
<span class="line-number">722</span>
<span class="line-number">723</span>
<span class="line-number">724</span>
<span class="line-number">725</span>
<span class="line-number">726</span>
<span class="line-number">727</span>
<span class="line-number">728</span>
<span class="line-number">729</span>
<span class="line-number">730</span>
<span class="line-number">731</span>
<span class="line-number">732</span>
<span class="line-number">733</span>
<span class="line-number">734</span>
<span class="line-number">735</span>
<span class="line-number">736</span>
<span class="line-number">737</span>
<span class="line-number">738</span>
<span class="line-number">739</span>
<span class="line-number">740</span>
<span class="line-number">741</span>
<span class="line-number">742</span>
<span class="line-number">743</span>
<span class="line-number">744</span>
<span class="line-number">745</span>
<span class="line-number">746</span>
<span class="line-number">747</span>
<span class="line-number">748</span>
<span class="line-number">749</span>
<span class="line-number">750</span>
<span class="line-number">751</span>
<span class="line-number">752</span>
<span class="line-number">753</span>
<span class="line-number">754</span>
<span class="line-number">755</span>
<span class="line-number">756</span>
<span class="line-number">757</span>
<span class="line-number">758</span>
<span class="line-number">759</span>
<span class="line-number">760</span>
<span class="line-number">761</span>
<span class="line-number">762</span>
<span class="line-number">763</span>
<span class="line-number">764</span>
<span class="line-number">765</span>
<span class="line-number">766</span>
<span class="line-number">767</span>
<span class="line-number">768</span>
<span class="line-number">769</span>
<span class="line-number">770</span>
<span class="line-number">771</span>
<span class="line-number">772</span>
<span class="line-number">773</span>
<span class="line-number">774</span>
<span class="line-number">775</span>
<span class="line-number">776</span>
<span class="line-number">777</span>
<span class="line-number">778</span>
<span class="line-number">779</span>
<span class="line-number">780</span>
<span class="line-number">781</span>
<span class="line-number">782</span>
<span class="line-number">783</span>
<span class="line-number">784</span>
<span class="line-number">785</span>
<span class="line-number">786</span>
<span class="line-number">787</span>
<span class="line-number">788</span>
<span class="line-number">789</span>
<span class="line-number">790</span>
<span class="line-number">791</span>
<span class="line-number">792</span>
<span class="line-number">793</span>
<span class="line-number">794</span>
<span class="line-number">795</span>
<span class="line-number">796</span>
<span class="line-number">797</span>
<span class="line-number">798</span>
<span class="line-number">799</span>
<span class="line-number">800</span>
<span class="line-number">801</span>
<span class="line-number">802</span>
<span class="line-number">803</span>
<span class="line-number">804</span>
<span class="line-number">805</span>
<span class="line-number">806</span>
<span class="line-number">807</span>
<span class="line-number">808</span>
<span class="line-number">809</span>
<span class="line-number">810</span>
<span class="line-number">811</span>
<span class="line-number">812</span>
<span class="line-number">813</span>
</pre></td><td class="code"><pre><code class=""><span class="line">data num(16) type p decimals 0 .
</span><span class="line">  data pnum(2) type i.
</span><span class="line">
</span><span class="line">  data temp1 type i .
</span><span class="line">  data temp2 type i .
</span><span class="line">  data temp3 type i .
</span><span class="line">  data temp4 type i .
</span><span class="line">
</span><span class="line">  data tempq type i .
</span><span class="line">  data tempw type i .
</span><span class="line">  data tempe type i .
</span><span class="line">  data tempr type i .
</span><span class="line">
</span><span class="line">  data temp(16) type i.
</span><span class="line">  data tempii type i .
</span><span class="line">
</span><span class="line">  data ls_return type string.
</span><span class="line">  data ls_str type string.
</span><span class="line">  data moff type i value 0.
</span><span class="line">****
</span><span class="line">  temp = from_num.
</span><span class="line">
</span><span class="line">
</span><span class="line">  ls_str = from_num.
</span><span class="line">  find '.' in ls_str match offset moff.
</span><span class="line">
</span><span class="line">  if moff &gt; 0.
</span><span class="line">    num = ls_str+0(moff).
</span><span class="line">    moff = moff + 1.
</span><span class="line">    ls_str = ls_str+moff(2).
</span><span class="line">    pnum = ls_str.
</span><span class="line">  else.
</span><span class="line">    num = temp.
</span><span class="line">    pnum = 0.
</span><span class="line">  endif.
</span><span class="line">
</span><span class="line">  if from_num &lt; 0.
</span><span class="line">    ls_return = 'Negative'.
</span><span class="line">  else.
</span><span class="line">    ls_return = ''.
</span><span class="line">  endif.
</span><span class="line">
</span><span class="line">  num = abs( num ).
</span><span class="line">
</span><span class="line">****
</span><span class="line">*************************************************
</span><span class="line">  temp = num .
</span><span class="line">
</span><span class="line">  temp1 = temp div 1000000000 .
</span><span class="line">  temp = temp mod 1000000000 .
</span><span class="line">
</span><span class="line">  temp2 = temp div 1000000 .
</span><span class="line">  temp = temp mod 1000000 .
</span><span class="line">
</span><span class="line">  temp3 = temp div 1000 .
</span><span class="line">  temp = temp mod 1000 .
</span><span class="line">
</span><span class="line">  temp4 = temp .
</span><span class="line">********************************************************
</span><span class="line">  if temp1 &lt;&gt; 0 .
</span><span class="line">    tempii = temp1 .
</span><span class="line">
</span><span class="line">    tempw = tempii div 100 .
</span><span class="line">    tempii = tempii mod 100 .
</span><span class="line">
</span><span class="line">    tempe = tempii div 10 .
</span><span class="line">    tempii = tempii mod 10 .
</span><span class="line">
</span><span class="line">    tempr = tempii .
</span><span class="line">*********************
</span><span class="line">    if tempw &lt;&gt; 0 .
</span><span class="line">      tempii = tempw .
</span><span class="line">      case tempii.
</span><span class="line">        when 1 .
</span><span class="line">          concatenate ls_return 'One' into ls_return separated by ' '.    "WRITE 'One' .
</span><span class="line">        when 2 .
</span><span class="line">          concatenate ls_return 'Two' into ls_return separated by ' '.    "WRITE 'Two' .
</span><span class="line">        when 3 .
</span><span class="line">          concatenate ls_return 'Three' into ls_return separated by ' '.    "WRITE 'Three' .
</span><span class="line">        when 4 .
</span><span class="line">          concatenate ls_return 'Four' into ls_return separated by ' '.    "WRITE 'Four' .
</span><span class="line">        when 5 .
</span><span class="line">          concatenate ls_return 'Five' into ls_return separated by ' '.    "WRITE 'Five' .
</span><span class="line">        when 6 .
</span><span class="line">          concatenate ls_return 'Six' into ls_return separated by ' '.    "WRITE 'Six' .
</span><span class="line">        when 7 .
</span><span class="line">          concatenate ls_return 'Seven' into ls_return separated by ' '.    "WRITE 'Seven' .
</span><span class="line">        when 8 .
</span><span class="line">          concatenate ls_return 'Eight' into ls_return separated by ' '.    "WRITE 'Eight' .
</span><span class="line">        when 9 .
</span><span class="line">          concatenate ls_return 'Nine' into ls_return separated by ' '.    "WRITE 'Nine' .
</span><span class="line">      endcase.
</span><span class="line">      concatenate ls_return 'Hundred' into ls_return separated by ' '.    "WRITE 'Hundred' .
</span><span class="line">    endif .
</span><span class="line">*********************
</span><span class="line">
</span><span class="line">    tempii = tempe .
</span><span class="line">    case tempii.
</span><span class="line">      when 1 .
</span><span class="line">        tempii = temp1 mod 100.
</span><span class="line">
</span><span class="line">        case tempii.
</span><span class="line">          when 11 .
</span><span class="line">            concatenate ls_return 'Eleven' into ls_return separated by ' '.    "WRITE 'Eleven' .
</span><span class="line">          when 12 .
</span><span class="line">            concatenate ls_return 'Twelve' into ls_return separated by ' '.    "WRITE 'Twelve' .
</span><span class="line">          when 13 .
</span><span class="line">            concatenate ls_return 'Thirteen' into ls_return separated by ' '.    "WRITE 'Thirteen' .
</span><span class="line">          when 14 .
</span><span class="line">            concatenate ls_return 'Fourteen' into ls_return separated by ' '.    "WRITE 'Fourteen' .
</span><span class="line">          when 15 .
</span><span class="line">            concatenate ls_return 'Fifteen' into ls_return separated by ' '.    "WRITE 'Fifteen' .
</span><span class="line">          when 16 .
</span><span class="line">            concatenate ls_return 'Sixteen' into ls_return separated by ' '.    "WRITE 'Sixteen' .
</span><span class="line">          when 17 .
</span><span class="line">            concatenate ls_return 'Seventeen' into ls_return separated by ' '.    "WRITE 'Seventeen' .
</span><span class="line">          when 18 .
</span><span class="line">            concatenate ls_return 'Eighteen' into ls_return separated by ' '.    "WRITE 'Eighteen' .
</span><span class="line">          when 19 .
</span><span class="line">            concatenate ls_return 'Nineteen' into ls_return separated by ' '.    "WRITE 'Nineteen' .
</span><span class="line">        endcase.
</span><span class="line">        tempr = 0.  "leotian
</span><span class="line">      when 0 .
</span><span class="line">
</span><span class="line">        if tempr &lt;&gt; 0 .
</span><span class="line">          if ls_return &lt;&gt; ''.
</span><span class="line">            concatenate ls_return 'And' into ls_return separated by ' '.    "WRITE 'And'.
</span><span class="line">          endif.
</span><span class="line">          tempii = tempr.
</span><span class="line">          case tempii.
</span><span class="line">
</span><span class="line">            when 1 .
</span><span class="line">              concatenate ls_return 'One' into ls_return separated by ' '.    "WRITE 'One' .
</span><span class="line">            when 2 .
</span><span class="line">              concatenate ls_return 'Two' into ls_return separated by ' '.    "WRITE 'Two' .
</span><span class="line">            when 3 .
</span><span class="line">              concatenate ls_return 'Three' into ls_return separated by ' '.    "WRITE 'Three' .
</span><span class="line">            when 4 .
</span><span class="line">              concatenate ls_return 'Four' into ls_return separated by ' '.    "WRITE 'Four' .
</span><span class="line">            when 5 .
</span><span class="line">              concatenate ls_return 'Five' into ls_return separated by ' '.    "WRITE 'Five' .
</span><span class="line">            when 6 .
</span><span class="line">              concatenate ls_return 'Six' into ls_return separated by ' '.    "WRITE 'Six' .
</span><span class="line">            when 7 .
</span><span class="line">              concatenate ls_return 'Seven' into ls_return separated by ' '.    "WRITE 'Seven' .
</span><span class="line">            when 8 .
</span><span class="line">              concatenate ls_return 'Eight' into ls_return separated by ' '.    "WRITE 'Eight' .
</span><span class="line">            when 9 .
</span><span class="line">              concatenate ls_return 'Nine' into ls_return separated by ' '.    "WRITE 'Nine' .
</span><span class="line">          endcase.
</span><span class="line">
</span><span class="line">        endif .
</span><span class="line">        tempe = 0.  "leotian
</span><span class="line">      when 2 .
</span><span class="line">        concatenate ls_return 'Twenty' into ls_return separated by ' '.    "WRITE 'Twenty' .
</span><span class="line">      when 3 .
</span><span class="line">        concatenate ls_return 'Thirty' into ls_return separated by ' '.    "WRITE 'Thirty' .
</span><span class="line">      when 4 .
</span><span class="line">        concatenate ls_return 'Fourty' into ls_return separated by ' '.    "WRITE 'Fourty' .
</span><span class="line">      when 5 .
</span><span class="line">        concatenate ls_return 'Fifty' into ls_return separated by ' '.    "WRITE 'Fifty' .
</span><span class="line">      when 6 .
</span><span class="line">        concatenate ls_return 'Sixty' into ls_return separated by ' '.    "WRITE 'Sixty' .
</span><span class="line">      when 7 .
</span><span class="line">        concatenate ls_return 'Seventy' into ls_return separated by ' '.    "WRITE 'Seventy' .
</span><span class="line">      when 8 .
</span><span class="line">        concatenate ls_return 'Eighty' into ls_return separated by ' '.    "WRITE 'Eighty' .
</span><span class="line">      when 9 .
</span><span class="line">        concatenate ls_return 'Ninty' into ls_return separated by ' '.    "WRITE 'Ninty' .
</span><span class="line">    endcase.
</span><span class="line">
</span><span class="line">***********************
</span><span class="line">    if tempr &lt;&gt; 0 and tempe &lt;&gt; 0.
</span><span class="line">      tempii = tempr .
</span><span class="line">      case tempii.
</span><span class="line">
</span><span class="line">        when 1 .
</span><span class="line">          concatenate ls_return 'One' into ls_return separated by ' '.    "WRITE 'One' .
</span><span class="line">        when 2 .
</span><span class="line">          concatenate ls_return 'Two' into ls_return separated by ' '.    "WRITE 'Two' .
</span><span class="line">        when 3 .
</span><span class="line">          concatenate ls_return 'Three' into ls_return separated by ' '.    "WRITE 'Three' .
</span><span class="line">        when 4 .
</span><span class="line">          concatenate ls_return 'Four' into ls_return separated by ' '.    "WRITE 'Four' .
</span><span class="line">        when 5 .
</span><span class="line">          concatenate ls_return 'Five' into ls_return separated by ' '.    "WRITE 'Five' .
</span><span class="line">        when 6 .
</span><span class="line">          concatenate ls_return 'Six' into ls_return separated by ' '.    "WRITE 'Six' .
</span><span class="line">        when 7 .
</span><span class="line">          concatenate ls_return 'Seven' into ls_return separated by ' '.    "WRITE 'Seven' .
</span><span class="line">        when 8 .
</span><span class="line">          concatenate ls_return 'Eight' into ls_return separated by ' '.    "WRITE 'Eight' .
</span><span class="line">        when 9 .
</span><span class="line">          concatenate ls_return 'Nine' into ls_return separated by ' '.    "WRITE 'Nine' .
</span><span class="line">      endcase.
</span><span class="line">
</span><span class="line">    endif .
</span><span class="line">
</span><span class="line">***********************
</span><span class="line">
</span><span class="line">    concatenate ls_return 'Billion' into ls_return separated by ' '.    "WRITE 'billion' .
</span><span class="line">    "CONCATENATE ls_return 'One' INTO ls_return SEPARATED BY ' '.    "WRITE / .
</span><span class="line">  endif .
</span><span class="line">
</span><span class="line">***************************************************************
</span><span class="line">  if temp2 &lt;&gt; 0 .
</span><span class="line">*    IF ls_return &lt;&gt; ''.
</span><span class="line">*      CONCATENATE ls_return 'And' INTO ls_return SEPARATED BY ' '.    "WRITE 'And'.
</span><span class="line">*    ENDIF.
</span><span class="line">    tempii = temp2 .
</span><span class="line">
</span><span class="line">    tempw = tempii div 100 .
</span><span class="line">    tempii = tempii mod 100 .
</span><span class="line">
</span><span class="line">    tempe = tempii div 10 .
</span><span class="line">    tempii = tempii mod 10 .
</span><span class="line">
</span><span class="line">    tempr = tempii .
</span><span class="line">*********************
</span><span class="line">    if tempw &lt;&gt; 0 .
</span><span class="line">      tempii = tempw .
</span><span class="line">      case tempii.
</span><span class="line">
</span><span class="line">        when 1 .
</span><span class="line">          concatenate ls_return 'One' into ls_return separated by ' '.    "WRITE 'One' .
</span><span class="line">        when 2 .
</span><span class="line">          concatenate ls_return 'Two' into ls_return separated by ' '.    "WRITE 'Two' .
</span><span class="line">        when 3 .
</span><span class="line">          concatenate ls_return 'Three' into ls_return separated by ' '.    "WRITE 'Three' .
</span><span class="line">        when 4 .
</span><span class="line">          concatenate ls_return 'Four' into ls_return separated by ' '.    "WRITE 'Four' .
</span><span class="line">        when 5 .
</span><span class="line">          concatenate ls_return 'Five' into ls_return separated by ' '.    "WRITE 'Five' .
</span><span class="line">        when 6 .
</span><span class="line">          concatenate ls_return 'Six' into ls_return separated by ' '.    "WRITE 'Six' .
</span><span class="line">        when 7 .
</span><span class="line">          concatenate ls_return 'Seven' into ls_return separated by ' '.    "WRITE 'Seven' .
</span><span class="line">        when 8 .
</span><span class="line">          concatenate ls_return 'Eight' into ls_return separated by ' '.    "WRITE 'Eight' .
</span><span class="line">        when 9 .
</span><span class="line">          concatenate ls_return 'Nine' into ls_return separated by ' '.    "WRITE 'Nine' .
</span><span class="line">      endcase.
</span><span class="line">      concatenate ls_return 'Hundred' into ls_return separated by ' '.    "WRITE 'Hundred' .
</span><span class="line">    endif .
</span><span class="line">*********************
</span><span class="line">
</span><span class="line">    tempii = tempe .
</span><span class="line">    case tempii.
</span><span class="line">      when 1 .
</span><span class="line">        tempii = temp2 mod 100 .
</span><span class="line">
</span><span class="line">        case tempii.
</span><span class="line">
</span><span class="line">          when 11 .
</span><span class="line">            concatenate ls_return 'Eleven' into ls_return separated by ' '.    "WRITE 'Eleven' .
</span><span class="line">          when 12 .
</span><span class="line">            concatenate ls_return 'Twelve' into ls_return separated by ' '.    "WRITE 'Twelve' .
</span><span class="line">          when 13 .
</span><span class="line">            concatenate ls_return 'Thirteen' into ls_return separated by ' '.    "WRITE 'Thirteen' .
</span><span class="line">          when 14 .
</span><span class="line">            concatenate ls_return 'Fourteen' into ls_return separated by ' '.    "WRITE 'Fourteen' .
</span><span class="line">          when 15 .
</span><span class="line">            concatenate ls_return 'Fifteen' into ls_return separated by ' '.    "WRITE 'Fifteen' .
</span><span class="line">          when 16 .
</span><span class="line">            concatenate ls_return 'Sixteen' into ls_return separated by ' '.    "WRITE 'Sixteen' .
</span><span class="line">          when 17 .
</span><span class="line">            concatenate ls_return 'Seventeen' into ls_return separated by ' '.    "WRITE 'Seventeen' .
</span><span class="line">          when 18 .
</span><span class="line">            concatenate ls_return 'Eighteen' into ls_return separated by ' '.    "WRITE 'Eighteen' .
</span><span class="line">          when 19 .
</span><span class="line">            concatenate ls_return 'Nineteen' into ls_return separated by ' '.    "WRITE 'Nineteen' .
</span><span class="line">
</span><span class="line">        endcase.
</span><span class="line">        tempr = 0.  "leotian
</span><span class="line">      when 0 .
</span><span class="line">
</span><span class="line">        if tempr &lt;&gt; 0 .
</span><span class="line">          if ls_return &lt;&gt; ''.
</span><span class="line">            concatenate ls_return 'And' into ls_return separated by ' '.    "WRITE 'And'.
</span><span class="line">          endif.
</span><span class="line">          tempii = tempr.
</span><span class="line">          case tempii.
</span><span class="line">            when 1 .
</span><span class="line">              concatenate ls_return 'One' into ls_return separated by ' '.    "WRITE 'One' .
</span><span class="line">            when 2 .
</span><span class="line">              concatenate ls_return 'Two' into ls_return separated by ' '.    "WRITE 'Two' .
</span><span class="line">            when 3 .
</span><span class="line">              concatenate ls_return 'Three' into ls_return separated by ' '.    "WRITE 'Three' .
</span><span class="line">            when 4 .
</span><span class="line">              concatenate ls_return 'Four' into ls_return separated by ' '.    "WRITE 'Four' .
</span><span class="line">            when 5 .
</span><span class="line">              concatenate ls_return 'Five' into ls_return separated by ' '.    "WRITE 'Five' .
</span><span class="line">            when 6 .
</span><span class="line">              concatenate ls_return 'Six' into ls_return separated by ' '.    "WRITE 'Six' .
</span><span class="line">            when 7 .
</span><span class="line">              concatenate ls_return 'Seven' into ls_return separated by ' '.    "WRITE 'Seven' .
</span><span class="line">            when 8 .
</span><span class="line">              concatenate ls_return 'Eight' into ls_return separated by ' '.    "WRITE 'Eight' .
</span><span class="line">            when 9 .
</span><span class="line">              concatenate ls_return 'Nine' into ls_return separated by ' '.    "WRITE 'Nine' .
</span><span class="line">          endcase.
</span><span class="line">
</span><span class="line">        endif .
</span><span class="line">        tempe = 0.  "leotian
</span><span class="line">      when 2 .
</span><span class="line">        concatenate ls_return 'Twenty' into ls_return separated by ' '.    "WRITE 'Twenty' .
</span><span class="line">      when 3 .
</span><span class="line">        concatenate ls_return 'Thirty' into ls_return separated by ' '.    "WRITE 'Thirty' .
</span><span class="line">      when 4 .
</span><span class="line">        concatenate ls_return 'Fourty' into ls_return separated by ' '.    "WRITE 'Fourty' .
</span><span class="line">      when 5 .
</span><span class="line">        concatenate ls_return 'Fifty' into ls_return separated by ' '.    "WRITE 'Fifty' .
</span><span class="line">      when 6 .
</span><span class="line">        concatenate ls_return 'Sixty' into ls_return separated by ' '.    "WRITE 'Sixty' .
</span><span class="line">      when 7 .
</span><span class="line">        concatenate ls_return 'Seventy' into ls_return separated by ' '.    "WRITE 'Seventy' .
</span><span class="line">      when 8 .
</span><span class="line">        concatenate ls_return 'Eighty' into ls_return separated by ' '.    "WRITE 'Eighty' .
</span><span class="line">      when 9 .
</span><span class="line">        concatenate ls_return 'Ninty' into ls_return separated by ' '.    "WRITE 'Ninty' .
</span><span class="line">    endcase.
</span><span class="line">
</span><span class="line">***********************
</span><span class="line">    if tempr &lt;&gt; 0 and tempe &lt;&gt; 0.
</span><span class="line">      tempii = tempr .
</span><span class="line">      case tempii.
</span><span class="line">
</span><span class="line">        when 1 .
</span><span class="line">          concatenate ls_return 'One' into ls_return separated by ' '.    "WRITE 'One' .
</span><span class="line">        when 2 .
</span><span class="line">          concatenate ls_return 'Two' into ls_return separated by ' '.    "WRITE 'Two' .
</span><span class="line">        when 3 .
</span><span class="line">          concatenate ls_return 'Three' into ls_return separated by ' '.    "WRITE 'Three' .
</span><span class="line">        when 4 .
</span><span class="line">          concatenate ls_return 'Four' into ls_return separated by ' '.    "WRITE 'Four' .
</span><span class="line">        when 5 .
</span><span class="line">          concatenate ls_return 'Five' into ls_return separated by ' '.    "WRITE 'Five' .
</span><span class="line">        when 6 .
</span><span class="line">          concatenate ls_return 'Six' into ls_return separated by ' '.    "WRITE 'Six' .
</span><span class="line">        when 7 .
</span><span class="line">          concatenate ls_return 'Seven' into ls_return separated by ' '.    "WRITE 'Seven' .
</span><span class="line">        when 8 .
</span><span class="line">          concatenate ls_return 'Eight' into ls_return separated by ' '.    "WRITE 'Eight' .
</span><span class="line">        when 9 .
</span><span class="line">          concatenate ls_return 'Nine' into ls_return separated by ' '.    "WRITE 'Nine' .
</span><span class="line">      endcase.
</span><span class="line">
</span><span class="line">    endif .
</span><span class="line">
</span><span class="line">***********************
</span><span class="line">    concatenate ls_return 'Million' into ls_return separated by ' '.    "WRITE 'million' .
</span><span class="line">    "CONCATENATE ls_return 'One' INTO ls_return SEPARATED BY ' '.    "WRITE / .
</span><span class="line">  endif .
</span><span class="line">
</span><span class="line">***************************************************************
</span><span class="line">  if temp3 &lt;&gt; 0 .
</span><span class="line">*    IF ls_return &lt;&gt; ''.
</span><span class="line">*      CONCATENATE ls_return 'And' INTO ls_return SEPARATED BY ' '.    "WRITE 'And'.
</span><span class="line">*    ENDIF.
</span><span class="line">    tempii = temp3 .
</span><span class="line">
</span><span class="line">    tempw = tempii div 100 .
</span><span class="line">    tempii = tempii mod 100 .
</span><span class="line">
</span><span class="line">    tempe = tempii div 10 .
</span><span class="line">    tempii = tempii mod 10 .
</span><span class="line">
</span><span class="line">    tempr = tempii .
</span><span class="line">*********************
</span><span class="line">    if tempw &lt;&gt; 0 .
</span><span class="line">      tempii = tempw .
</span><span class="line">      case tempii.
</span><span class="line">
</span><span class="line">        when 1 .
</span><span class="line">          concatenate ls_return 'One' into ls_return separated by ' '.    "WRITE 'One' .
</span><span class="line">        when 2 .
</span><span class="line">          concatenate ls_return 'Two' into ls_return separated by ' '.    "WRITE 'Two' .
</span><span class="line">        when 3 .
</span><span class="line">          concatenate ls_return 'Three' into ls_return separated by ' '.    "WRITE 'Three' .
</span><span class="line">        when 4 .
</span><span class="line">          concatenate ls_return 'Four' into ls_return separated by ' '.    "WRITE 'Four' .
</span><span class="line">        when 5 .
</span><span class="line">          concatenate ls_return 'Five' into ls_return separated by ' '.    "WRITE 'Five' .
</span><span class="line">        when 6 .
</span><span class="line">          concatenate ls_return 'Six' into ls_return separated by ' '.    "WRITE 'Six' .
</span><span class="line">        when 7 .
</span><span class="line">          concatenate ls_return 'Seven' into ls_return separated by ' '.    "WRITE 'Seven' .
</span><span class="line">        when 8 .
</span><span class="line">          concatenate ls_return 'Eight' into ls_return separated by ' '.    "WRITE 'Eight' .
</span><span class="line">        when 9 .
</span><span class="line">          concatenate ls_return 'Nine' into ls_return separated by ' '.    "WRITE 'Nine' .
</span><span class="line">      endcase.
</span><span class="line">      concatenate ls_return 'Hundred' into ls_return separated by ' '.    "WRITE 'Hundred' .
</span><span class="line">    endif .
</span><span class="line">*********************
</span><span class="line">
</span><span class="line">    tempii = tempe .
</span><span class="line">    case tempii.
</span><span class="line">      when 1 .
</span><span class="line">        tempii = temp3 mod 100 .
</span><span class="line">
</span><span class="line">        case tempii.
</span><span class="line">
</span><span class="line">          when 11 .
</span><span class="line">            concatenate ls_return 'Eleven' into ls_return separated by ' '.    "WRITE 'Eleven' .
</span><span class="line">          when 12 .
</span><span class="line">            concatenate ls_return 'Twelve' into ls_return separated by ' '.    "WRITE 'Twelve' .
</span><span class="line">          when 13 .
</span><span class="line">            concatenate ls_return 'Thirteen' into ls_return separated by ' '.    "WRITE 'Thirteen' .
</span><span class="line">          when 14 .
</span><span class="line">            concatenate ls_return 'Fourteen' into ls_return separated by ' '.    "WRITE 'Fourteen' .
</span><span class="line">          when 15 .
</span><span class="line">            concatenate ls_return 'Fifteen' into ls_return separated by ' '.    "WRITE 'Fifteen' .
</span><span class="line">          when 16 .
</span><span class="line">            concatenate ls_return 'Sixteen' into ls_return separated by ' '.    "WRITE 'Sixteen' .
</span><span class="line">          when 17 .
</span><span class="line">            concatenate ls_return 'Seventeen' into ls_return separated by ' '.    "WRITE 'Seventeen' .
</span><span class="line">          when 18 .
</span><span class="line">            concatenate ls_return 'Eighteen' into ls_return separated by ' '.    "WRITE 'Eighteen' .
</span><span class="line">          when 19 .
</span><span class="line">            concatenate ls_return 'Nineteen' into ls_return separated by ' '.    "WRITE 'Nineteen' .
</span><span class="line">
</span><span class="line">        endcase.
</span><span class="line">        tempr = 0.  "leotian
</span><span class="line">      when 0 .
</span><span class="line">
</span><span class="line">        if tempr &lt;&gt; 0 .
</span><span class="line">          if ls_return &lt;&gt; ''.
</span><span class="line">            concatenate ls_return 'And' into ls_return separated by ' '.    "WRITE 'And'.
</span><span class="line">          endif.
</span><span class="line">          tempii = tempr.
</span><span class="line">          case tempii.
</span><span class="line">
</span><span class="line">            when 1 .
</span><span class="line">              concatenate ls_return 'One' into ls_return separated by ' '.    "WRITE 'One' .
</span><span class="line">            when 2 .
</span><span class="line">              concatenate ls_return 'Two' into ls_return separated by ' '.    "WRITE 'Two' .
</span><span class="line">            when 3 .
</span><span class="line">              concatenate ls_return 'Three' into ls_return separated by ' '.    "WRITE 'Three' .
</span><span class="line">            when 4 .
</span><span class="line">              concatenate ls_return 'Four' into ls_return separated by ' '.    "WRITE 'Four' .
</span><span class="line">            when 5 .
</span><span class="line">              concatenate ls_return 'Five' into ls_return separated by ' '.    "WRITE 'Five' .
</span><span class="line">            when 6 .
</span><span class="line">              concatenate ls_return 'Six' into ls_return separated by ' '.    "WRITE 'Six' .
</span><span class="line">            when 7 .
</span><span class="line">              concatenate ls_return 'Seven' into ls_return separated by ' '.    "WRITE 'Seven' .
</span><span class="line">            when 8 .
</span><span class="line">              concatenate ls_return 'Eight' into ls_return separated by ' '.    "WRITE 'Eight' .
</span><span class="line">            when 9 .
</span><span class="line">              concatenate ls_return 'Nine' into ls_return separated by ' '.    "WRITE 'Nine' .
</span><span class="line">          endcase.
</span><span class="line">
</span><span class="line">        endif .
</span><span class="line">        tempe = 0.  "leotian
</span><span class="line">      when 2 .
</span><span class="line">        concatenate ls_return 'Twenty' into ls_return separated by ' '.    "WRITE 'Twenty' .
</span><span class="line">      when 3 .
</span><span class="line">        concatenate ls_return 'Thirty' into ls_return separated by ' '.    "WRITE 'Thirty' .
</span><span class="line">      when 4 .
</span><span class="line">        concatenate ls_return 'Fourty' into ls_return separated by ' '.    "WRITE 'Fourty' .
</span><span class="line">      when 5 .
</span><span class="line">        concatenate ls_return 'Fifty' into ls_return separated by ' '.    "WRITE 'Fifty' .
</span><span class="line">      when 6 .
</span><span class="line">        concatenate ls_return 'Sixty' into ls_return separated by ' '.    "WRITE 'Sixty' .
</span><span class="line">      when 7 .
</span><span class="line">        concatenate ls_return 'Seventy' into ls_return separated by ' '.    "WRITE 'Seventy' .
</span><span class="line">      when 8 .
</span><span class="line">        concatenate ls_return 'Eighty' into ls_return separated by ' '.    "WRITE 'Eighty' .
</span><span class="line">      when 9 .
</span><span class="line">        concatenate ls_return 'Ninty' into ls_return separated by ' '.    "WRITE 'Ninty' .
</span><span class="line">    endcase.
</span><span class="line">
</span><span class="line">***********************
</span><span class="line">    if tempr &lt;&gt; 0 and tempe &lt;&gt; 0.
</span><span class="line">      tempii = tempr .
</span><span class="line">      case tempii.
</span><span class="line">
</span><span class="line">        when 1 .
</span><span class="line">          concatenate ls_return 'One' into ls_return separated by ' '.    "WRITE 'One' .
</span><span class="line">        when 2 .
</span><span class="line">          concatenate ls_return 'Two' into ls_return separated by ' '.    "WRITE 'Two' .
</span><span class="line">        when 3 .
</span><span class="line">          concatenate ls_return 'Three' into ls_return separated by ' '.    "WRITE 'Three' .
</span><span class="line">        when 4 .
</span><span class="line">          concatenate ls_return 'Four' into ls_return separated by ' '.    "WRITE 'Four' .
</span><span class="line">        when 5 .
</span><span class="line">          concatenate ls_return 'Five' into ls_return separated by ' '.    "WRITE 'Five' .
</span><span class="line">        when 6 .
</span><span class="line">          concatenate ls_return 'Six' into ls_return separated by ' '.    "WRITE 'Six' .
</span><span class="line">        when 7 .
</span><span class="line">          concatenate ls_return 'Seven' into ls_return separated by ' '.    "WRITE 'Seven' .
</span><span class="line">        when 8 .
</span><span class="line">          concatenate ls_return 'Eight' into ls_return separated by ' '.    "WRITE 'Eight' .
</span><span class="line">        when 9 .
</span><span class="line">          concatenate ls_return 'Nine' into ls_return separated by ' '.    "WRITE 'Nine' .
</span><span class="line">      endcase.
</span><span class="line">
</span><span class="line">    endif .
</span><span class="line">
</span><span class="line">***********************
</span><span class="line">    concatenate ls_return 'Thousand' into ls_return separated by ' '.    "WRITE 'thousAnd' .
</span><span class="line">
</span><span class="line">  endif .
</span><span class="line">
</span><span class="line">***************************************************************
</span><span class="line">
</span><span class="line">  if temp4 &lt;&gt; 0 .
</span><span class="line">*    IF ls_return &lt;&gt; ''.
</span><span class="line">*      CONCATENATE ls_return 'And' INTO ls_return SEPARATED BY ' '.    "WRITE 'And'.
</span><span class="line">*    ENDIF.
</span><span class="line">    tempii = temp4 .
</span><span class="line">
</span><span class="line">    tempw = tempii div 100 .
</span><span class="line">    tempii = tempii mod 100 .
</span><span class="line">
</span><span class="line">    tempe = tempii div 10 .
</span><span class="line">    tempii = tempii mod 10 .
</span><span class="line">
</span><span class="line">    tempr = tempii .
</span><span class="line">*********************
</span><span class="line">    if tempw &lt;&gt; 0 .
</span><span class="line">      tempii = tempw .
</span><span class="line">      case tempii.
</span><span class="line">
</span><span class="line">        when 1 .
</span><span class="line">          concatenate ls_return 'One' into ls_return separated by ' '.    "WRITE 'One' .
</span><span class="line">        when 2 .
</span><span class="line">          concatenate ls_return 'Two' into ls_return separated by ' '.    "WRITE 'Two' .
</span><span class="line">        when 3 .
</span><span class="line">          concatenate ls_return 'Three' into ls_return separated by ' '.    "WRITE 'Three' .
</span><span class="line">        when 4 .
</span><span class="line">          concatenate ls_return 'Four' into ls_return separated by ' '.    "WRITE 'Four' .
</span><span class="line">        when 5 .
</span><span class="line">          concatenate ls_return 'Five' into ls_return separated by ' '.    "WRITE 'Five' .
</span><span class="line">        when 6 .
</span><span class="line">          concatenate ls_return 'Six' into ls_return separated by ' '.    "WRITE 'Six' .
</span><span class="line">        when 7 .
</span><span class="line">          concatenate ls_return 'Seven' into ls_return separated by ' '.    "WRITE 'Seven' .
</span><span class="line">        when 8 .
</span><span class="line">          concatenate ls_return 'Eight' into ls_return separated by ' '.    "WRITE 'Eight' .
</span><span class="line">        when 9 .
</span><span class="line">          concatenate ls_return 'Nine' into ls_return separated by ' '.    "WRITE 'Nine' .
</span><span class="line">      endcase.
</span><span class="line">      concatenate ls_return 'Hundred' into ls_return separated by ' '.    "WRITE 'Hundred' .
</span><span class="line">    endif .
</span><span class="line">*********************
</span><span class="line">
</span><span class="line">    tempii = tempe .
</span><span class="line">    case tempii.
</span><span class="line">      when 1 .
</span><span class="line">        tempii = temp4 mod 100.
</span><span class="line">
</span><span class="line">        case tempii.
</span><span class="line">          when 10.
</span><span class="line">            concatenate ls_return 'Ten' into ls_return separated by ' '.    "WRITE 'Eleven'
</span><span class="line">          when 11 .
</span><span class="line">            concatenate ls_return 'Eleven' into ls_return separated by ' '.    "WRITE 'Eleven' .
</span><span class="line">          when 12 .
</span><span class="line">            concatenate ls_return 'Twelve' into ls_return separated by ' '.    "WRITE 'Twelve' .
</span><span class="line">          when 13 .
</span><span class="line">            concatenate ls_return 'Thirteen' into ls_return separated by ' '.    "WRITE 'Thirteen' .
</span><span class="line">          when 14 .
</span><span class="line">            concatenate ls_return 'Fourteen' into ls_return separated by ' '.    "WRITE 'Fourteen' .
</span><span class="line">          when 15 .
</span><span class="line">            concatenate ls_return 'Fifteen' into ls_return separated by ' '.    "WRITE 'Fifteen' .
</span><span class="line">          when 16 .
</span><span class="line">            concatenate ls_return 'Sixteen' into ls_return separated by ' '.    "WRITE 'Sixteen' .
</span><span class="line">          when 17 .
</span><span class="line">            concatenate ls_return 'Seventeen' into ls_return separated by ' '.    "WRITE 'Seventeen' .
</span><span class="line">          when 18 .
</span><span class="line">            concatenate ls_return 'Eighteen' into ls_return separated by ' '.    "WRITE 'Eighteen' .
</span><span class="line">          when 19 .
</span><span class="line">            concatenate ls_return 'Nineteen' into ls_return separated by ' '.    "WRITE 'Nineteen' .
</span><span class="line">
</span><span class="line">        endcase.
</span><span class="line">        tempr = 0.  "leotian
</span><span class="line">      when 0 .
</span><span class="line">
</span><span class="line">        if tempr &lt;&gt; 0 .
</span><span class="line">          if ls_return &lt;&gt; ''.
</span><span class="line">            concatenate ls_return 'And' into ls_return separated by ' '.    "WRITE 'And'.
</span><span class="line">          endif.
</span><span class="line">          tempii = tempr.
</span><span class="line">          case tempii.
</span><span class="line">
</span><span class="line">            when 1 .
</span><span class="line">              concatenate ls_return 'One' into ls_return separated by ' '.    "WRITE 'One' .
</span><span class="line">            when 2 .
</span><span class="line">              concatenate ls_return 'Two' into ls_return separated by ' '.    "WRITE 'Two' .
</span><span class="line">            when 3 .
</span><span class="line">              concatenate ls_return 'Three' into ls_return separated by ' '.    "WRITE 'Three' .
</span><span class="line">            when 4 .
</span><span class="line">              concatenate ls_return 'Four' into ls_return separated by ' '.    "WRITE 'Four' .
</span><span class="line">            when 5 .
</span><span class="line">              concatenate ls_return 'Five' into ls_return separated by ' '.    "WRITE 'Five' .
</span><span class="line">            when 6 .
</span><span class="line">              concatenate ls_return 'Six' into ls_return separated by ' '.    "WRITE 'Six' .
</span><span class="line">            when 7 .
</span><span class="line">              concatenate ls_return 'Seven' into ls_return separated by ' '.    "WRITE 'Seven' .
</span><span class="line">            when 8 .
</span><span class="line">              concatenate ls_return 'Eight' into ls_return separated by ' '.    "WRITE 'Eight' .
</span><span class="line">            when 9 .
</span><span class="line">              concatenate ls_return 'Nine' into ls_return separated by ' '.    "WRITE 'Nine' .
</span><span class="line">          endcase.
</span><span class="line">
</span><span class="line">        endif .
</span><span class="line">        tempe = 0.  "leotian
</span><span class="line">      when 2 .
</span><span class="line">        concatenate ls_return 'Twenty' into ls_return separated by ' '.    "WRITE 'Twenty' .
</span><span class="line">      when 3 .
</span><span class="line">        concatenate ls_return 'Thirty' into ls_return separated by ' '.    "WRITE 'Thirty' .
</span><span class="line">      when 4 .
</span><span class="line">        concatenate ls_return 'Fourty' into ls_return separated by ' '.    "WRITE 'Fourty' .
</span><span class="line">      when 5 .
</span><span class="line">        concatenate ls_return 'Fifty' into ls_return separated by ' '.    "WRITE 'Fifty' .
</span><span class="line">      when 6 .
</span><span class="line">        concatenate ls_return 'Sixty' into ls_return separated by ' '.    "WRITE 'Sixty' .
</span><span class="line">      when 7 .
</span><span class="line">        concatenate ls_return 'Seventy' into ls_return separated by ' '.    "WRITE 'Seventy' .
</span><span class="line">      when 8 .
</span><span class="line">        concatenate ls_return 'Eighty' into ls_return separated by ' '.    "WRITE 'Eighty' .
</span><span class="line">      when 9 .
</span><span class="line">        concatenate ls_return 'Ninty' into ls_return separated by ' '.    "WRITE 'Ninty' .
</span><span class="line">    endcase.
</span><span class="line">
</span><span class="line">***********************
</span><span class="line">    if tempr &lt;&gt; 0 and tempe &lt;&gt; 0.
</span><span class="line">      tempii = tempr .
</span><span class="line">      case tempii.
</span><span class="line">
</span><span class="line">        when 1 .
</span><span class="line">          concatenate ls_return 'One' into ls_return separated by ' '.    "WRITE 'One' .
</span><span class="line">        when 2 .
</span><span class="line">          concatenate ls_return 'Two' into ls_return separated by ' '.    "WRITE 'Two' .
</span><span class="line">        when 3 .
</span><span class="line">          concatenate ls_return 'Three' into ls_return separated by ' '.    "WRITE 'Three' .
</span><span class="line">        when 4 .
</span><span class="line">          concatenate ls_return 'Four' into ls_return separated by ' '.    "WRITE 'Four' .
</span><span class="line">        when 5 .
</span><span class="line">          concatenate ls_return 'Five' into ls_return separated by ' '.    "WRITE 'Five' .
</span><span class="line">        when 6 .
</span><span class="line">          concatenate ls_return 'Six' into ls_return separated by ' '.    "WRITE 'Six' .
</span><span class="line">        when 7 .
</span><span class="line">          concatenate ls_return 'Seven' into ls_return separated by ' '.    "WRITE 'Seven' .
</span><span class="line">        when 8 .
</span><span class="line">          concatenate ls_return 'Eight' into ls_return separated by ' '.    "WRITE 'Eight' .
</span><span class="line">        when 9 .
</span><span class="line">          concatenate ls_return 'Nine' into ls_return separated by ' '.    "WRITE 'Nine' .
</span><span class="line">      endcase.
</span><span class="line">
</span><span class="line">    endif .
</span><span class="line">
</span><span class="line">***********************
</span><span class="line">
</span><span class="line">  endif .
</span><span class="line">
</span><span class="line">  if ls_return &lt;&gt; ''.
</span><span class="line">    concatenate ls_return 'Dollars' into ls_return separated by ' '.    "WRITE 'And'.
</span><span class="line">  endif.
</span><span class="line">***********************
</span><span class="line">  "处理小数
</span><span class="line">  if pnum &gt; 0.
</span><span class="line">    tempii = pnum .
</span><span class="line">
</span><span class="line">    tempw = tempii div 100 .
</span><span class="line">    tempii = tempii mod 100 .
</span><span class="line">
</span><span class="line">    tempe = tempii div 10 .
</span><span class="line">    tempii = tempii mod 10 .
</span><span class="line">
</span><span class="line">    tempr = tempii .
</span><span class="line">*********************
</span><span class="line">    if tempw &lt;&gt; 0 .
</span><span class="line">      tempii = tempw .
</span><span class="line">      case tempii.
</span><span class="line">
</span><span class="line">        when 1 .
</span><span class="line">          concatenate ls_return 'One' into ls_return separated by ' '.    "WRITE 'One' .
</span><span class="line">        when 2 .
</span><span class="line">          concatenate ls_return 'Two' into ls_return separated by ' '.    "WRITE 'Two' .
</span><span class="line">        when 3 .
</span><span class="line">          concatenate ls_return 'Three' into ls_return separated by ' '.    "WRITE 'Three' .
</span><span class="line">        when 4 .
</span><span class="line">          concatenate ls_return 'Four' into ls_return separated by ' '.    "WRITE 'Four' .
</span><span class="line">        when 5 .
</span><span class="line">          concatenate ls_return 'Five' into ls_return separated by ' '.    "WRITE 'Five' .
</span><span class="line">        when 6 .
</span><span class="line">          concatenate ls_return 'Six' into ls_return separated by ' '.    "WRITE 'Six' .
</span><span class="line">        when 7 .
</span><span class="line">          concatenate ls_return 'Seven' into ls_return separated by ' '.    "WRITE 'Seven' .
</span><span class="line">        when 8 .
</span><span class="line">          concatenate ls_return 'Eight' into ls_return separated by ' '.    "WRITE 'Eight' .
</span><span class="line">        when 9 .
</span><span class="line">          concatenate ls_return 'Nine' into ls_return separated by ' '.    "WRITE 'Nine' .
</span><span class="line">      endcase.
</span><span class="line">      concatenate ls_return 'Hundred' into ls_return separated by ' '.    "WRITE 'Hundred' .
</span><span class="line">    endif .
</span><span class="line">*********************
</span><span class="line">
</span><span class="line">    tempii = tempe .
</span><span class="line">    case tempii.
</span><span class="line">      when 1 .
</span><span class="line">        tempii = pnum mod 100.
</span><span class="line">        concatenate ls_return 'And' into ls_return separated by ' '.    "WRITE 'And'.
</span><span class="line">        case tempii.
</span><span class="line">
</span><span class="line">          when 11 .
</span><span class="line">            concatenate ls_return 'Eleven' into ls_return separated by ' '.    "WRITE 'Eleven' .
</span><span class="line">          when 12 .
</span><span class="line">            concatenate ls_return 'Twelve' into ls_return separated by ' '.    "WRITE 'Twelve' .
</span><span class="line">          when 13 .
</span><span class="line">            concatenate ls_return 'Thirteen' into ls_return separated by ' '.    "WRITE 'Thirteen' .
</span><span class="line">          when 14 .
</span><span class="line">            concatenate ls_return 'Fourteen' into ls_return separated by ' '.    "WRITE 'Fourteen' .
</span><span class="line">          when 15 .
</span><span class="line">            concatenate ls_return 'Fifteen' into ls_return separated by ' '.    "WRITE 'Fifteen' .
</span><span class="line">          when 16 .
</span><span class="line">            concatenate ls_return 'Sixteen' into ls_return separated by ' '.    "WRITE 'Sixteen' .
</span><span class="line">          when 17 .
</span><span class="line">            concatenate ls_return 'Seventeen' into ls_return separated by ' '.    "WRITE 'Seventeen' .
</span><span class="line">          when 18 .
</span><span class="line">            concatenate ls_return 'Eighteen' into ls_return separated by ' '.    "WRITE 'Eighteen' .
</span><span class="line">          when 19 .
</span><span class="line">            concatenate ls_return 'Nineteen' into ls_return separated by ' '.    "WRITE 'Nineteen' .
</span><span class="line">
</span><span class="line">        endcase.
</span><span class="line">        tempr = 0.  "leotian
</span><span class="line">      when 0 .
</span><span class="line">
</span><span class="line">        if tempr &lt;&gt; 0 .
</span><span class="line">          if ls_return &lt;&gt; ''.
</span><span class="line">            concatenate ls_return 'And' into ls_return separated by ' '.    "WRITE 'And'.
</span><span class="line">          endif.
</span><span class="line">          tempii = tempr.
</span><span class="line">          case tempii.
</span><span class="line">
</span><span class="line">            when 1 .
</span><span class="line">              concatenate ls_return 'One' into ls_return separated by ' '.    "WRITE 'One' .
</span><span class="line">            when 2 .
</span><span class="line">              concatenate ls_return 'Two' into ls_return separated by ' '.    "WRITE 'Two' .
</span><span class="line">            when 3 .
</span><span class="line">              concatenate ls_return 'Three' into ls_return separated by ' '.    "WRITE 'Three' .
</span><span class="line">            when 4 .
</span><span class="line">              concatenate ls_return 'Four' into ls_return separated by ' '.    "WRITE 'Four' .
</span><span class="line">            when 5 .
</span><span class="line">              concatenate ls_return 'Five' into ls_return separated by ' '.    "WRITE 'Five' .
</span><span class="line">            when 6 .
</span><span class="line">              concatenate ls_return 'Six' into ls_return separated by ' '.    "WRITE 'Six' .
</span><span class="line">            when 7 .
</span><span class="line">              concatenate ls_return 'Seven' into ls_return separated by ' '.    "WRITE 'Seven' .
</span><span class="line">            when 8 .
</span><span class="line">              concatenate ls_return 'Eight' into ls_return separated by ' '.    "WRITE 'Eight' .
</span><span class="line">            when 9 .
</span><span class="line">              concatenate ls_return 'Nine' into ls_return separated by ' '.    "WRITE 'Nine' .
</span><span class="line">          endcase.
</span><span class="line">
</span><span class="line">        endif .
</span><span class="line">        tempe = 0.  "leotian
</span><span class="line">      when 2 .
</span><span class="line">        concatenate ls_return 'Twenty' into ls_return separated by ' '.    "WRITE 'Twenty' .
</span><span class="line">      when 3 .
</span><span class="line">        concatenate ls_return 'Thirty' into ls_return separated by ' '.    "WRITE 'Thirty' .
</span><span class="line">      when 4 .
</span><span class="line">        concatenate ls_return 'Fourty' into ls_return separated by ' '.    "WRITE 'Fourty' .
</span><span class="line">      when 5 .
</span><span class="line">        concatenate ls_return 'Fifty' into ls_return separated by ' '.    "WRITE 'Fifty' .
</span><span class="line">      when 6 .
</span><span class="line">        concatenate ls_return 'Sixty' into ls_return separated by ' '.    "WRITE 'Sixty' .
</span><span class="line">      when 7 .
</span><span class="line">        concatenate ls_return 'Seventy' into ls_return separated by ' '.    "WRITE 'Seventy' .
</span><span class="line">      when 8 .
</span><span class="line">        concatenate ls_return 'Eighty' into ls_return separated by ' '.    "WRITE 'Eighty' .
</span><span class="line">      when 9 .
</span><span class="line">        concatenate ls_return 'Ninty' into ls_return separated by ' '.    "WRITE 'Ninty' .
</span><span class="line">    endcase.
</span><span class="line">
</span><span class="line">***********************
</span><span class="line">    if tempr &lt;&gt; 0 and tempe &lt;&gt; 0.
</span><span class="line">      tempii = tempr .
</span><span class="line">      case tempii.
</span><span class="line">
</span><span class="line">        when 1 .
</span><span class="line">          concatenate ls_return 'One' into ls_return separated by ' '.    "WRITE 'One' .
</span><span class="line">        when 2 .
</span><span class="line">          concatenate ls_return 'Two' into ls_return separated by ' '.    "WRITE 'Two' .
</span><span class="line">        when 3 .
</span><span class="line">          concatenate ls_return 'Three' into ls_return separated by ' '.    "WRITE 'Three' .
</span><span class="line">        when 4 .
</span><span class="line">          concatenate ls_return 'Four' into ls_return separated by ' '.    "WRITE 'Four' .
</span><span class="line">        when 5 .
</span><span class="line">          concatenate ls_return 'Five' into ls_return separated by ' '.    "WRITE 'Five' .
</span><span class="line">        when 6 .
</span><span class="line">          concatenate ls_return 'Six' into ls_return separated by ' '.    "WRITE 'Six' .
</span><span class="line">        when 7 .
</span><span class="line">          concatenate ls_return 'Seven' into ls_return separated by ' '.    "WRITE 'Seven' .
</span><span class="line">        when 8 .
</span><span class="line">          concatenate ls_return 'Eight' into ls_return separated by ' '.    "WRITE 'Eight' .
</span><span class="line">        when 9 .
</span><span class="line">          concatenate ls_return 'Nine' into ls_return separated by ' '.    "WRITE 'Nine' .
</span><span class="line">      endcase.
</span><span class="line">
</span><span class="line">    endif .
</span><span class="line">    if ls_return &lt;&gt; ''.
</span><span class="line">      concatenate ls_return 'Cents only' into ls_return separated by ' '.    "WRITE 'And'.
</span><span class="line">    endif.
</span><span class="line">
</span><span class="line">  endif.
</span><span class="line">***********************
</span><span class="line">  "返回结果
</span><span class="line">  to_str = ls_return.
</span><span class="line">
</span><span class="line">endfunction.</span></code></pre></td></tr></table></div></figure></notextile></div>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[金额转大写中文]]></title>
    <link href="http://lomozm.github.io/blog/20131225/jin-e-zhuan-da-xie-zhong-wen/"/>
    <updated>2013-12-25T11:33:41+08:00</updated>
    <id>http://lomozm.github.io/blog/20131225/jin-e-zhuan-da-xie-zhong-wen</id>
    <content type="html"><![CDATA[
<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
</pre></td><td class="code"><pre><code class=""><span class="line">function zcurr2chinese.
</span><span class="line">*"----------------------------------------------------------------------
</span><span class="line">*"*"本地接口：
</span><span class="line">*"  IMPORTING
</span><span class="line">*"     REFERENCE(IV_MONEY) TYPE  DMBTR
</span><span class="line">*"  EXPORTING
</span><span class="line">*"     REFERENCE(EV_MONEY) TYPE  STRING
</span><span class="line">*"  EXCEPTIONS
</span><span class="line">*"      WRONG_MONEY
</span><span class="line">*"----------------------------------------------------------------------</span></code></pre></td></tr></table></div></figure></notextile></div>

<!--more-->

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
<span class="line-number">24</span>
<span class="line-number">25</span>
<span class="line-number">26</span>
<span class="line-number">27</span>
<span class="line-number">28</span>
<span class="line-number">29</span>
<span class="line-number">30</span>
<span class="line-number">31</span>
<span class="line-number">32</span>
<span class="line-number">33</span>
<span class="line-number">34</span>
<span class="line-number">35</span>
<span class="line-number">36</span>
<span class="line-number">37</span>
<span class="line-number">38</span>
<span class="line-number">39</span>
<span class="line-number">40</span>
<span class="line-number">41</span>
<span class="line-number">42</span>
<span class="line-number">43</span>
<span class="line-number">44</span>
<span class="line-number">45</span>
<span class="line-number">46</span>
<span class="line-number">47</span>
<span class="line-number">48</span>
<span class="line-number">49</span>
<span class="line-number">50</span>
<span class="line-number">51</span>
<span class="line-number">52</span>
<span class="line-number">53</span>
<span class="line-number">54</span>
<span class="line-number">55</span>
<span class="line-number">56</span>
<span class="line-number">57</span>
<span class="line-number">58</span>
<span class="line-number">59</span>
<span class="line-number">60</span>
<span class="line-number">61</span>
<span class="line-number">62</span>
<span class="line-number">63</span>
<span class="line-number">64</span>
<span class="line-number">65</span>
<span class="line-number">66</span>
<span class="line-number">67</span>
<span class="line-number">68</span>
</pre></td><td class="code"><pre><code class=""><span class="line">types: cur6  type p decimals 6 ,
</span><span class="line">         cur2  type  bf_dmbtr.
</span><span class="line">  data va1 type cur2.
</span><span class="line">  data f_source type cur2.
</span><span class="line">  data str(40) type c .
</span><span class="line">  va1 = iv_money.
</span><span class="line">  f_source = va1.
</span><span class="line">
</span><span class="line">  data: scr(30) type c, res(60) type c,fen(2) type c .
</span><span class="line">  data: len type i, c1 type i, c2 type i, c3 type i, c4 type i.
</span><span class="line">  data: d1(1) type c, d2(1) type c, d3 type i.
</span><span class="line">  data: digit(2) type c, weight(2) type c.
</span><span class="line">  data: rule1(20) type c value '零壹贰叁肆伍陆柒捌玖'.
</span><span class="line">  data: rule2(30) type c value '分角元拾佰仟万拾佰仟亿拾佰仟万拾佰仟'.
</span><span class="line">  scr = f_source * 100.
</span><span class="line">  condense scr no-gaps.
</span><span class="line">  if scr = '0'.
</span><span class="line">    res = '零元'.
</span><span class="line">  else.
</span><span class="line">    len = strlen( scr ).
</span><span class="line">    c1 = 0.
</span><span class="line">    d1 = '0'.
</span><span class="line">    clear res.
</span><span class="line">    do len times.
</span><span class="line">      c1 = c1 + 1.
</span><span class="line">      c2 = len - c1.
</span><span class="line">      d2 = scr+c2(1) .
</span><span class="line">      if d2 = '0'.
</span><span class="line">        d3 = 0.
</span><span class="line">      else.
</span><span class="line">        d3 = d2.
</span><span class="line">      endif.
</span><span class="line">      digit = rule1+d3(1) .
</span><span class="line">      c3 = ( c1 - 1 ) .
</span><span class="line">      weight = rule2+c3(1) .
</span><span class="line">      if d2 = '0'.
</span><span class="line">        if c1 = 3.
</span><span class="line">          digit = ''.
</span><span class="line">        elseif c1 = 7.
</span><span class="line">          digit = ''.
</span><span class="line">          if len &gt; 10 .
</span><span class="line">            c4 = len - 10.
</span><span class="line">            if scr+c4(4) = '0000'.
</span><span class="line">              weight = ''.
</span><span class="line">            endif.
</span><span class="line">          endif.
</span><span class="line">        elseif c1 = 11.
</span><span class="line">          digit = ''.
</span><span class="line">        elseif d1 = '0'.
</span><span class="line">          digit = ''.
</span><span class="line">          weight = ''.
</span><span class="line">        else.
</span><span class="line">          weight = ''.
</span><span class="line">        endif.
</span><span class="line">      endif.
</span><span class="line">      concatenate digit weight res into res .
</span><span class="line">      d1 = d2.
</span><span class="line">    enddo.
</span><span class="line">  endif.
</span><span class="line">  len = strlen( res ) - 1.
</span><span class="line">  fen = res+len(1).
</span><span class="line">  if fen &lt;&gt; '分' .
</span><span class="line">    concatenate res '整' into ev_money.
</span><span class="line">  else.
</span><span class="line">    ev_money = res.
</span><span class="line">  endif.
</span><span class="line">
</span><span class="line">endfunction.</span></code></pre></td></tr></table></div></figure></notextile></div>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[取SD凭证流 - RV_ORDER_FLOW_INFORMATION]]></title>
    <link href="http://lomozm.github.io/blog/20131224/qu-sdping-zheng-liu-rv-order-flow-information/"/>
    <updated>2013-12-24T16:24:01+08:00</updated>
    <id>http://lomozm.github.io/blog/20131224/qu-sdping-zheng-liu-rv-order-flow-information</id>
    <content type="html"><![CDATA[<p>可以得到从销售到财务凭证的流数据
</p>
<p>示例：</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
</pre></td><td class="code"><pre><code class=""><span class="line">data: lt_vbak type table of vbak with header line,
</span><span class="line">         ls_vbco6 type vbco6.
</span><span class="line">
</span><span class="line">    ls_vbco6-mandt = sy-mandt.
</span><span class="line">    ls_vbco6-vbeln = lt_vbak-vbeln.</span></code></pre></td></tr></table></div></figure></notextile></div>

<!--more-->

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
</pre></td><td class="code"><pre><code class=""><span class="line">refresh: lt_vbfa.
</span><span class="line">    call function 'RV_ORDER_FLOW_INFORMATION'
</span><span class="line">      exporting
</span><span class="line">*   AUFBEREITUNG        = '2'
</span><span class="line">*   BELEGTYP            = ' '
</span><span class="line">        comwa               = ls_vbco6
</span><span class="line">*   NACHFOLGER          = 'X'
</span><span class="line">*   N_STUFEN            = '50'
</span><span class="line">*   VORGAENGER          = 'X'
</span><span class="line">*   V_STUFEN            = '50'
</span><span class="line">* IMPORTING
</span><span class="line">*   BELEGTYP_BACK       =
</span><span class="line">      tables
</span><span class="line">        vbfa_tab            = lt_vbfa
</span><span class="line">     exceptions
</span><span class="line">       no_vbfa             = 1
</span><span class="line">       no_vbuk_found       = 2
</span><span class="line">       others              = 3
</span><span class="line">              .
</span><span class="line">    if sy-subrc &lt;&gt; 0.
</span><span class="line">* Implement suitable error handling here
</span><span class="line">    endif.</span></code></pre></td></tr></table></div></figure></notextile></div>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[银行代码F4帮助 - SEARCH_BANK_ADDRESS]]></title>
    <link href="http://lomozm.github.io/blog/20131223/yin-xing-dai-ma-f4bang-zhu-search-bank-address/"/>
    <updated>2013-12-23T15:55:56+08:00</updated>
    <id>http://lomozm.github.io/blog/20131223/yin-xing-dai-ma-f4bang-zhu-search-bank-address</id>
    <content type="html"><![CDATA[<p>说明：输入国家代码，运行时弹出选择窗口</p>

<p>示例：</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
</pre></td><td class="code"><pre><code class=""><span class="line">data: lwa_bnka type bnka.
</span><span class="line">
</span><span class="line">  call function 'SEARCH_BANK_ADDRESS'
</span><span class="line">    exporting
</span><span class="line">      i_banks = p_banks
</span><span class="line">*     I_MORE  = 'X'
</span><span class="line">    importing
</span><span class="line">      e_bnka  = lwa_bnka.
</span><span class="line">  if lwa_bnka is not initial.
</span><span class="line">    p_0026  = lwa_bnka-bankl.
</span><span class="line">  endif.</span></code></pre></td></tr></table></div></figure></notextile></div>

<!--more-->
<p><img src="http://lomozm.github.io/images/images/daa36f17829e2b3321a7f0c3e99cfe82.jpeg" /></p>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[My first octopress blog]]></title>
    <link href="http://lomozm.github.io/blog/20131223/my-first-octopress-blog/"/>
    <updated>2013-12-23T13:14:39+08:00</updated>
    <id>http://lomozm.github.io/blog/20131223/my-first-octopress-blog</id>
    <content type="html"><![CDATA[
<p>话说第一篇blog是关于octopress的，魔咒啊！<br />
很早就有建自己blog的想法，最近项目空闲，总算是实现了，也不尽完美<br /><br />
octopress主要优点就是可以绑定自己的域名<br />
<!--more--></p>
<h3>基础搭建</h3>
<p>参船长的文档<a href="http://beyondvincent.com/blog/2013/08/03/108-creating-a-github-blog-using-octopress">利用Octopress搭建一个Github博客</a>
<br /></p>
<h3>导航和评论</h3>
<p>参照冯威的<a href="http://www.cnblogs.com/oec2003/archive/2013/05/31/3109577.html">Octopress博客设置</a>
<br /></p>
<p>说明一下，里面<code>category_list_tag.rb</code>文件内容要做些更改，因为github地址栏不支持中文

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
</pre></td><td class="code"><pre><code class=""><span class="line">module Jekyll 
</span><span class="line">  class CategoryListTag &lt; Liquid::Tag 
</span><span class="line">    def render(context) 
</span><span class="line">      html = "" 
</span><span class="line">      categories = context.registers[:site].categories.keys 
</span><span class="line">      categories.sort.each do |category| 
</span><span class="line">        posts_in_category = context.registers[:site].categories[category].size 
</span><span class="line">        category_dir = context.registers[:site].config['category_dir']
</span><span class="line">        category_url = File.join(category_dir, category.to_url)
</span><span class="line">        html &lt;&lt; "&lt;li class='category'&gt;&lt;a href='http://lomozm.github.io/#{category_url}/'&gt;#{category} (#{posts_in_category})&lt;/a&gt;&lt;/li&gt;\n" 
</span><span class="line">      end 
</span><span class="line">      html 
</span><span class="line">    end 
</span><span class="line">  end 
</span><span class="line">end
</span><span class="line">
</span><span class="line">Liquid::Template.register_tag('category_list', Jekyll::CategoryListTag)
</span><span class="line">require 'stringex'</span></code></pre></td></tr></table></div></figure></notextile></div>

</p>

<h3>其它</h3>
<p>添加分享<a href="http://blog.csdn.net/jackystudio/article/details/16838525">【像黑客一样写博客之七】分享功能</a><br />
改变图标<a href="http://brianbuccola.github.io/blog/2012-11-29-how-to-change-the-favicon-in-octopress.html">How to Change the Favicon in Octopress</a><br />
插入链接<a href="http://wowubuntu.com/markdown">Markdown 语法说明</a>(注意：如果链接是以”/“结尾的，需把它去掉)<br />
其它技巧<a href="http://blog.jackphil.com/blog/2012/05/16/octopress-tips">Octopress技巧集</a><br /></p>
<p>对于配置文件<code>_config.yml</code>的一些更改

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
</pre></td><td class="code"><pre><code class=""><span class="line">permalink: /blog/:year:month:day/:title/
</span><span class="line">markdown: kramdown
</span><span class="line">excerpt_link: "阅读全文…” 
</span><span class="line">default_asides: [asides/title_pic.html, asides/recent_posts.html, custom/asides/recent_comment.html, asides/category_list.html]</span></code></pre></td></tr></table></div></figure></notextile></div>

</p>
<h3>附上整理的Markdown部分语法</h3>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
</pre></td><td class="code"><pre><code class=""><span class="line">octopress发布blog常用格式
</span><span class="line">
</span><span class="line">sudo rake new_post[“    “]
</span><span class="line">sudo rake generate
</span><span class="line">sudo rake deploy
</span><span class="line">
</span><span class="line">&lt;code&gt;  &lt;/code&gt;
</span><span class="line">&lt;h3&gt;    &lt;/h3&gt;
</span><span class="line">&lt;p&gt; 	&lt;/p&gt;
</span><span class="line">
</span><span class="line">&lt;ol&gt;或者&lt;ul&gt;
</span><span class="line">  &lt;li&gt;  &lt;/li&gt;
</span><span class="line">  &lt;li&gt;  &lt;/li&gt;
</span><span class="line">&lt;/ol&gt;或者&lt;/ul&gt;
</span><span class="line">
</span><span class="line">插入链接[Markdown 语法说明][2]
</span><span class="line">[2]: http://wowubuntu.com/markdown “说明”
</span><span class="line">
</span><span class="line">*或者**     *或者**
</span><span class="line">&lt;!--more—&gt;
</span><span class="line">转义符反斜杠\</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>最后，感谢万能的google！</p>
<p><br /></p>
]]></content>
  </entry>
  
</feed>
